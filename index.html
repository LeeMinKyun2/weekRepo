<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì£¼ê°„ ì—…ë¬´ ë³´ê³ </title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f4f4f4; }
        .container { background-color: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); max-width: 600px; margin: auto; }
        h1 { text-align: center; color: #333; }
        .form-group { margin-bottom: 15px; }
        
        /* ê·¸ë£¹ ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
        .form-section {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .form-section h3 {
            margin: 0 0 15px 0;
            color: #495057;
            font-size: 16px;
            font-weight: 600;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 8px;
        }
        
        .form-section .form-group {
            margin-bottom: 12px;
        }
        
        .form-section .form-group:last-child {
            margin-bottom: 0;
        }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        
        /* ì„¹ì…˜ ì œëª©ê³¼ ì²´í¬ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
        .section-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 5px;
        }
        
        .section-header label {
            margin: 0;
            flex: 1;
        }
        
        .section-header .none-checkbox {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
            color: #666;
        }
        
        .section-header .none-checkbox input[type="checkbox"] {
            margin: 0;
            width: auto;
        }
        
        .section-header .none-checkbox label {
            margin: 0;
            font-weight: normal;
            cursor: pointer;
        }
        
        /* ë¹„í™œì„±í™”ëœ ì„¹ì…˜ ìŠ¤íƒ€ì¼ */
        .section-disabled {
            opacity: 0.5;
            pointer-events: none;
        }
        
        /* ë¹„í™œì„±í™”ëœ ì²´í¬ë°•ìŠ¤ì™€ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .section-disabled .none-checkbox input[type="checkbox"] {
            opacity: 0.5;
            pointer-events: none;
        }
        
        .section-disabled .none-checkbox label {
            opacity: 0.5;
            pointer-events: none;
        }
        
        .section-disabled .add-item-btn {
            opacity: 0.5;
            pointer-events: none;
        }
        
        /* ì œì¶œ ë²„íŠ¼ ì¤‘ì•™ ì •ë ¬ */
        .submit-button-container {
            text-align: center;
            margin-top: 20px;
        }
        
        .submit-button-container button {
            margin: 0 auto;
        }

        /* ë¼ë²¨ê³¼ ì²´í¬ë°•ìŠ¤ë¥¼ ê°™ì€ ë¼ì¸ì— ë°°ì¹˜ */
        .label-with-checkbox {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        .simple-checkbox {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .simple-checkbox label {
            font-weight: normal;
            margin: 0;
            cursor: pointer;
            font-size: 14px;
        }
        
        /* ë³µì‚¬/ë¶™ì—¬ë„£ê¸° ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .copy-btn, .paste-btn {
            background-color: #6c757d;
            color: white;
            border: none;
            border-radius: 3px;
            padding: 4px 8px;
            cursor: pointer;
            font-size: 11px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-left: 5px;
            transition: background-color 0.2s ease;
            white-space: nowrap;
        }
        
        .copy-btn:hover, .paste-btn:hover {
            background-color: #5a6268;
        }
        
        .copy-btn:active, .paste-btn:active {
            background-color: #495057;
        }
        
        .copy-btn.copied {
            background-color: #28a745;
        }
        
        .paste-btn.pasted {
            background-color: #17a2b8;
        }
        
        .target-checkboxes {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .copy-paste-container {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .date-label {
            font-size: 12px;
            color: #666;
            margin-right: 5px;
        }
        
        
        input[type="text"], textarea, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        textarea { resize: vertical; min-height: 100px; }
        
        /* ë¦¬ìŠ¤íŠ¸ ì…ë ¥ ìŠ¤íƒ€ì¼ */
        .list-input-container {
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            background-color: #f9f9f9;
        }
        
        .list-input-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .list-input-item:last-child {
            margin-bottom: 0;
        }
        
        .list-input-item input {
            flex: 1;
            margin-right: 8px;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            /* ëª¨ë°”ì¼ì—ì„œ ì¤„ë°”ê¿ˆ ë°©ì§€ */
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        /* ê³ ê° ìš”ì²­ì‚¬í•­ ì „ìš© ìŠ¤íƒ€ì¼ */
        .list-input-item.customer-request-item {
            display: block;
            position: relative;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            /* íŒŒì¼ ë¬¸ì„œì²˜ëŸ¼ ì™¼ìª½ ìœ„ ëª¨ì„œë¦¬ íŠ€ì–´ë‚˜ì˜¨ íš¨ê³¼ */
            border-top-left-radius: 0;
        }
        
        .list-input-item.customer-request-item::before {
            content: '';
            position: absolute;
            top: -1px;
            left: -1px;
            width: 20px;
            height: 20px;
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-bottom-right-radius: 8px;
            border-top-left-radius: 4px;
        }
        
        .list-input-item.customer-request-item .date-label {
            display: inline-block;
            margin-bottom: 4px;
            font-size: 12px;
            color: #666;
            font-weight: 500;
        }
        
        .list-input-item.customer-request-item .date-input {
            width: 120px;
            margin-bottom: 8px;
            padding: 6px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 12px;
            background-color: #f8f9fa;
            display: block;
        }
        
        .list-input-item.customer-request-item .date-input:focus {
            outline: none;
            border-color: #4CAF50;
            background-color: white;
        }
        
        .list-input-item.customer-request-item .list-input {
            width: 100%;
            margin-right: 0;
            margin-bottom: 8px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            background-color: #fafafa;
            white-space: normal;
            overflow: visible;
            text-overflow: unset;
            resize: vertical;
            min-height: 40px;
        }
        
        .list-input-item.customer-request-item .list-input:focus {
            outline: none;
            border-color: #4CAF50;
            background-color: white;
        }
        
        .list-input-item.customer-request-item .remove-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background-color: #dc3545;
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .list-input-item.customer-request-item .remove-btn:hover {
            background-color: #c82333;
        }
        
        /* ì‘ì—… ëŒ€ìƒ ì„ íƒ ìŠ¤íƒ€ì¼ */
        .list-input-item .target-label {
            display: inline-block;
            margin-bottom: 4px;
            font-size: 12px;
            color: #666;
            font-weight: 500;
        }
        
        .list-input-item .target-checkboxes {
            display: flex;
            gap: 8px;
            margin-bottom: 8px;
            flex-wrap: wrap;
        }
        
        .list-input-item .target-checkbox-item {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .list-input-item .target-checkbox-item input[type="checkbox"] {
            margin: 0;
            width: auto;
        }
        
        .list-input-item .target-checkbox-item label {
            margin: 0;
            font-size: 12px;
            font-weight: normal;
            cursor: pointer;
        }
        
        .list-input-item .remove-btn {
            background-color: #dc3545;
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .list-input-item .remove-btn:hover {
            background-color: #c82333;
        }
        
        .add-item-btn {
            background-color: #6c757d;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 13px;
            margin-top: 8px;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }
        
        .add-item-btn:hover {
            background-color: #5a6268;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .add-item-btn:active {
            transform: translateY(0);
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover { background-color: #45a049; }
        button:disabled { background-color: #cccccc; cursor: not-allowed; }
        .response { margin-top: 20px; padding: 10px; background-color: #e2e2e2; border-radius: 4px; }
        
        /* í—¤ë” ì„¹ì…˜ ìŠ¤íƒ€ì¼ */
        .header-section {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
            position: relative;
        }
        
        .header-section h1 {
            margin: 0;
        }
        
        .help-button {
            position: absolute;
            right: 0;
            background-color: #2196F3;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .help-button:hover {
            background-color: #1976D2;
        }
        
        /* ë²„íŠ¼ ê·¸ë£¹ ìŠ¤íƒ€ì¼ */
        .button-group {
            display: flex;
            gap: 10px;
        }
        
        .button-group button {
            flex: 1;
        }
        
        /* ë§¤ë‹ˆì €/ì‚¬ì´íŠ¸ ì¡°íšŒ ë²„íŠ¼ ì¤‘ì•™ì •ë ¬ */
        .query-button-container {
            text-align: center;
            margin: 15px 0;
        }
        
        .query-button-container button {
            margin: 0 auto;
        }
        
        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 0;
            border-radius: 8px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid #ddd;
            background-color: #f8f9fa;
            border-radius: 8px 8px 0 0;
        }
        
        .modal-header h2 {
            margin: 0;
            color: #333;
        }
        
        .close {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .close:hover {
            color: #000;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .step {
            display: flex;
            margin-bottom: 20px;
            align-items: flex-start;
        }
        
        .step-number {
            font-size: 24px;
            margin-right: 15px;
            flex-shrink: 0;
        }
        
        .step-content {
            flex: 1;
            line-height: 1.6;
        }
        
        .step-content strong {
            color: #2196F3;
            font-size: 16px;
        }
        
        .account-info {
            background-color: #e3f2fd;
            padding: 15px;
            border-radius: 6px;
            margin-top: 20px;
            border-left: 4px solid #2196F3;
        }
        
        .account-info h3 {
            margin: 0 0 10px 0;
            color: #1976D2;
        }
        
        .account-info p {
            margin: 5px 0;
            font-family: monospace;
            background-color: #fff;
            padding: 5px 10px;
            border-radius: 4px;
        }
        
        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 768px) {
            .header-section {
                flex-direction: column;
                align-items: center;
                gap: 10px;
            }
            
            .help-button {
                position: static;
                margin-top: 10px;
            }
            
            .modal-content {
                width: 95%;
                margin: 5% auto;
                max-height: 90vh;
            }
            
            .modal-header {
                padding: 15px;
            }
            
            .modal-header h2 {
                font-size: 18px;
            }
            
            .modal-body {
                padding: 15px;
            }
            
            .step {
                flex-direction: column;
                text-align: center;
                margin-bottom: 15px;
            }
            
            .step-number {
                margin-right: 0;
                margin-bottom: 8px;
                font-size: 20px;
            }
            
            .step-content {
                font-size: 14px;
            }
            
            .step-content strong {
                font-size: 14px;
            }
            
            .account-info {
                padding: 12px;
                margin-top: 15px;
            }
            
            .account-info h3 {
                font-size: 16px;
            }
            
            .account-info p {
                font-size: 13px;
                padding: 4px 8px;
            }
        }
        
        /* ë§¤ìš° ì‘ì€ í™”ë©´ (320px ì´í•˜) */
        @media (max-width: 480px) {
            .modal-content {
                width: 98%;
                margin: 2% auto;
                max-height: 95vh;
            }
            
            .modal-header {
                padding: 12px;
            }
            
            .modal-header h2 {
                font-size: 16px;
            }
            
            .modal-body {
                padding: 12px;
            }
            
            .step {
                margin-bottom: 12px;
            }
            
            .step-number {
                font-size: 18px;
            }
            
            .step-content {
                font-size: 13px;
            }
            
            .account-info {
                padding: 10px;
            }
        }
    </style>

    <script>
        // í™˜ê²½ë³€ìˆ˜ ì£¼ì…
        window.ENV_SPREADSHEET_ID = '1fmWVqEOJavKVMGT6IZguBMg1kG8bnPdiO_x_FhuXJ-s';
        console.log('Environment variables injected:', {
            SPREADSHEET_ID: '1fmWVqEOJavKVMGT6IZguBMg1kG8bnPdiO_x_FhuXJ-s'
        });
    </script>


    <script>
        // í™˜ê²½ë³€ìˆ˜ ì£¼ì…
        window.ENV_SPREADSHEET_ID = '1Xrz9RlDXu3v6pBbuQc-B306gtXnG5CfebRG6KP44Kxs';
        console.log('Environment variables injected:', {
            SPREADSHEET_ID: '1Xrz9RlDXu3v6pBbuQc-B306gtXnG5CfebRG6KP44Kxs'
        });
    </script>

</head>
<body>
    <div class="container">
        <div class="header-section">
            <h1>ì£¼ê°„ ì—…ë¬´ ë³´ê³  ì…ë ¥</h1>
            <button id="helpButton" class="help-button">ğŸ“– ì‚¬ìš©ë²•</button>
        </div>
        <form id="reportForm">
            <!-- ì„ íƒ ì„¹ì…˜ -->
            <div class="form-section">
                <h3>ğŸ“‹ ê¸°ë³¸ ì •ë³´ ì„ íƒ</h3>
                <div class="form-group">
                    <label for="manager">ë§¤ë‹ˆì € ì´ë¦„:</label>
                    <select id="manager" name="manager" required>
                        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                    </select>
                    <input type="text" id="managerDirectInput" placeholder="ë§¤ë‹ˆì € ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: í™ê¸¸ë™,ì´ì¶˜í–¥ ë˜ëŠ” í™ê¸¸ë™ ì´ì¶˜í–¥)" style="display: none; margin-top: 5px;">
                </div>
                <div class="form-group">
                    <div class="label-with-checkbox">
                        <label for="site_name">ë‹´ë‹¹ ì‚¬ì´íŠ¸:</label>
                        <div class="simple-checkbox">
                            <input type="checkbox" id="showMySitesOnly" checked>
                            <label for="showMySitesOnly">ë‚´ ë‹´ë‹¹ ì‚¬ì´íŠ¸ë§Œ</label>
                        </div>
                    </div>
                    <select id="site_name" name="site_name" required>
                        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="reportSheetName">ë³´ê³ ì„œ ì‹œíŠ¸ ì´ë¦„:</label>
                    <select id="reportSheetName" name="reportSheetName" required>
                        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                    </select>
                    <div id="weeklySheetInfo" style="margin-top: 8px; padding: 8px; background-color: #e3f2fd; border: 1px solid #2196f3; border-radius: 4px; font-size: 14px; color: #1976d2; display: none;">
                        <strong>ğŸ“… ì´ë²ˆ ì£¼ ì‘ì„± ì‹œíŠ¸: </strong><span id="currentWeekSheet"></span>
                    </div>
                </div>
                <div class="form-group query-button-container">
                    <button type="button" id="queryDropdownsButton" disabled>ë§¤ë‹ˆì €/ì‚¬ì´íŠ¸ ëª©ë¡ ì¡°íšŒ</button>
                </div>
                <div class="form-group button-group">
                    <button type="button" id="readReportButton" disabled>ë³´ê³ ì„œ ì¡°íšŒ</button>
                    <button type="button" id="readLastWeekReportButton" disabled>ì§€ë‚œ ì£¼ ë³´ê³ ì„œ ì¡°íšŒ</button>
                </div>
            </div>
                        <!-- ì…ë ¥ ì„¹ì…˜ -->
            <div class="form-section">
                <h3>ğŸ“ ë³´ê³ ì„œ ì‘ì„±</h3>
                <div class="form-group">
                    <div class="section-header">
                        <label for="this_week_tasks">ê¸ˆì£¼ í•œ ì¼:</label>
                        <div class="none-checkbox">
                            <input type="checkbox" id="this_week_none" onchange="toggleSection('this_week_tasks_container', this.checked)">
                            <label for="this_week_none">ì—†ìŒ</label>
                        </div>
                    </div>
                    <div class="list-input-container" id="this_week_tasks_container">
                        <div class="list-input-item customer-request-item">
                            <div class="target-label">(ì‘ì—… ëŒ€ìƒ)</div>
                            <div class="target-checkboxes">
                                <div class="target-checkbox-item">
                                    <input type="checkbox" id="this_week_dev_1" name="this_week_target_1" value="ê°œë°œê³„">
                                    <label for="this_week_dev_1">ê°œë°œê³„</label>
                                </div>
                                <div class="target-checkbox-item">
                                    <input type="checkbox" id="this_week_ops_1" name="this_week_target_1" value="ìš´ì˜ê³„">
                                    <label for="this_week_ops_1">ìš´ì˜ê³„</label>
                                </div>
                                <div class="target-checkbox-item">
                                    <input type="checkbox" id="this_week_etc_1" name="this_week_target_1" value="ê¸°íƒ€">
                                    <label for="this_week_etc_1">ê¸°íƒ€</label>
                                </div>
                                <div class="copy-paste-container">
                                    <button type="button" class="copy-btn" onclick="copyListData('this_week_tasks_container')" title="ê¸ˆì£¼ í•œ ì¼ ë³µì‚¬">Copy</button>
                                    <button type="button" class="paste-btn" onclick="pasteListData('this_week_tasks_container')" title="ê¸ˆì£¼ í•œ ì¼ ë¶™ì—¬ë„£ê¸°">Paste</button>
                                </div>
                            </div>
                            <textarea placeholder="ê¸ˆì£¼ í•œ ì¼ì„ ì…ë ¥í•˜ì„¸ìš”..." class="list-input" rows="3"></textarea>
                            <button type="button" class="remove-btn" onclick="removeListItem(this)">Ã—</button>
                        </div>
                    </div>
                    <button type="button" class="add-item-btn" onclick="addListItem('this_week_tasks_container')">+ í•­ëª© ì¶”ê°€</button>
                </div>
                <div class="form-group">
                    <div class="section-header">
                        <label for="next_week_tasks">í–¥í›„ í•  ì¼:</label>
                        <div class="none-checkbox">
                            <input type="checkbox" id="next_week_none" onchange="toggleSection('next_week_tasks_container', this.checked)">
                            <label for="next_week_none">ì—†ìŒ</label>
                        </div>
                    </div>
                    <div class="list-input-container" id="next_week_tasks_container">
                        <div class="list-input-item customer-request-item">
                            <div class="target-label">(ì‘ì—… ëŒ€ìƒ)</div>
                            <div class="target-checkboxes">
                                <div class="target-checkbox-item">
                                    <input type="checkbox" id="next_week_dev_1" name="next_week_target_1" value="ê°œë°œê³„">
                                    <label for="next_week_dev_1">ê°œë°œê³„</label>
                                </div>
                                <div class="target-checkbox-item">
                                    <input type="checkbox" id="next_week_ops_1" name="next_week_target_1" value="ìš´ì˜ê³„">
                                    <label for="next_week_ops_1">ìš´ì˜ê³„</label>
                                </div>
                                <div class="target-checkbox-item">
                                    <input type="checkbox" id="next_week_etc_1" name="next_week_target_1" value="ê¸°íƒ€">
                                    <label for="next_week_etc_1">ê¸°íƒ€</label>
                                </div>
                                <div class="copy-paste-container">
                                    <button type="button" class="copy-btn" onclick="copyListData('next_week_tasks_container')" title="í–¥í›„ í•  ì¼ ë³µì‚¬">Copy</button>
                                    <button type="button" class="paste-btn" onclick="pasteListData('next_week_tasks_container')" title="í–¥í›„ í•  ì¼ ë¶™ì—¬ë„£ê¸°">Paste</button>
                                </div>
                            </div>
                            <textarea placeholder="í–¥í›„ í•  ì¼ì„ ì…ë ¥í•˜ì„¸ìš”..." class="list-input" rows="3"></textarea>
                            <button type="button" class="remove-btn" onclick="removeListItem(this)">Ã—</button>
                        </div>
                    </div>
                    <button type="button" class="add-item-btn" onclick="addListItem('next_week_tasks_container')">+ í•­ëª© ì¶”ê°€</button>
                </div>
                <div class="form-group">
                    <div class="section-header">
                        <label for="customer_requests">ê³ ê° ìš”ì²­ì‚¬í•­:</label>
                        <div class="none-checkbox">
                            <input type="checkbox" id="customer_requests_none" onchange="toggleSection('customer_requests_container', this.checked)">
                            <label for="customer_requests_none">ì—†ìŒ</label>
                        </div>
                    </div>
                    <div class="list-input-container" id="customer_requests_container">
                        <div class="list-input-item customer-request-item">
                            <div class="target-label">(ë°œìƒì¼)</div>
                            <div class="target-checkboxes">
                                <div class="date-label">(ë°œìƒì¼)</div>
                                <input type="date" class="date-input" title="ë°œìƒì¼ ì„ íƒ">
                                <div class="copy-paste-container">
                                    <button type="button" class="copy-btn" onclick="copyListItemData(this)" title="ì´ í•­ëª© ë³µì‚¬">Copy</button>
                                    <button type="button" class="paste-btn" onclick="pasteListItemData(this)" title="ì´ í•­ëª©ì— ë¶™ì—¬ë„£ê¸°">Paste</button>
                                </div>
                            </div>
                            <textarea placeholder="ê³ ê° ìš”ì²­ì‚¬í•­ì„ ì…ë ¥í•˜ì„¸ìš”..." class="list-input" rows="3"></textarea>
                            <button type="button" class="remove-btn" onclick="removeListItem(this)">Ã—</button>
                        </div>
                    </div>
                    <button type="button" class="add-item-btn" onclick="addListItem('customer_requests_container')">+ í•­ëª© ì¶”ê°€</button>
                </div>
                <div class="form-group submit-button-container">
                    <button type="submit" disabled>ë³´ê³ ì„œ ì œì¶œ</button>
                </div>
            </div>
        </form>
        <div id="response" class="response" style="display: none;"></div>
    </div>

    <!-- ì œì¶œ ì™„ë£Œ ëª¨ë‹¬ -->
    <div id="submitSuccessModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header" style="background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%); color: white;">
                <h2>âœ… ì œì¶œ ì™„ë£Œ</h2>
                <span class="close" onclick="closeSubmitSuccessModal()">&times;</span>
            </div>
            <div class="modal-body" style="text-align: center; padding: 40px 20px;">
                <div style="font-size: 48px; margin-bottom: 20px;">ğŸ‰</div>
                <h3 style="color: #4CAF50; margin-bottom: 15px;">ë³´ê³ ì„œê°€ ì„±ê³µì ìœ¼ë¡œ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤!</h3>
                <p style="color: #666; margin-bottom: 30px;">Google Sheetsì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
                <div id="submitSuccessSheetLink" style="margin-bottom: 30px;"></div>
                <button onclick="closeSubmitSuccessModal()" style="
                    background: #4CAF50;
                    color: white;
                    border: none;
                    padding: 12px 40px;
                    font-size: 16px;
                    border-radius: 5px;
                    cursor: pointer;
                    font-weight: bold;
                    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
                    transition: all 0.3s ease;
                " onmouseover="this.style.background='#45a049'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 8px rgba(0,0,0,0.3)'" 
                   onmouseout="this.style.background='#4CAF50'; this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 5px rgba(0,0,0,0.2)'">
                    í™•ì¸
                </button>
            </div>
        </div>
    </div>

    <!-- ì‚¬ìš©ë²• íŒì—… ëª¨ë‹¬ -->
    <div id="helpModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ğŸ“– ì‚¬ìš©ë²•</h2>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <div class="step">
                    <div class="step-number">1ï¸âƒ£</div>
                    <div class="step-content">
                        <strong>ë§¤ë‹ˆì €/ì‚¬ì´íŠ¸ ëª©ë¡ ì¡°íšŒ</strong><br>
                        "ë§¤ë‹ˆì €/ì‚¬ì´íŠ¸ ëª©ë¡ ì¡°íšŒ" ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.
                    </div>
                </div>
                
                <div class="step">
                    <div class="step-number">2ï¸âƒ£</div>
                    <div class="step-content">
                        <strong>ì •ë³´ ì„ íƒ</strong><br>
                        ë§¤ë‹ˆì € ì´ë¦„, ë‹´ë‹¹ ì‚¬ì´íŠ¸, ë³´ê³ ì„œ ì‹œíŠ¸ë¥¼ ì„ íƒí•©ë‹ˆë‹¤.<br>
                        <em>ğŸ’¡ ë§¤ë‹ˆì €ê°€ 2ëª… ì´ìƒì¸ ê²½ìš°: "ì§ì ‘ì…ë ¥"ì„ ì„ íƒí•˜ê³  "í™ê¸¸ë™,ì´ì¶˜í–¥" ë˜ëŠ” "í™ê¸¸ë™ ì´ì¶˜í–¥" í˜•íƒœë¡œ ì…ë ¥í•˜ì„¸ìš”.</em>
                    </div>
                </div>
                
                <div class="step">
                    <div class="step-number">3ï¸âƒ£</div>
                    <div class="step-content">
                        <strong>ë³´ê³ ì„œ ì œì¶œ</strong><br>
                        í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•œ í›„ "ë³´ê³ ì„œ ì œì¶œ" ë²„íŠ¼ì„ í´ë¦­í•©ë‹ˆë‹¤.<br>
                        <em>ğŸ’¡ ì‚¬ì´íŠ¸ ì„ íƒ ì‹œ í”„ë¡œì íŠ¸ ì‚¬ì´íŠ¸ì¸ ê²½ìš° ê³ ê° ìš”ì²­ì‚¬í•­ì´ ìë™ìœ¼ë¡œ ë¹„í™œì„±í™”ë©ë‹ˆë‹¤.</em>
                    </div>
                </div>
                
                <div class="step">
                    <div class="step-number">4ï¸âƒ£</div>
                    <div class="step-content">
                        <strong>ìˆ˜ì • ì‹œ</strong><br>
                        ê¸°ì¡´ ë°ì´í„°ë¥¼ ìˆ˜ì •í•  ë•ŒëŠ” "ë³´ê³ ì„œ ì¡°íšŒ" ë²„íŠ¼ìœ¼ë¡œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¨ í›„ ìˆ˜ì •í•˜ê³  "ë³´ê³ ì„œ ì œì¶œ" ë²„íŠ¼ì„ í´ë¦­í•©ë‹ˆë‹¤.
                    </div>
                </div>
                
                <div class="account-info">
                    <h3>ğŸ” Google ê³µìš© ê³„ì •</h3>
                    <p><strong>ID:</strong> interezen502@gmail.com</p>
                    <p><strong>PW:</strong> inter502</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Google API ì„¤ì •
        const CLIENT_ID = '898247770764-ev4i2nonvqnd4n8evrnivt75i2t78s0u.apps.googleusercontent.com'; // Google Cloud Consoleì—ì„œ ë°œê¸‰ë°›ì€ í´ë¼ì´ì–¸íŠ¸ IDë¥¼ ì…ë ¥í•˜ì„¸ìš”.
        const API_KEY = 'AIzaSyBV_qqUNlgCkRAt7sITJbzxt38I3gZ5Z-4';     // Google Cloud Consoleì—ì„œ ë°œê¸‰ë°›ì€ API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”.
        const DISCOVERY_DOCS = ["https://sheets.googleapis.com/$discovery/rest?version=v4"];
        const SCOPES = "https://www.googleapis.com/auth/spreadsheets";
        
        // í™˜ê²½ë³€ìˆ˜ì—ì„œ ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ID ê°€ì ¸ì˜¤ê¸° (ê¸°ë³¸ê°’: í…ŒìŠ¤íŠ¸ ìŠ¤í”„ë ˆë“œì‹œíŠ¸)
        const SPREADSHEET_ID = window.ENV_SPREADSHEET_ID || '1Xrz9RlDXu3v6pBbuQc-B306gtXnG5CfebRG6KP44Kxs';

        let tokenClient;
        let gapiInited = false;
        let gisInited = false;

        // ì›ë³¸ ë§¤ë‹ˆì € ë° ì‚¬ì´íŠ¸ ëª©ë¡ (ê²€ìƒ‰ í•„í„°ë§ìš©)
        let originalManagers = [];
        let originalSites = [];
        // ì›ë³¸ ë³´ê³ ì„œ ì‹œíŠ¸ ì´ë¦„ ëª©ë¡ (ê²€ìƒ‰ í•„í„°ë§ìš©)
        let originalReportSheetNames = [];
        
        // L40 ì´í›„ ë²”ìœ„ì˜ ì‚¬ì´íŠ¸ë“¤ (ê³ ê° ìš”ì²­ì‚¬í•­ ì…ë ¥ ë¶ˆê°€) - ë™ì ìœ¼ë¡œ ìƒì„±ë¨
        let sitesWithoutCustomerRequests = [];
        
        // ë§¤ë‹ˆì €-ì‚¬ì´íŠ¸ ë§¤í•‘ ë°ì´í„°
        let managerSiteMapping = {};
        
        // ë³´ê³ ì„œ ì‹œíŠ¸ í•„í„°ë§ ê´€ë ¨ ë³€ìˆ˜
        let showAllSheets = false;

        // ë§¤ë‹ˆì €-ì‚¬ì´íŠ¸ ë§¤í•‘ ë°ì´í„° ë¡œë“œ
        async function loadManagerSiteMapping() {
            try {
                const response = await fetch('./manager_site_mapping.json');
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                managerSiteMapping = data.managerSiteMapping;
                console.log('Manager-Site mapping loaded successfully:', Object.keys(managerSiteMapping).length, 'managers');
            } catch (error) {
                console.error('Error loading manager-site mapping:', error);
                managerSiteMapping = {};
            }
        }

        function gapiLoaded() {
            gapi.load('client', initializeGapiClient);
        }

        async function initializeGapiClient() {
            await gapi.client.init({
                apiKey: API_KEY,
                discoveryDocs: DISCOVERY_DOCS,
            });
            // Sheets APIë¥¼ ëª…ì‹œì ìœ¼ë¡œ ë¡œë“œí•©ë‹ˆë‹¤.
            await gapi.client.load('sheets', 'v4');
            gapiInited = true;
            maybeEnableForm();
        }

        function gisLoaded() {
            console.log('ğŸ”§ GIS (Google Identity Services) ë¡œë“œë¨');
            console.log('ğŸ”§ CLIENT_ID:', CLIENT_ID);
            console.log('ğŸ”§ SCOPES:', SCOPES);
            console.log('ğŸ”§ í˜„ì¬ URL:', window.location.href);
            console.log('ğŸ”§ í˜„ì¬ Origin:', window.location.origin);
            
            tokenClient = google.accounts.oauth2.initTokenClient({
                client_id: CLIENT_ID,
                scope: SCOPES,
                callback: (resp) => {
                    console.log('ğŸ”§ OAuth ì½œë°± ì‘ë‹µ:', resp);
                    if (resp.error !== undefined) {
                        console.error('âŒ OAuth ì˜¤ë¥˜:', resp.error);
                        console.error('âŒ ì˜¤ë¥˜ ìƒì„¸:', resp.error_description);
                        console.error('âŒ ì „ì²´ ì‘ë‹µ:', resp);
                        throw (resp);
                    }
                    console.log('âœ… OAuth ì„±ê³µ, í† í° ì„¤ì •');
                    gapi.client.setToken(resp);
                },
            });
            gisInited = true; // ì´ ë¶€ë¶„ì„ callback ë°–ìœ¼ë¡œ ì´ë™
            maybeEnableForm(); // ì´ ë¶€ë¶„ì„ callback ë°–ìœ¼ë¡œ ì´ë™
        }

        function maybeEnableForm() {
            console.log('maybeEnableForm called.'); // maybeEnableForm í•¨ìˆ˜ í˜¸ì¶œ ë¡œê·¸ ì¶”ê°€
            console.log('gapiInited:', gapiInited, 'gisInited:', gisInited); // gapiInited, gisInited ìƒíƒœ ë¡œê·¸ ì¶”ê°€
            if (gapiInited && gisInited) {
                // í¼ì„ í™œì„±í™”í•˜ê³  ë“œë¡­ë‹¤ìš´ ë°ì´í„°ë¥¼ ë¡œë“œí•©ë‹ˆë‹¤.
                // populateDropdowns()ëŠ” ì´ì œ ì¡°íšŒ ë²„íŠ¼ í´ë¦­ ì‹œ í˜¸ì¶œë©ë‹ˆë‹¤.
                document.getElementById('queryDropdownsButton').disabled = false;
                document.querySelector('button[type="submit"]').disabled = false;
                console.log('Dropdowns and Submit buttons enabled.'); // ë²„íŠ¼ í™œì„±í™” ë¡œê·¸ ì¶”ê°€
            } else {
                console.log('Dropdowns and Submit buttons NOT yet enabled (waiting for gapi/gis init).'); // ë²„íŠ¼ ë¹„í™œì„±í™” ìƒíƒœ ë¡œê·¸ ì¶”ê°€
            }
        }



        async function populateDropdowns() {
            console.log('ğŸ”§ populateDropdowns í•¨ìˆ˜ ì‹œì‘');
            console.log('ğŸ”§ gapi.client ìƒíƒœ:', gapi.client);
            console.log('ğŸ”§ í˜„ì¬ í† í°:', gapi.client.getToken());
            const managerSelect = document.getElementById('manager');
            const siteSelect = document.getElementById('site_name');
            const reportSheetNameSelect = document.getElementById('reportSheetName');
            const queryButton = document.getElementById('queryDropdownsButton');

            // ë²„íŠ¼ ìƒíƒœë¥¼ ë¡œë”© ì¤‘ìœ¼ë¡œ ë³€ê²½
            queryButton.textContent = 'ë¡œë”© ì¤‘...';
            queryButton.style.backgroundColor = '#ffc107'; // ë¡œë”© ì¤‘ ìƒ‰ìƒ (ì˜ˆ: ì£¼í™©ìƒ‰)
            queryButton.disabled = true;

            // ê¸°ì¡´ ì˜µì…˜ ì œê±° (ì²« ë²ˆì§¸ 'ì„ íƒí•˜ì„¸ìš”' ì˜µì…˜ ì œì™¸)
            managerSelect.innerHTML = '<option value="">ì„ íƒí•˜ì„¸ìš”</option>';
            siteSelect.innerHTML = '<option value="">ì„ íƒí•˜ì„¸ìš”</option>';
            reportSheetNameSelect.innerHTML = '<option value="">ì„ íƒí•˜ì„¸ìš”</option>';

            // SPREADSHEET_IDëŠ” ìƒë‹¨ì—ì„œ í™˜ê²½ë³€ìˆ˜ë¡œ ì„¤ì •ë¨
            const DROPDOWN_SHEET_NAME = 'SITE ë¶„ì¥ í˜„í™©'; // ë“œë¡­ë‹¤ìš´ ë°ì´í„°ê°€ ìˆëŠ” ì‹œíŠ¸ ì´ë¦„
            const MANAGER_RANGE = `${DROPDOWN_SHEET_NAME}!B4:B1000`; // B4ë¶€í„° ì‹œì‘í•˜ì—¬ ë§¤ë‹ˆì € ì´ë¦„ë§Œ ê°€ì ¸ì˜¤ê¸°
            const SITE_RANGE = `${DROPDOWN_SHEET_NAME}!A:Z`; // ì‚¬ì´íŠ¸ ë°ì´í„°ëŠ” ê¸°ì¡´ëŒ€ë¡œ ì „ì²´ ë²”ìœ„

            try {
                console.log('Requesting dropdown data from Google Sheets API...');
                console.log('Spreadsheet ID:', SPREADSHEET_ID);
                console.log('Manager Range:', MANAGER_RANGE);
                console.log('Site Range:', SITE_RANGE);

                // ë§¤ë‹ˆì € ì´ë¦„ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (B4ë¶€í„°)
                const managerResponse = await gapi.client.sheets.spreadsheets.values.get({
                    spreadsheetId: SPREADSHEET_ID,
                    range: MANAGER_RANGE,
                });

                // ì‚¬ì´íŠ¸ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (ê¸°ì¡´ ë°©ì‹)
                const siteResponse = await gapi.client.sheets.spreadsheets.values.get({
                    spreadsheetId: SPREADSHEET_ID,
                    range: SITE_RANGE,
                });

                console.log('Google Sheets API Response (Manager Data):', managerResponse); // API ì‘ë‹µ ì¶œë ¥
                console.log('Google Sheets API Response (Site Data):', siteResponse); // API ì‘ë‹µ ì¶œë ¥

                const managerData = managerResponse.result.values || [];
                const siteData = siteResponse.result.values || [];
                console.log('Extracted managerData:', managerData); // ì¶”ì¶œëœ ë§¤ë‹ˆì € ë°ì´í„° ì¶œë ¥
                console.log('Extracted siteData:', siteData); // ì¶”ì¶œëœ ì‚¬ì´íŠ¸ ë°ì´í„° ì¶œë ¥

                const managers = new Set();
                const sites = new Set();

                // ë§¤ë‹ˆì € ì´ë¦„ ì²˜ë¦¬ (B4ë¶€í„° ì‹œì‘í•˜ë¯€ë¡œ í—¤ë” ì—†ì´ ë°”ë¡œ ì²˜ë¦¬)
                for (let r = 0; r < managerData.length; r++) {
                    const managerCell = managerData[r] && managerData[r][0] ? managerData[r][0].trim() : '';
                    if (managerCell && managerCell !== '') {
                        managers.add(managerCell);
                    }
                }

                // ì‚¬ì´íŠ¸ ë°ì´í„° ì²˜ë¦¬ (ê¸°ì¡´ ë°©ì‹ ìœ ì§€)
                for (let r = 0; r < siteData.length; r++) {
                    const rowData = siteData[r] || [];
                    // Sites start from Column E (index 4)
                    for (let c = 4; c < rowData.length; c++) {
                        const siteCell = rowData[c] ? rowData[c].trim() : '';
                        if (siteCell !== '') {
                            sites.add(siteCell);
                        }
                    }
                }

                originalManagers = Array.from(managers).sort();
                // originalSites = Array.from(sites).sort(); // SITE ë¶„ì¥ í˜„í™©ì—ì„œ ì‚¬ì´íŠ¸ ê°€ì ¸ì˜¤ëŠ” ë¡œì§ ì£¼ì„ ì²˜ë¦¬
                console.log('Original Managers:', originalManagers); // ì›ë³¸ ë§¤ë‹ˆì € ëª©ë¡ ì¶œë ¥
                // console.log('Original Sites:', originalSites);     // ì›ë³¸ ì‚¬ì´íŠ¸ ëª©ë¡ ì¶œë ¥ (ì„ì‹œ ì£¼ì„ ì²˜ë¦¬)

                // ë§¤ë‹ˆì € ë“œë¡­ë‹¤ìš´ ì±„ìš°ê¸°
                updateManagerDropdown(originalManagers);

                // ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ë©”íƒ€ë°ì´í„° ê°€ì ¸ì™€ì„œ YYYY-MM-DD í˜•ì‹ì˜ ì‹œíŠ¸ ì´ë¦„ ì°¾ê¸°
                console.log('Requesting spreadsheet metadata...');
                const spreadsheetMetadataResponse = await gapi.client.sheets.spreadsheets.get({
                    spreadsheetId: SPREADSHEET_ID,
                });
                console.log('Google Sheets API Response (Spreadsheet Metadata):', spreadsheetMetadataResponse);

                // YYYY-MM-DD í˜•ì‹ì˜ ì‹œíŠ¸ ì´ë¦„ í•„í„°ë§
                const datePattern = /^\d{4}-\d{2}-\d{2}$/;
                originalReportSheetNames = spreadsheetMetadataResponse.result.sheets
                    .filter(sheet => datePattern.test(sheet.properties.title))
                    .map(sheet => ({
                        title: sheet.properties.title,
                        id: sheet.properties.sheetId  // sheetId ëŒ€ì‹  idë¡œ ë³€ê²½
                    }))
                    .sort((a, b) => b.title.localeCompare(a.title)); // ìµœì‹  ë‚ ì§œê°€ ë¨¼ì € ì˜¤ë„ë¡ ì •ë ¬

                // ë³´ê³ ì„œ ì‹œíŠ¸ ì´ë¦„ ê°€ì ¸ì˜¤ê¸° ë° ì±„ìš°ê¸°
                console.log('Original Report Sheet Names with IDs:', originalReportSheetNames); // ì›ë³¸ ì‹œíŠ¸ ì´ë¦„ ëª©ë¡ê³¼ ID ì¶œë ¥
                showAllSheets = false; // ì´ˆê¸°í™” ì‹œì—ëŠ” ì œí•œëœ ëª©ë¡ë§Œ í‘œì‹œ
                updateReportSheetNameDropdown(originalReportSheetNames);
                
                // ì´ë²ˆ ì£¼ ì‘ì„± ì‹œíŠ¸ ì •ë³´ í‘œì‹œ
                updateWeeklySheetInfo();

                // --- ì´ì œ ê°€ì¥ ìµœì‹  YYYY-MM-DD ì‹œíŠ¸ì—ì„œ SITEëª… ê°€ì ¸ì˜¤ê¸° ---
                if (originalReportSheetNames.length > 0) {
                    const latestReportSheetName = originalReportSheetNames[0].title; // ê°€ì¥ ìµœì‹  ì‹œíŠ¸ (ì •ë ¬ë˜ì–´ ìˆìŒ)
                    console.log('Fetching site names from latest report sheet:', latestReportSheetName);

                    // ì‚¬ìš©ì ì œê³µ íŒ¨í„´ì— ë”°ë¥¸ SITEëª… ì…€ ë²”ìœ„ (ì „ì²´ ë²”ìœ„ë¡œ í™•ì¥)
                    const siteNameRanges = [
                        `'${latestReportSheetName}'!B:B`, // Bì—´ ì „ì²´ì—ì„œ SITEëª… ì°¾ê¸°
                        `'${latestReportSheetName}'!G:G`, // Gì—´ ì „ì²´ì—ì„œ SITEëª… ì°¾ê¸°
                        `'${latestReportSheetName}'!L:L`, // Lì—´ ì „ì²´ì—ì„œ SITEëª… ì°¾ê¸°
                    ];

                    try {
                        const siteResponse = await gapi.client.sheets.spreadsheets.values.batchGet({
                            spreadsheetId: SPREADSHEET_ID,
                            ranges: siteNameRanges,
                        });
                        console.log('Site Names Batch Get Response:', siteResponse);

                        const fetchedSites = new Set();
                        const lColumnSitesWithoutCustomerRequests = new Set(); // Lì—´ì˜ 40í–‰ ì´í›„ ì‚¬ì´íŠ¸ë“¤
                        
                        siteResponse.result.valueRanges.forEach((rangeData, rangeIndex) => {
                            if (rangeData.values) {
                                rangeData.values.forEach((row, rowIndex) => {
                                    if (row.length > 0 && row[0] && row[0].trim() !== '') {
                                        const cellValue = row[0].trim();
                                        // í—¤ë”ë‚˜ ì„¤ëª… í…ìŠ¤íŠ¸ê°€ ì•„ë‹Œ ì‹¤ì œ ì‚¬ì´íŠ¸ëª…ë§Œ í•„í„°ë§
                                        if (cellValue !== 'SITEëª…' && 
                                            !cellValue.includes('ê¸ˆì£¼ í•œ ì¼') && 
                                            !cellValue.includes('ì°¨ì£¼ í•  ì¼') && 
                                            !cellValue.includes('ê³ ê° ìš”ì²­ì‚¬í•­') &&
                                            !cellValue.includes('ë³¸ì¸ ì„±ëª…') &&
                                            !cellValue.includes('í•„ìˆ˜ ì…ë ¥') &&
                                            !cellValue.includes('ì—†ìŒ') &&
                                            !cellValue.includes('â–¶') &&
                                            !cellValue.includes('êµ¬ë¶„') &&
                                            !cellValue.includes('ì‘ì„± ë“±ë¡ì¼') &&
                                            !cellValue.includes('ë§¤ì£¼ ëª©ìš”ì¼') &&
                                            !cellValue.includes('íœ´ì¼ì€ ì „ì¼') &&
                                            !cellValue.includes('ê° í•­ëª©') &&
                                            !cellValue.includes('ì‘ì„± ë‚´ìš©ì´ ì—†ìœ¼ë©´') &&
                                            !cellValue.includes('SITEëª… ìˆœì„œ') &&
                                            !cellValue.includes('í”„ë¡œì íŠ¸ ìˆœ í‘œì‹œ') &&
                                            !cellValue.includes('25ë…„ í˜„ì¬') &&
                                            !cellValue.includes('ì¶”ì§„ ä¸­ í”„ë¡œì íŠ¸') &&
                                            rowIndex >= 3) { // 4í–‰ë¶€í„° ì‹œì‘ (0-basedì´ë¯€ë¡œ 3)
                                            
                                            fetchedSites.add(cellValue);
                                            
                                            // Lì—´(rangeIndex === 2)ì´ê³  40í–‰ ì´í›„(rowIndex >= 39, 0-basedì´ë¯€ë¡œ 40í–‰ì€ 39)ì¸ ê²½ìš°
                                            if (rangeIndex === 2 && rowIndex >= 39) {
                                                lColumnSitesWithoutCustomerRequests.add(cellValue);
                                                console.log(`Lì—´ 40í–‰ ì´í›„ ì‚¬ì´íŠ¸ ë°œê²¬: ${cellValue} (í–‰: ${rowIndex + 1})`);
                                            }
                                        }
                                    }
                                });
                            }
                        });
                        
                        // Lì—´ 40í–‰ ì´í›„ ì‚¬ì´íŠ¸ë“¤ì„ ì˜ˆì™¸ ëª©ë¡ì— ì¶”ê°€
                        sitesWithoutCustomerRequests = Array.from(lColumnSitesWithoutCustomerRequests);
                        console.log('ë™ì ìœ¼ë¡œ ìƒì„±ëœ ì˜ˆì™¸ ì‚¬ì´íŠ¸ ëª©ë¡:', sitesWithoutCustomerRequests);
                        originalSites = Array.from(fetchedSites).sort();
                        console.log('Original Sites from latest report sheet:', originalSites); // ìƒˆë¡œ ê°€ì ¸ì˜¨ ì‚¬ì´íŠ¸ ëª©ë¡ ì¶œë ¥

                    } catch (siteErr) {
                        console.error('Error fetching site names from latest report sheet:', siteErr);
                        // ì˜¤ë¥˜ ë°œìƒ ì‹œ ì‚¬ì´íŠ¸ ëª©ë¡ì„ ë¹„ì›Œë‘ 
                        originalSites = [];
                    }
                } else {
                    console.log('No YYYY-MM-DD report sheets found, cannot fetch site names.');
                    originalSites = [];
                }

                // ì‚¬ì´íŠ¸ ë“œë¡­ë‹¤ìš´ ì±„ìš°ê¸°
                updateSiteDropdown(originalSites);
                
                // ì´ˆê¸° ìƒíƒœì—ì„œ ê³ ê° ìš”ì²­ì‚¬í•­ í•„ë“œ ìƒíƒœ ì„¤ì •
                toggleCustomerRequestsField('');

                // Google Sheets ë§í¬ ìƒì„± (ì „ì²´ ìŠ¤í”„ë ˆë“œì‹œíŠ¸)
                const mainSheetUrl = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/edit`;
                document.getElementById('response').innerHTML = `
                    ë§¤ë‹ˆì €/ì‚¬ì´íŠ¸/ì‹œíŠ¸ ëª©ë¡ì„ ì„±ê³µì ìœ¼ë¡œ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.<br>
                    <a href="${mainSheetUrl}" target="_blank" style="color: #1976d2; text-decoration: underline; margin-top: 10px; display: inline-block;">
                        ğŸ“Š Google Sheetsì—ì„œ í™•ì¸í•˜ê¸°
                    </a>
                `;
                
                document.getElementById('response').style.display = 'block';

                // ë“œë¡­ë‹¤ìš´ ì¡°íšŒ ë²„íŠ¼ ìˆ¨ê¹€ ì²˜ë¦¬
                queryButton.style.display = 'none';

            } catch (err) {
                console.error('Error fetching dropdown data (detailed):', err); // ìƒì„¸ ì˜¤ë¥˜ ì¶œë ¥
                document.getElementById('response').textContent = 'ë“œë¡­ë‹¤ìš´ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + (err.result?.error?.message || err.message || JSON.stringify(err));
                document.getElementById('response').style.display = 'block';

                // ì˜¤ë¥˜ ë°œìƒ ì‹œì—ë„ ë²„íŠ¼ ìˆ¨ê¹€ (ì¬ì‹œë„ëŠ” í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ìœ¼ë¡œ)
                const queryButton = document.getElementById('queryDropdownsButton');
                queryButton.style.display = 'none';
            }
        }

        /**
         * ë§¤ë‹ˆì € ë“œë¡­ë‹¤ìš´ì„ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
         * @param {Array<string>} managersList í‘œì‹œí•  ë§¤ë‹ˆì € ëª©ë¡
         */
        function updateManagerDropdown(managersList) {
            console.log('Updating Manager Dropdown with:', managersList); // ë§¤ë‹ˆì € ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸ ì „ ëª©ë¡ ì¶œë ¥
            const managerSelect = document.getElementById('manager');
            managerSelect.innerHTML = '<option value="">ì„ íƒí•˜ì„¸ìš”</option>'; // ê¸°ì¡´ ì˜µì…˜ ì œê±°
            
            // ì§ì ‘ì…ë ¥ ì˜µì…˜ì„ ë§¨ ìœ„ì— ì¶”ê°€
            const directInputOption = document.createElement('option');
            directInputOption.value = 'ì§ì ‘ì…ë ¥';
            directInputOption.textContent = 'ì§ì ‘ì…ë ¥';
            managerSelect.appendChild(directInputOption);
            
            // ë§¤ë‹ˆì € ëª©ë¡ ì¶”ê°€
            managersList.forEach(manager => {
                const option = document.createElement('option');
                option.value = manager;
                option.textContent = manager;
                managerSelect.appendChild(option);
            });
        }

        /**
         * ì‚¬ì´íŠ¸ ë“œë¡­ë‹¤ìš´ì„ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
         * @param {Array<string>} sitesList í‘œì‹œí•  ì‚¬ì´íŠ¸ ëª©ë¡
         */
        function updateSiteDropdown(sitesList) {
            console.log('Updating Site Dropdown with:', sitesList); // ì‚¬ì´íŠ¸ ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸ ì „ ëª©ë¡ ì¶œë ¥
            const siteSelect = document.getElementById('site_name');
            siteSelect.innerHTML = '<option value="">ì„ íƒí•˜ì„¸ìš”</option>'; // ê¸°ì¡´ ì˜µì…˜ ì œê±°

            let filteredSites = sitesList;

            // "ë‚´ ë‹´ë‹¹ ì‚¬ì´íŠ¸ë§Œ ë³´ê¸°" ì²´í¬ë°•ìŠ¤ê°€ ì²´í¬ëœ ê²½ìš° í•„í„°ë§
            const showMySitesOnly = document.getElementById('showMySitesOnly').checked;
            
            if (showMySitesOnly) {
                const selectedManager = getManagerValue();
                if (selectedManager && managerSiteMapping[selectedManager]) {
                    const managerSites = managerSiteMapping[selectedManager];
                    filteredSites = filteredSites.filter(site => 
                        managerSites.includes(site)
                    );
                    console.log('Filtered to manager sites only:', filteredSites.length, 'sites for', selectedManager);
                } else {
                    console.log('No manager selected or no mapping found, showing all sites');
                }
            }

            filteredSites.sort();

            filteredSites.forEach(site => {
                const option = document.createElement('option');
                option.value = site;
                
                // ê³ ê° ìš”ì²­ì‚¬í•­ ì…ë ¥ ë¶ˆê°€ ì‚¬ì´íŠ¸ì¸ ê²½ìš° "(í”„ë¡œì íŠ¸)" ì ‘ë‘ì‚¬ ì¶”ê°€
                if (sitesWithoutCustomerRequests.includes(site)) {
                    option.textContent = `(í”„ë¡œì íŠ¸) ${site}`;
                } else {
                    option.textContent = site;
                }
                
                siteSelect.appendChild(option);
            });
        }


        /**
         * ì„ íƒëœ ë§¤ë‹ˆì € ê°’ì„ ê°€ì ¸ì˜µë‹ˆë‹¤ (ë“œë¡­ë‹¤ìš´ ë˜ëŠ” ì§ì ‘ì…ë ¥).
         * @returns {string} ë§¤ë‹ˆì € ì´ë¦„ (ì—¬ëŸ¬ ëª…ì¸ ê²½ìš° ì¤„ë°”ê¿ˆìœ¼ë¡œ êµ¬ë¶„)
         */
        function getManagerValue() {
            const managerSelect = document.getElementById('manager');
            const directInput = document.getElementById('managerDirectInput');
            
            if (managerSelect.value === 'ì§ì ‘ì…ë ¥') {
                const inputValue = directInput.value.trim();
                if (inputValue === '') return '';
                
                // ì½¤ë§ˆë‚˜ ê³µë°±ìœ¼ë¡œ êµ¬ë¶„ëœ ì´ë¦„ë“¤ì„ ì¤„ë°”ê¿ˆìœ¼ë¡œ ë³€í™˜
                return inputValue.split(/[,\s]+/).filter(name => name.trim() !== '').join('\n');
            } else {
                return managerSelect.value;
            }
        }


        /**
         * ì„ íƒëœ ì‚¬ì´íŠ¸ì— ë”°ë¼ ê³ ê° ìš”ì²­ì‚¬í•­ í•„ë“œë¥¼ í™œì„±í™”/ë¹„í™œì„±í™”í•©ë‹ˆë‹¤.
         * @param {string} selectedSite ì„ íƒëœ ì‚¬ì´íŠ¸ëª…
         */
        function toggleCustomerRequestsField(selectedSite) {
            const customerRequestsContainer = document.getElementById('customer_requests_container');
            const customerRequestsLabel = document.querySelector('label[for="customer_requests"]');
            const noneCheckbox = document.getElementById('customer_requests_none');
            const addItemBtn = customerRequestsContainer.parentElement.querySelector('.add-item-btn');
            
            console.log('toggleCustomerRequestsField called with:', selectedSite);
            console.log('Checking if site is in exception list...');
            
            if (sitesWithoutCustomerRequests.includes(selectedSite)) {
                // ê³ ê° ìš”ì²­ì‚¬í•­ ì…ë ¥ ë¶ˆê°€ ì‚¬ì´íŠ¸ì¸ ê²½ìš°
                customerRequestsContainer.style.opacity = '0.5';
                customerRequestsContainer.style.pointerEvents = 'none';
                customerRequestsContainer.style.backgroundColor = '#f5f5f5';
                customerRequestsLabel.style.color = '#999';
                customerRequestsLabel.textContent = 'ê³ ê° ìš”ì²­ì‚¬í•­ (ì…ë ¥ ë¶ˆê°€)';
                
                // "ì—†ìŒ" ì²´í¬ë°•ìŠ¤ ë¹„í™œì„±í™”
                if (noneCheckbox) {
                    noneCheckbox.disabled = true;
                    noneCheckbox.checked = false;
                }
                
                // "í•­ëª© ì¶”ê°€" ë²„íŠ¼ ë¹„í™œì„±í™”
                if (addItemBtn) {
                    addItemBtn.disabled = true;
                }
                
                // ê¸°ì¡´ ê°’ ì´ˆê¸°í™”
                setListData('customer_requests_container', '');
            } else {
                // ì¼ë°˜ ì‚¬ì´íŠ¸ì¸ ê²½ìš°
                customerRequestsContainer.style.opacity = '1';
                customerRequestsContainer.style.pointerEvents = 'auto';
                customerRequestsContainer.style.backgroundColor = '';
                customerRequestsLabel.style.color = '';
                customerRequestsLabel.textContent = 'ê³ ê° ìš”ì²­ì‚¬í•­';
                
                // "ì—†ìŒ" ì²´í¬ë°•ìŠ¤ í™œì„±í™”
                if (noneCheckbox) {
                    noneCheckbox.disabled = false;
                }
                
                // "í•­ëª© ì¶”ê°€" ë²„íŠ¼ í™œì„±í™”
                if (addItemBtn) {
                    addItemBtn.disabled = false;
                }
            }
        }


        /**
         * ë³´ê³ ì„œ ì‹œíŠ¸ ì´ë¦„ ë“œë¡­ë‹¤ìš´ì„ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
         * @param {Array<{title: string, id: number}>} sheetNamesList í‘œì‹œí•  ì‹œíŠ¸ ì´ë¦„ ë° ID ëª©ë¡
         */
        function updateReportSheetNameDropdown(sheetNamesList) {
            console.log('Updating Report Sheet Name Dropdown with:', sheetNamesList); // ì‹œíŠ¸ ì´ë¦„ ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸ ì „ ëª©ë¡ ì¶œë ¥
            const reportSheetNameSelect = document.getElementById('reportSheetName');
            reportSheetNameSelect.innerHTML = '<option value="">ì„ íƒí•˜ì„¸ìš”</option>'; // ê¸°ì¡´ ì˜µì…˜ ì œê±°

            let filteredSheets = sheetNamesList;
            
            // showAllSheetsê°€ falseì¸ ê²½ìš° ì´ë²ˆ ì£¼ ì‘ì„± ì‹œíŠ¸ ê¸°ì¤€ìœ¼ë¡œ ê³¼ê±° 3ì£¼ì¹˜ë§Œ í‘œì‹œ
            if (!showAllSheets) {
                const thisWeekSheetName = getThisWeekSheetName();
                filteredSheets = filterSheetsByWeek(sheetNamesList, thisWeekSheetName);
            }

            // í•„í„°ë§ëœ ì‹œíŠ¸ ì´ë¦„ í‘œì‹œ
            filteredSheets.forEach(sheet => {
                const option = document.createElement('option');
                option.value = sheet.title;
                option.textContent = sheet.title;
                option.dataset.sheetId = sheet.id; // sheetIdë¥¼ data-sheet-id ì†ì„±ìœ¼ë¡œ ì €ì¥
                reportSheetNameSelect.appendChild(option);
            });

            // ì „ì²´ ì‹œíŠ¸ê°€ í•„í„°ë§ëœ ê²°ê³¼ë³´ë‹¤ ë§ê³  showAllSheetsê°€ falseì¸ ê²½ìš° "(ë”ë³´ê¸°)" ì˜µì…˜ ì¶”ê°€
            if (!showAllSheets && sheetNamesList.length > filteredSheets.length) {
                const moreOption = document.createElement('option');
                moreOption.value = 'more';
                moreOption.textContent = '(ë”ë³´ê¸°)';
                moreOption.style.fontStyle = 'italic';
                moreOption.style.color = '#666';
                reportSheetNameSelect.appendChild(moreOption);
            }
        }

        /**
         * ì´ë²ˆ ì£¼ ì‘ì„± ì‹œíŠ¸ ì´ë¦„ì„ ê³„ì‚°í•©ë‹ˆë‹¤.
         * @returns {string} ì´ë²ˆ ì£¼ ì‘ì„± ì‹œíŠ¸ ì´ë¦„ (YYYY-MM-DD í˜•ì‹)
         */
        function getThisWeekSheetName() {
            const today = new Date();
            const currentDay = today.getDay(); // 0=ì¼ìš”ì¼, 1=ì›”ìš”ì¼, ..., 4=ëª©ìš”ì¼, ..., 6=í† ìš”ì¼
            
            // ëª©ìš”ì¼ê¹Œì§€ì˜ ì¼ìˆ˜ ê³„ì‚° (ëª©ìš”ì¼ì´ 4)
            let daysToThursday = 4 - currentDay;
            if (daysToThursday < 0) {
                daysToThursday += 7; // ë‹¤ìŒ ì£¼ ëª©ìš”ì¼
            }
            
            // ì´ë²ˆ ì£¼ ëª©ìš”ì¼ ë‚ ì§œ ê³„ì‚°
            const thisWeekThursday = new Date(today);
            thisWeekThursday.setDate(today.getDate() + daysToThursday);
            
            // YYYY-MM-DD í˜•ì‹ìœ¼ë¡œ í¬ë§·
            const year = thisWeekThursday.getFullYear();
            const month = String(thisWeekThursday.getMonth() + 1).padStart(2, '0');
            const day = String(thisWeekThursday.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        /**
         * ì´ë²ˆ ì£¼ ì‘ì„± ì‹œíŠ¸ ê¸°ì¤€ìœ¼ë¡œ ê³¼ê±° 3ì£¼ì¹˜ ì‹œíŠ¸ë§Œ í•„í„°ë§í•©ë‹ˆë‹¤.
         * @param {Array<{title: string, id: number}>} sheetNamesList ì „ì²´ ì‹œíŠ¸ ëª©ë¡
         * @param {string} thisWeekSheetName ì´ë²ˆ ì£¼ ì‘ì„± ì‹œíŠ¸ ì´ë¦„
         * @returns {Array<{title: string, id: number}>} í•„í„°ë§ëœ ì‹œíŠ¸ ëª©ë¡
         */
        function filterSheetsByWeek(sheetNamesList, thisWeekSheetName) {
            const thisWeekDate = new Date(thisWeekSheetName);
            const threeWeeksAgo = new Date(thisWeekDate);
            threeWeeksAgo.setDate(thisWeekDate.getDate() - 21); // 3ì£¼ = 21ì¼ ì „
            
            return sheetNamesList.filter(sheet => {
                const sheetDate = new Date(sheet.title);
                // ì´ë²ˆ ì£¼ ì‹œíŠ¸ë¶€í„° 3ì£¼ ì „ê¹Œì§€ì˜ ì‹œíŠ¸ë§Œ í¬í•¨
                return sheetDate >= threeWeeksAgo && sheetDate <= thisWeekDate;
            });
        }

        /**
         * ì´ë²ˆ ì£¼ ì‘ì„± ì‹œíŠ¸ë¥¼ ê³„ì‚°í•˜ê³  í‘œì‹œí•©ë‹ˆë‹¤.
         * ëª©ìš”ì¼ ê¸°ì¤€ìœ¼ë¡œ ì´ë²ˆ ì£¼ ì‹œíŠ¸ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.
         */
        function updateWeeklySheetInfo() {
            const thisWeekSheetName = getThisWeekSheetName();
            
            // UIì— í‘œì‹œ
            const weeklySheetInfo = document.getElementById('weeklySheetInfo');
            const currentWeekSheet = document.getElementById('currentWeekSheet');
            
            if (weeklySheetInfo && currentWeekSheet) {
                currentWeekSheet.textContent = thisWeekSheetName;
                weeklySheetInfo.style.display = 'block';
                
                // í•´ë‹¹ ì‹œíŠ¸ê°€ ë“œë¡­ë‹¤ìš´ì— ìˆëŠ”ì§€ í™•ì¸í•˜ê³  ê°•ì¡° í‘œì‹œ
                const reportSheetSelect = document.getElementById('reportSheetName');
                const options = reportSheetSelect.querySelectorAll('option');
                let found = false;
                
                options.forEach(option => {
                    if (option.value === thisWeekSheetName) {
                        option.style.backgroundColor = '#e3f2fd';
                        option.style.fontWeight = 'bold';
                        found = true;
                    }
                });
                
                if (!found) {
                    // ì‹œíŠ¸ê°€ ì—†ìœ¼ë©´ ê²½ê³  í‘œì‹œ
                    weeklySheetInfo.style.backgroundColor = '#fff3cd';
                    weeklySheetInfo.style.borderColor = '#ffc107';
                    weeklySheetInfo.style.color = '#856404';
                    currentWeekSheet.innerHTML = `${thisWeekSheetName} <span style="color: #dc3545;">(ì‹œíŠ¸ ì—†ìŒ)</span>`;
                } else {
                    // ì‹œíŠ¸ê°€ ìˆìœ¼ë©´ ì •ìƒ í‘œì‹œ
                    weeklySheetInfo.style.backgroundColor = '#e3f2fd';
                    weeklySheetInfo.style.borderColor = '#2196f3';
                    weeklySheetInfo.style.color = '#1976d2';
                    currentWeekSheet.textContent = thisWeekSheetName;
                }
            }
        }


        // ë§¤ë‹ˆì € ë“œë¡­ë‹¤ìš´ ë³€ê²½ ì‹œ ë³´ê³ ì„œ ì¡°íšŒ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
        document.getElementById('manager').addEventListener('change', function() {
            const directInput = document.getElementById('managerDirectInput');
            if (this.value === 'ì§ì ‘ì…ë ¥') {
                directInput.style.display = 'block';
                directInput.focus();
            } else {
                directInput.style.display = 'none';
                directInput.value = '';
            }
            updateReadReportButtonState();
            updateLastWeekReportButtonState();
            
            // ë§¤ë‹ˆì € ë³€ê²½ ì‹œ ì‚¬ì´íŠ¸ ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸ (ì²´í¬ë°•ìŠ¤ ìƒíƒœ ë°˜ì˜)
            updateSiteDropdown(originalSites);
        });

        // ì§ì ‘ì…ë ¥ í•„ë“œ ë³€ê²½ ì‹œ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
        document.getElementById('managerDirectInput').addEventListener('input', function() {
            updateReadReportButtonState();
            updateLastWeekReportButtonState();
            
            // ì§ì ‘ì…ë ¥ ë³€ê²½ ì‹œ ì‚¬ì´íŠ¸ ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸ (ì²´í¬ë°•ìŠ¤ ìƒíƒœ ë°˜ì˜)
            updateSiteDropdown(originalSites);
        });

        // ì‚¬ì´íŠ¸ ë“œë¡­ë‹¤ìš´ ë³€ê²½ ì‹œ ë³´ê³ ì„œ ì¡°íšŒ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸ ë° ê³ ê° ìš”ì²­ì‚¬í•­ í•„ë“œ ìë™ í™œì„±í™”/ë¹„í™œì„±í™”
        document.getElementById('site_name').addEventListener('change', function() {
            const selectedSite = this.value;
            
            // ì‚¬ì´íŠ¸ ì„ íƒ ì‹œ ìë™ìœ¼ë¡œ ê³ ê° ìš”ì²­ì‚¬í•­ í•„ë“œ í™œì„±í™”/ë¹„í™œì„±í™”
            if (selectedSite) {
                toggleCustomerRequestsField(selectedSite);
            }
            
            updateReadReportButtonState();
            updateLastWeekReportButtonState();
        });

        // "ë‚´ ë‹´ë‹¹ ì‚¬ì´íŠ¸ë§Œ ë³´ê¸°" ì²´í¬ë°•ìŠ¤ ë³€ê²½ ì‹œ ì‚¬ì´íŠ¸ ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸
        document.getElementById('showMySitesOnly').addEventListener('change', function() {
            updateSiteDropdown(originalSites);
        });

        // ë³´ê³ ì„œ ì‹œíŠ¸ ì´ë¦„ ë“œë¡­ë‹¤ìš´ ë³€ê²½ ì‹œ ë³´ê³ ì„œ ì¡°íšŒ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
        document.getElementById('reportSheetName').addEventListener('change', function() {
            // "(ë”ë³´ê¸°)" ì˜µì…˜ì´ ì„ íƒëœ ê²½ìš° ì „ì²´ ì‹œíŠ¸ í‘œì‹œ
            if (this.value === 'more') {
                showAllSheets = true;
                updateReportSheetNameDropdown(originalReportSheetNames);
                this.value = ''; // ì„ íƒ ì´ˆê¸°í™”
                return;
            }
            
            updateReadReportButtonState();
            updateLastWeekReportButtonState();
        });


        // "ë³´ê³ ì„œ ì¡°íšŒ" ë²„íŠ¼ì˜ í™œì„±í™”/ë¹„í™œì„±í™” ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í•˜ëŠ” í—¬í¼ í•¨ìˆ˜
        function updateReadReportButtonState() {
            const managerValue = getManagerValue();
            const siteSelected = document.getElementById('site_name').value !== '';
            const reportSheetNameSelected = document.getElementById('reportSheetName').value !== '';
            const readReportButton = document.getElementById('readReportButton');

            if (managerValue !== '' && siteSelected && reportSheetNameSelected) {
                readReportButton.disabled = false;
                readReportButton.style.backgroundColor = '#4CAF50'; // ì›ë˜ ìƒ‰ìƒ
            } else {
                readReportButton.disabled = true;
                readReportButton.style.backgroundColor = '#cccccc'; // ë¹„í™œì„±í™” ìƒ‰ìƒ
            }
        }

        // "ì§€ë‚œ ì£¼ ë³´ê³ ì„œ ì¡°íšŒ" ë²„íŠ¼ì˜ í™œì„±í™”/ë¹„í™œì„±í™” ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í•˜ëŠ” í—¬í¼ í•¨ìˆ˜
        function updateLastWeekReportButtonState() {
            const managerValue = getManagerValue();
            const siteSelected = document.getElementById('site_name').value !== '';
            const reportSheetNameSelected = document.getElementById('reportSheetName').value !== '';
            const lastWeekReportButton = document.getElementById('readLastWeekReportButton');

            if (managerValue !== '' && siteSelected && reportSheetNameSelected) {
                lastWeekReportButton.disabled = false;
                lastWeekReportButton.style.backgroundColor = '#9C27B0'; // ë³´ë¼ìƒ‰ (ì§€ë‚œ ì£¼ ë³´ê³ ì„œ ì¡°íšŒ)
            } else {
                lastWeekReportButton.disabled = true;
                lastWeekReportButton.style.backgroundColor = '#cccccc'; // ë¹„í™œì„±í™” ìƒ‰ìƒ
            }
        }

        // 1ì£¼ì¼ ì´ì „ ë‚ ì§œë¥¼ ê³„ì‚°í•˜ëŠ” í•¨ìˆ˜ (YYYY-MM-DD í˜•ì‹)
        function getLastWeekDate(currentDateStr) {
            try {
                // í˜„ì¬ ë‚ ì§œ ë¬¸ìì—´ì„ Date ê°ì²´ë¡œ ë³€í™˜
                const currentDate = new Date(currentDateStr);
                
                // 1ì£¼ì¼(7ì¼) ì´ì „ ë‚ ì§œ ê³„ì‚°
                const lastWeekDate = new Date(currentDate);
                lastWeekDate.setDate(currentDate.getDate() - 7);
                
                // YYYY-MM-DD í˜•ì‹ìœ¼ë¡œ ë°˜í™˜
                const year = lastWeekDate.getFullYear();
                const month = String(lastWeekDate.getMonth() + 1).padStart(2, '0');
                const day = String(lastWeekDate.getDate()).padStart(2, '0');
                
                return `${year}-${month}-${day}`;
            } catch (error) {
                console.error('ë‚ ì§œ ê³„ì‚° ì˜¤ë¥˜:', error);
                return null;
            }
        }

        document.getElementById('reportForm').addEventListener('submit', async function(event) {
            event.preventDefault();

            // ì—”í„°í‚¤ë¡œ ì œì¶œë˜ëŠ” ê²ƒì„ ë°©ì§€ (ë²„íŠ¼ í´ë¦­ìœ¼ë¡œë§Œ ì œì¶œ)
            if (event.submitter === null) {
                console.log('Form submission blocked - only button clicks allowed');
                return;
            }

            if (!gapi.client.getToken()) {
                // í† í°ì´ ì—†ìœ¼ë©´ ìŠ¹ì¸ ìš”ì²­
                tokenClient.callback = async (resp) => {
                    if (resp.error !== undefined) {
                        throw (resp);
                    }
                    // í† í° íšë“ í›„ í¼ ì œì¶œ ì¬ì‹œë„
                    submitFormData(event); // event ê°ì²´ ì „ë‹¬
                };
                tokenClient.requestAccessToken();
            } else {
                // í† í°ì´ ìˆìœ¼ë©´ ë°”ë¡œ í¼ ì œì¶œ
                submitFormData(event); // event ê°ì²´ ì „ë‹¬
            }
        });

        async function submitFormData(event) {
            const formData = {
                site_name: document.getElementById('site_name').value,
                manager: getManagerValue(), // ì§ì ‘ì…ë ¥ ë˜ëŠ” ë“œë¡­ë‹¤ìš´ ì„ íƒ ê°’
                this_week_tasks: getListData('this_week_tasks_container'),
                next_week_tasks: getListData('next_week_tasks_container'),
                customer_requests: getListData('customer_requests_container')
            };

            console.log('Form Data:', formData);
            console.log('Sites without customer requests:', sitesWithoutCustomerRequests);
            console.log('Is current site in exception list?', sitesWithoutCustomerRequests.includes(formData.site_name));

            const responseDiv = document.getElementById('response');
            responseDiv.style.display = 'block';
            responseDiv.textContent = 'ë³´ê³ ì„œ ì œì¶œ ì¤‘...';

            // ë³´ê³ ì„œ ì‹œíŠ¸ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            // SPREADSHEET_IDëŠ” ìƒë‹¨ì—ì„œ í™˜ê²½ë³€ìˆ˜ë¡œ ì„¤ì •ë¨
            const REPORT_SHEET_NAME = document.getElementById('reportSheetName').value;
            const selectedOption = document.getElementById('reportSheetName').selectedOptions[0];
            const REPORT_SHEET_ID = selectedOption ? parseInt(selectedOption.dataset.sheetId) : null;
            
            // ë””ë²„ê¹…ì„ ìœ„í•œ ë¡œê·¸ ì¶”ê°€
            console.log('Submit Form Data - Debug Info:');
            console.log('SPREADSHEET_ID:', SPREADSHEET_ID);
            console.log('REPORT_SHEET_NAME:', REPORT_SHEET_NAME);
            console.log('selectedOption:', selectedOption);
            console.log('REPORT_SHEET_ID:', REPORT_SHEET_ID);
            console.log('selectedOption.dataset.sheetId:', selectedOption ? selectedOption.dataset.sheetId : 'N/A');
            
            // ì‹œíŠ¸ IDê°€ ì—†ìœ¼ë©´ ì˜¤ë¥˜ ì²˜ë¦¬
            if (!REPORT_SHEET_ID) {
                console.error('REPORT_SHEET_ID is null or undefined');
                responseDiv.textContent = 'ë³´ê³ ì„œ ì‹œíŠ¸ IDë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
                return;
            }

            // ìŠ¤í”„ë ˆë“œì‹œíŠ¸ì˜ ì—´ ìˆœì„œë¥¼ ì •ì˜í•©ë‹ˆë‹¤. SITEëª…, ë‹´ë‹¹ì, ê¸ˆì£¼ í•œ ì¼ ìˆœì„œì…ë‹ˆë‹¤.
            // ì‹¤ì œ ìŠ¤í”„ë ˆë“œì‹œíŠ¸ì˜ ì—´ ìˆœì„œì™€ ì¼ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤.
            const COLUMN_ORDER = ['SITEëª…', 'ë‹´ë‹¹ì', 'ê¸ˆì£¼ í•œ ì¼']; 

            try {
                // ì‹œíŠ¸ì˜ ì „ì²´ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                const response = await gapi.client.sheets.spreadsheets.values.get({
                    spreadsheetId: SPREADSHEET_ID,
                    range: `${REPORT_SHEET_NAME}!A:Z`, // ì¶©ë¶„íˆ ë„“ì€ ë²”ìœ„ë¡œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤ã€‚
                });

                const sheetData = response.result.values || [];

                // site_name ìœ„ì¹˜ ì°¾ê¸°
                const { row, col } = findCellCoordinates(sheetData, formData.site_name, REPORT_SHEET_NAME, COLUMN_ORDER);

                if (row === -1 || col === -1) {
                    throw new Error(`ë‹´ë‹¹ ì‚¬ì´íŠ¸ '${formData.site_name}'ë¥¼ ì‹œíŠ¸ì—ì„œ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
                }

                const updates = []; // values.batchUpdateë¥¼ ìœ„í•œ ì—…ë°ì´íŠ¸ ë°°ì—´

                // ëª¨ë“  ì…€ì— ì ìš©í•  ê³µí†µ ì„œì‹
                // const cellFormat = {
                //     textFormat: {
                //         fontSize: 11,
                //         bold: true,
                //         fontFamily: 'Arial' // í°íŠ¸ ë³€ì§ˆ ë°©ì§€ë¥¼ ìœ„í•´ Arial í°íŠ¸ ì§€ì •
                //     }
                // };

                // ë‹´ë‹¹ì ì…€ (site_name ì…€ì˜ í–‰ì€ ë™ì¼, ì—´ì€ ë°”ë¡œ ì˜¤ë¥¸ìª½)
                const managerColOffset = COLUMN_ORDER.indexOf('ë‹´ë‹¹ì');
                const managerRange = `'${REPORT_SHEET_NAME}'!${columnToLetter(col + managerColOffset)}${row + 1}`;
                updates.push({
                    range: managerRange,
                    values: [[formData.manager]]
                });

                // ê¸ˆì£¼ í•œ ì¼ ì…€ (site_name ì…€ì˜ í–‰ì€ ë™ì¼, ì—´ì€ 'ê¸ˆì£¼ í•œ ì¼'ì´ ìˆëŠ” ì—´)
                let thisWeekTasksRelativeOffset = COLUMN_ORDER.indexOf('ê¸ˆì£¼ í•œ ì¼');
                thisWeekTasksRelativeOffset += 1; // Nì—´ì—ì„œ Oì—´ë¡œ ì´ë™í•˜ê¸° ìœ„í•´ 1 ì¶”ê°€
                const thisWeekTasksRange = `'${REPORT_SHEET_NAME}'!${columnToLetter(col + thisWeekTasksRelativeOffset)}${row + 1}`;
                updates.push({
                    range: thisWeekTasksRange,
                    values: [[`â–¶ ${formData.this_week_tasks}`]]
                });

                // ì°¨ì£¼ í•  ì¼ ì…€ (site_name ì…€ì˜ í–‰ì€ ì•„ë˜ë¡œ 1ì¹¸, ì—´ì€ 'ê¸ˆì£¼ í•œ ì¼'ê³¼ ë™ì¼)
                const nextWeekTasksRange = `'${REPORT_SHEET_NAME}'!${columnToLetter(col + thisWeekTasksRelativeOffset)}${row + 2}`;
                updates.push({
                    range: nextWeekTasksRange,
                    values: [[`â–¶ ${formData.next_week_tasks}`]]
                });

                // ê³ ê° ìš”ì²­ì‚¬í•­ ì…€ (site_name ì…€ì˜ í–‰ì€ ì•„ë˜ë¡œ 2ì¹¸, ì—´ì€ 'ê¸ˆì£¼ í•œ ì¼'ê³¼ ë™ì¼)
                // ì˜ˆì™¸ ì‚¬ì´íŠ¸ê°€ ì•„ë‹Œ ê²½ìš°ì—ë§Œ ê³ ê° ìš”ì²­ì‚¬í•­ ì²˜ë¦¬
                if (formData.customer_requests && !sitesWithoutCustomerRequests.includes(formData.site_name)) {
                    const customerRequestsRange = `'${REPORT_SHEET_NAME}'!${columnToLetter(col + thisWeekTasksRelativeOffset)}${row + 3}`;
                    updates.push({
                        range: customerRequestsRange,
                        values: [[`â–¶ ${formData.customer_requests}`]]
                    });
                }

                // batchUpdate ìš”ì²­ (ì…€ ê°’ë§Œ ì—…ë°ì´íŠ¸, ì„œì‹ ìœ ì§€)
                await gapi.client.sheets.spreadsheets.values.batchUpdate({
                    spreadsheetId: SPREADSHEET_ID,
                    resource: {
                        data: updates,
                        valueInputOption: 'USER_ENTERED'
                    }
                });

                // Google Sheets ë§í¬ ìƒì„±
                const sheetUrl = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/edit#gid=${REPORT_SHEET_ID}`;
                
                // ì œì¶œ ì™„ë£Œ ëª¨ë‹¬ í‘œì‹œ
                showSubmitSuccessModal(sheetUrl);
                
                // ê¸°ì¡´ ì‘ë‹µ ì˜ì—­ ìˆ¨ê¹€
                responseDiv.style.display = 'none';

                // ë“œë¡­ë‹¤ìš´ ê°’ í™•ì¸
                console.log('Manager dropdown value:', document.getElementById('manager').value);
                console.log('Site dropdown value:', document.getElementById('site_name').value);
                console.log('Report Sheet Name dropdown value:', document.getElementById('reportSheetName').value);

                // ì œì¶œ í›„ì—ë„ ì…ë ¥ ë‚´ìš© ìœ ì§€ (ì´ˆê¸°í™”í•˜ì§€ ì•ŠìŒ)

            } catch (err) {
                console.error('Error submitting report:', err);
                responseDiv.textContent = 'ë³´ê³ ì„œ ì œì¶œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + (err.result?.error?.message || err.message);
            }
        }

        async function readReportData() {
            console.log('readReportData function called.');
            const readReportButton = document.getElementById('readReportButton');
            const responseDiv = document.getElementById('response');

            // ë²„íŠ¼ ìƒíƒœë¥¼ ë¡œë”© ì¤‘ìœ¼ë¡œ ë³€ê²½
            readReportButton.textContent = 'ë¡œë”© ì¤‘...';
            readReportButton.style.backgroundColor = '#ffc107'; // ë¡œë”© ì¤‘ ìƒ‰ìƒ (ì˜ˆ: ì£¼í™©ìƒ‰)
            readReportButton.disabled = true;
            responseDiv.style.display = 'block';
            responseDiv.textContent = 'ë³´ê³ ì„œ ë°ì´í„° ì¡°íšŒ ì¤‘...';

            // SPREADSHEET_IDëŠ” ìƒë‹¨ì—ì„œ í™˜ê²½ë³€ìˆ˜ë¡œ ì„¤ì •ë¨
            const managerValue = getManagerValue();
            const selectedSiteName = document.getElementById('site_name').value;
            const selectedReportSheetName = document.getElementById('reportSheetName').value;

            if (!managerValue || !selectedSiteName || !selectedReportSheetName) {
                responseDiv.textContent = 'ë§¤ë‹ˆì €, ë‹´ë‹¹ ì‚¬ì´íŠ¸, ë³´ê³ ì„œ ì‹œíŠ¸ ì´ë¦„ì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”.';
                readReportButton.textContent = 'ë³´ê³ ì„œ ì¡°íšŒ';
                readReportButton.style.backgroundColor = '#4CAF50';
                readReportButton.disabled = false;
                return;
            }

            // ìŠ¤í”„ë ˆë“œì‹œíŠ¸ì˜ ì—´ ìˆœì„œë¥¼ ì •ì˜í•©ë‹ˆë‹¤. (ë°ì´í„° ì“°ê¸°ì™€ ë™ì¼)
            const COLUMN_ORDER = ['SITEëª…', 'ë‹´ë‹¹ì', 'ê¸ˆì£¼ í•œ ì¼'];

            try {
                // ì‹œíŠ¸ì˜ ì „ì²´ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (site_name ìœ„ì¹˜ ì°¾ê¸° ìœ„í•¨)
                const response = await gapi.client.sheets.spreadsheets.values.get({
                    spreadsheetId: SPREADSHEET_ID,
                    range: `${selectedReportSheetName}!A:Z`,
                });
                const sheetData = response.result.values || [];

                // site_name ìœ„ì¹˜ ì°¾ê¸°
                const { row, col } = findCellCoordinates(sheetData, selectedSiteName, selectedReportSheetName, COLUMN_ORDER);

                if (row === -1 || col === -1) {
                    throw new Error(`ë‹´ë‹¹ ì‚¬ì´íŠ¸ '${selectedSiteName}'ë¥¼ ì‹œíŠ¸ì—ì„œ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
                }

                // ì½ì–´ì˜¬ ì…€ ë²”ìœ„ ê³„ì‚° (ì“°ê¸° ìœ„ì¹˜ì™€ ë™ì¼í•˜ê²Œ)
                let thisWeekTasksRelativeOffset = COLUMN_ORDER.indexOf('ê¸ˆì£¼ í•œ ì¼');
                thisWeekTasksRelativeOffset += 1; // Oì—´ë¡œ ì´ë™í•˜ê¸° ìœ„í•´ 1 ì¶”ê°€

                // ì˜ˆì™¸ ì‚¬ì´íŠ¸ì— ë”°ë¼ ì½ì–´ì˜¬ ë²”ìœ„ ê²°ì •
                const rangesToRead = [
                    `'${selectedReportSheetName}'!${columnToLetter(col + thisWeekTasksRelativeOffset)}${row + 1}`, // ê¸ˆì£¼ í•œ ì¼
                    `'${selectedReportSheetName}'!${columnToLetter(col + thisWeekTasksRelativeOffset)}${row + 2}`  // ì°¨ì£¼ í•  ì¼
                ];
                
                // ì˜ˆì™¸ ì‚¬ì´íŠ¸ê°€ ì•„ë‹Œ ê²½ìš°ì—ë§Œ ê³ ê° ìš”ì²­ì‚¬í•­ ë²”ìœ„ ì¶”ê°€
                if (!sitesWithoutCustomerRequests.includes(selectedSiteName)) {
                    rangesToRead.push(`'${selectedReportSheetName}'!${columnToLetter(col + thisWeekTasksRelativeOffset)}${row + 3}`); // ê³ ê° ìš”ì²­ì‚¬í•­
                }

                console.log('Reading data from ranges:', rangesToRead);

                const readResponse = await gapi.client.sheets.spreadsheets.values.batchGet({
                    spreadsheetId: SPREADSHEET_ID,
                    ranges: rangesToRead,
                });
                console.log('Read API Response:', readResponse);

                const values = readResponse.result.valueRanges || [];

                // ë¦¬ìŠ¤íŠ¸ í•„ë“œì— ë°ì´í„° ì¶œë ¥ (â–¶ëŠ” setListDataì—ì„œ ìë™ ì œê±°ë¨)
                const thisWeekTasks = (values[0] && values[0].values && values[0].values[0]) ? values[0].values[0][0] : '';
                const nextWeekTasks = (values[1] && values[1].values && values[1].values[0]) ? values[1].values[0][0] : '';
                setListData('this_week_tasks_container', thisWeekTasks);
                setListData('next_week_tasks_container', nextWeekTasks);
                
                // ì˜ˆì™¸ ì‚¬ì´íŠ¸ê°€ ì•„ë‹Œ ê²½ìš°ì—ë§Œ ê³ ê° ìš”ì²­ì‚¬í•­ ì½ê¸°
                if (!sitesWithoutCustomerRequests.includes(selectedSiteName)) {
                    // ì˜ˆì™¸ ì‚¬ì´íŠ¸ê°€ ì•„ë‹Œ ê²½ìš° values[2]ê°€ ê³ ê° ìš”ì²­ì‚¬í•­
                    const customerRequests = (values[2] && values[2].values && values[2].values[0]) ? values[2].values[0][0] : '';
                    setListData('customer_requests_container', customerRequests);
                } else {
                    setListData('customer_requests_container', ''); // ì˜ˆì™¸ ì‚¬ì´íŠ¸ëŠ” ë¹ˆ ê°’ìœ¼ë¡œ ì„¤ì •
                }

                // Google Sheets ë§í¬ ìƒì„± (ì„ íƒëœ ë³´ê³ ì„œ ì‹œíŠ¸ì— ë”°ë¼)
                const selectedOption = document.getElementById('reportSheetName').selectedOptions[0];
                const reportSheetId = selectedOption ? selectedOption.dataset.sheetId : '';
                const sheetUrl = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/edit#gid=${reportSheetId}`;
                responseDiv.innerHTML = `
                    ë³´ê³ ì„œ ë°ì´í„°ë¥¼ ì„±ê³µì ìœ¼ë¡œ ì¡°íšŒí–ˆìŠµë‹ˆë‹¤!<br>
                    <a href="${sheetUrl}" target="_blank" style="color: #1976d2; text-decoration: underline; margin-top: 10px; display: inline-block;">
                        ğŸ“Š Google Sheetsì—ì„œ í™•ì¸í•˜ê¸°
                    </a>
                `;
                readReportButton.textContent = 'ì¡°íšŒ ì™„ë£Œ';
                readReportButton.style.backgroundColor = '#6c757d';
                // ì¡°íšŒ ì™„ë£Œ í›„ì—ë„ ë‹¤ì‹œ ì¡°íšŒí•  ìˆ˜ ìˆë„ë¡ í™œì„±í™” ìƒíƒœ ìœ ì§€
                readReportButton.disabled = false; 

                // 3ì´ˆ ë’¤ ë²„íŠ¼ ìƒíƒœ ì´ˆê¸°í™”
                setTimeout(() => {
                    readReportButton.textContent = 'ë³´ê³ ì„œ ì¡°íšŒ';
                    readReportButton.style.backgroundColor = '#4CAF50'; // ì›ë˜ ìƒ‰ìƒ
                    readReportButton.disabled = false;
                }, 3000); // 3ì´ˆ (3000ms)

            } catch (err) {
                console.error('Error reading report data:', err);
                responseDiv.textContent = 'ë³´ê³ ì„œ ë°ì´í„° ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + (err.result?.error?.message || err.message || JSON.stringify(err));
                readReportButton.textContent = 'ë³´ê³ ì„œ ì¡°íšŒ';
                readReportButton.style.backgroundColor = '#dc3545'; // ì˜¤ë¥˜ ì‹œ ë¹¨ê°„ìƒ‰
                readReportButton.disabled = false;
            }
        }

        document.getElementById('queryDropdownsButton').addEventListener('click', populateDropdowns);

        // ì§€ë‚œ ì£¼ ë³´ê³ ì„œ ì¡°íšŒ í•¨ìˆ˜
        async function readLastWeekReportData() {
            console.log('readLastWeekReportData function called.');
            const lastWeekReportButton = document.getElementById('readLastWeekReportButton');
            const responseDiv = document.getElementById('response');

            // ë²„íŠ¼ ìƒíƒœë¥¼ ë¡œë”© ì¤‘ìœ¼ë¡œ ë³€ê²½
            lastWeekReportButton.textContent = 'ë¡œë”© ì¤‘...';
            lastWeekReportButton.style.backgroundColor = '#ffc107'; // ë¡œë”© ì¤‘ ìƒ‰ìƒ (ì˜ˆ: ì£¼í™©ìƒ‰)
            lastWeekReportButton.disabled = true;
            responseDiv.style.display = 'block';
            responseDiv.textContent = 'ì§€ë‚œ ì£¼ ë³´ê³ ì„œ ë°ì´í„° ì¡°íšŒ ì¤‘...';

            // SPREADSHEET_IDëŠ” ìƒë‹¨ì—ì„œ í™˜ê²½ë³€ìˆ˜ë¡œ ì„¤ì •ë¨
            const managerValue = getManagerValue();
            const selectedSiteName = document.getElementById('site_name').value;
            const selectedReportSheetName = document.getElementById('reportSheetName').value;

            if (!managerValue || !selectedSiteName || !selectedReportSheetName) {
                responseDiv.textContent = 'ë§¤ë‹ˆì €, ë‹´ë‹¹ ì‚¬ì´íŠ¸, ë³´ê³ ì„œ ì‹œíŠ¸ ì´ë¦„ì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”.';
                lastWeekReportButton.textContent = 'ì§€ë‚œ ì£¼ ë³´ê³ ì„œ ì¡°íšŒ';
                lastWeekReportButton.style.backgroundColor = '#9C27B0';
                lastWeekReportButton.disabled = false;
                return;
            }

            // 1ì£¼ì¼ ì´ì „ ì‹œíŠ¸ ì´ë¦„ ê³„ì‚°
            const lastWeekSheetName = getLastWeekDate(selectedReportSheetName);
            if (!lastWeekSheetName) {
                responseDiv.textContent = 'ì§€ë‚œ ì£¼ ì‹œíŠ¸ ì´ë¦„ì„ ê³„ì‚°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
                lastWeekReportButton.textContent = 'ì§€ë‚œ ì£¼ ë³´ê³ ì„œ ì¡°íšŒ';
                lastWeekReportButton.style.backgroundColor = '#dc3545';
                lastWeekReportButton.disabled = false;
                return;
            }

            // ìŠ¤í”„ë ˆë“œì‹œíŠ¸ì˜ ì—´ ìˆœì„œë¥¼ ì •ì˜í•©ë‹ˆë‹¤. (ë°ì´í„° ì“°ê¸°ì™€ ë™ì¼)
            const COLUMN_ORDER = ['SITEëª…', 'ë‹´ë‹¹ì', 'ê¸ˆì£¼ í•œ ì¼'];

            try {
                // ì§€ë‚œ ì£¼ ì‹œíŠ¸ì˜ ì „ì²´ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (site_name ìœ„ì¹˜ ì°¾ê¸° ìœ„í•¨)
                const response = await gapi.client.sheets.spreadsheets.values.get({
                    spreadsheetId: SPREADSHEET_ID,
                    range: `${lastWeekSheetName}!A:Z`,
                });
                const sheetData = response.result.values || [];

                // site_name ìœ„ì¹˜ ì°¾ê¸°
                const { row, col } = findCellCoordinates(sheetData, selectedSiteName, lastWeekSheetName, COLUMN_ORDER);

                if (row === -1 || col === -1) {
                    throw new Error(`ë‹´ë‹¹ ì‚¬ì´íŠ¸ '${selectedSiteName}'ë¥¼ ì§€ë‚œ ì£¼ ì‹œíŠ¸ '${lastWeekSheetName}'ì—ì„œ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
                }

                // ì½ì–´ì˜¬ ì…€ ë²”ìœ„ ê³„ì‚° (ì“°ê¸° ìœ„ì¹˜ì™€ ë™ì¼í•˜ê²Œ)
                let thisWeekTasksRelativeOffset = COLUMN_ORDER.indexOf('ê¸ˆì£¼ í•œ ì¼');
                thisWeekTasksRelativeOffset += 1; // Oì—´ë¡œ ì´ë™í•˜ê¸° ìœ„í•´ 1 ì¶”ê°€

                // ì˜ˆì™¸ ì‚¬ì´íŠ¸ì— ë”°ë¼ ì½ì–´ì˜¬ ë²”ìœ„ ê²°ì •
                const rangesToRead = [
                    `'${lastWeekSheetName}'!${columnToLetter(col + thisWeekTasksRelativeOffset)}${row + 1}`, // ê¸ˆì£¼ í•œ ì¼
                    `'${lastWeekSheetName}'!${columnToLetter(col + thisWeekTasksRelativeOffset)}${row + 2}`  // ì°¨ì£¼ í•  ì¼
                ];
                
                // ì˜ˆì™¸ ì‚¬ì´íŠ¸ê°€ ì•„ë‹Œ ê²½ìš°ì—ë§Œ ê³ ê° ìš”ì²­ì‚¬í•­ ë²”ìœ„ ì¶”ê°€
                if (!sitesWithoutCustomerRequests.includes(selectedSiteName)) {
                    rangesToRead.push(`'${lastWeekSheetName}'!${columnToLetter(col + thisWeekTasksRelativeOffset)}${row + 3}`); // ê³ ê° ìš”ì²­ì‚¬í•­
                }

                console.log('Reading last week data from ranges:', rangesToRead);

                const readResponse = await gapi.client.sheets.spreadsheets.values.batchGet({
                    spreadsheetId: SPREADSHEET_ID,
                    ranges: rangesToRead,
                });
                console.log('Read Last Week API Response:', readResponse);

                const values = readResponse.result.valueRanges || [];

                // ë¦¬ìŠ¤íŠ¸ í•„ë“œì— ë°ì´í„° ì¶œë ¥ (â–¶ëŠ” setListDataì—ì„œ ìë™ ì œê±°ë¨)
                const thisWeekTasks = (values[0] && values[0].values && values[0].values[0]) ? values[0].values[0][0] : '';
                const nextWeekTasks = (values[1] && values[1].values && values[1].values[0]) ? values[1].values[0][0] : '';
                setListData('this_week_tasks_container', thisWeekTasks);
                setListData('next_week_tasks_container', nextWeekTasks);
                
                // ì˜ˆì™¸ ì‚¬ì´íŠ¸ê°€ ì•„ë‹Œ ê²½ìš°ì—ë§Œ ê³ ê° ìš”ì²­ì‚¬í•­ ì½ê¸°
                if (!sitesWithoutCustomerRequests.includes(selectedSiteName)) {
                    // ì˜ˆì™¸ ì‚¬ì´íŠ¸ê°€ ì•„ë‹Œ ê²½ìš° values[2]ê°€ ê³ ê° ìš”ì²­ì‚¬í•­
                    const customerRequests = (values[2] && values[2].values && values[2].values[0]) ? values[2].values[0][0] : '';
                    setListData('customer_requests_container', customerRequests);
                } else {
                    setListData('customer_requests_container', ''); // ì˜ˆì™¸ ì‚¬ì´íŠ¸ëŠ” ë¹ˆ ê°’ìœ¼ë¡œ ì„¤ì •
                }

                // Google Sheets ë§í¬ ìƒì„± (ì§€ë‚œ ì£¼ ë³´ê³ ì„œ ì‹œíŠ¸ì— ë”°ë¼)
                const selectedOption = document.getElementById('reportSheetName').selectedOptions[0];
                const reportSheetId = selectedOption ? selectedOption.dataset.sheetId : '';
                const sheetUrl = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/edit#gid=${reportSheetId}`;
                responseDiv.innerHTML = `
                    ì§€ë‚œ ì£¼ ë³´ê³ ì„œ ë°ì´í„°ë¥¼ ì„±ê³µì ìœ¼ë¡œ ì¡°íšŒí–ˆìŠµë‹ˆë‹¤! (${lastWeekSheetName})<br>
                    <a href="${sheetUrl}" target="_blank" style="color: #1976d2; text-decoration: underline; margin-top: 10px; display: inline-block;">
                        ğŸ“Š Google Sheetsì—ì„œ í™•ì¸í•˜ê¸°
                    </a>
                `;
                lastWeekReportButton.textContent = 'ì¡°íšŒ ì™„ë£Œ';
                lastWeekReportButton.style.backgroundColor = '#6c757d';
                // ì¡°íšŒ ì™„ë£Œ í›„ì—ë„ ë‹¤ì‹œ ì¡°íšŒí•  ìˆ˜ ìˆë„ë¡ í™œì„±í™” ìƒíƒœ ìœ ì§€
                lastWeekReportButton.disabled = false; 

                // 3ì´ˆ ë’¤ ë²„íŠ¼ ìƒíƒœ ì´ˆê¸°í™”
                setTimeout(() => {
                    lastWeekReportButton.textContent = 'ì§€ë‚œ ì£¼ ë³´ê³ ì„œ ì¡°íšŒ';
                    lastWeekReportButton.style.backgroundColor = '#9C27B0'; // ë³´ë¼ìƒ‰ (ì§€ë‚œ ì£¼ ë³´ê³ ì„œ ì¡°íšŒ)
                    lastWeekReportButton.disabled = false;
                }, 3000); // 3ì´ˆ (3000ms)

            } catch (err) {
                console.error('Error reading last week report data:', err);
                responseDiv.textContent = 'ì§€ë‚œ ì£¼ ë³´ê³ ì„œ ë°ì´í„° ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + (err.result?.error?.message || err.message || JSON.stringify(err));
                lastWeekReportButton.textContent = 'ì§€ë‚œ ì£¼ ë³´ê³ ì„œ ì¡°íšŒ';
                lastWeekReportButton.style.backgroundColor = '#dc3545'; // ì˜¤ë¥˜ ì‹œ ë¹¨ê°„ìƒ‰
                lastWeekReportButton.disabled = false;
            }
        }

        // ë³´ê³ ì„œ ì¡°íšŒ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.getElementById('readReportButton').addEventListener('click', readReportData);

        // ì§€ë‚œ ì£¼ ë³´ê³ ì„œ ì¡°íšŒ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.getElementById('readLastWeekReportButton').addEventListener('click', readLastWeekReportData);

        // ì œì¶œ ì™„ë£Œ ëª¨ë‹¬ ê´€ë ¨ í•¨ìˆ˜
        function showSubmitSuccessModal(sheetUrl) {
            const modal = document.getElementById('submitSuccessModal');
            const linkDiv = document.getElementById('submitSuccessSheetLink');
            
            // Google Sheets ë§í¬ ì„¤ì •
            linkDiv.innerHTML = `
                <a href="${sheetUrl}" target="_blank" style="
                    color: #4CAF50;
                    text-decoration: none;
                    font-weight: bold;
                    display: inline-flex;
                    align-items: center;
                    gap: 8px;
                    padding: 10px 20px;
                    border: 2px solid #4CAF50;
                    border-radius: 5px;
                    transition: all 0.3s ease;
                " onmouseover="this.style.background='#4CAF50'; this.style.color='white'" 
                   onmouseout="this.style.background='transparent'; this.style.color='#4CAF50'">
                    ğŸ“Š Google Sheetsì—ì„œ í™•ì¸í•˜ê¸°
                </a>
            `;
            
            modal.style.display = 'block';
        }

        function closeSubmitSuccessModal() {
            const modal = document.getElementById('submitSuccessModal');
            modal.style.display = 'none';
        }

        // ì‚¬ìš©ë²• íŒì—… ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        const helpButton = document.getElementById('helpButton');
        const helpModal = document.getElementById('helpModal');
        const closeButton = document.querySelector('.close');

        helpButton.addEventListener('click', function() {
            helpModal.style.display = 'block';
        });

        closeButton.addEventListener('click', function() {
            helpModal.style.display = 'none';
        });

        // ë°°ê²½ í´ë¦­ ì‹œ ëª¨ë‹¬ ë‹«ê¸°
        window.addEventListener('click', function(event) {
            const submitSuccessModal = document.getElementById('submitSuccessModal');
            
            if (event.target === helpModal) {
                helpModal.style.display = 'none';
            }
            if (event.target === submitSuccessModal) {
                closeSubmitSuccessModal();
            }
        });

        // ESC í‚¤ë¡œ ëª¨ë‹¬ ë‹«ê¸°
        document.addEventListener('keydown', function(event) {
            const submitSuccessModal = document.getElementById('submitSuccessModal');
            
            if (event.key === 'Escape' && helpModal.style.display === 'block') {
                helpModal.style.display = 'none';
            }
            if (event.key === 'Escape' && submitSuccessModal.style.display === 'block') {
                closeSubmitSuccessModal();
            }
        });

        // í¼ ë‚´ë¶€ì—ì„œ ì—”í„°í‚¤ë¡œ ì œì¶œë˜ëŠ” ê²ƒì„ ë°©ì§€ (ë°ìŠ¤í¬í†± + ëª¨ë°”ì¼)
        document.getElementById('reportForm').addEventListener('keydown', function(event) {
            if (event.key === 'Enter') {
                // INPUT í•„ë“œì—ì„œë§Œ ì—”í„°í‚¤ ì œì¶œ ë°©ì§€, TEXTAREAëŠ” í—ˆìš©
                if (event.target.tagName === 'INPUT') {
                    event.preventDefault();
                    console.log('Enter key submission blocked in input fields');
                }
            }
        });

        // ëª¨ë°”ì¼ì—ì„œ ê°€ìƒ í‚¤ë³´ë“œì˜ "ì™„ë£Œ" ë²„íŠ¼ìœ¼ë¡œ ì œì¶œë˜ëŠ” ê²ƒì„ ë°©ì§€
        document.getElementById('reportForm').addEventListener('keypress', function(event) {
            if (event.key === 'Enter' || event.keyCode === 13) {
                // INPUT í•„ë“œì—ì„œë§Œ ì œì¶œ ë°©ì§€, TEXTAREAëŠ” ì¤„ë°”ê¿ˆ í—ˆìš©
                if (event.target.tagName === 'INPUT') {
                    event.preventDefault();
                    console.log('Mobile keyboard submission blocked in input fields');
                }
            }
        });


        // ë¦¬ìŠ¤íŠ¸ ë°ì´í„° ë³µì‚¬ í•¨ìˆ˜
        async function copyListData(containerId) {
            try {
                const listData = getListData(containerId);
                
                if (!listData || listData.trim() === '') {
                    alert('ë³µì‚¬í•  ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }
                
                await navigator.clipboard.writeText(listData);
                
                // ë³µì‚¬ ë²„íŠ¼ ì‹œê°ì  í”¼ë“œë°±
                const copyBtn = document.querySelector(`#${containerId} .copy-btn`);
                const originalText = copyBtn.innerHTML;
                const originalClass = copyBtn.className;
                
                copyBtn.innerHTML = 'âœ“';
                copyBtn.className = 'copy-btn copied';
                
                // 2ì´ˆ í›„ ì›ë˜ ìƒíƒœë¡œ ë³µì›
                setTimeout(() => {
                    copyBtn.innerHTML = originalText;
                    copyBtn.className = originalClass;
                }, 2000);
                
                console.log('ë³µì‚¬ëœ ë‚´ìš©:', listData);
                
            } catch (err) {
                console.error('ë³µì‚¬ ì‹¤íŒ¨:', err);
                alert('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì €ê°€ í´ë¦½ë³´ë“œ ì ‘ê·¼ì„ ì§€ì›í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
            }
        }

        // ë¦¬ìŠ¤íŠ¸ ë°ì´í„° ë¶™ì—¬ë„£ê¸° í•¨ìˆ˜
        async function pasteListData(containerId) {
            try {
                const pasteBtn = document.querySelector(`#${containerId} .paste-btn`);
                
                // í´ë¦½ë³´ë“œ ì½ê¸° ì‹œë„
                let clipboardText = '';
                try {
                    clipboardText = await navigator.clipboard.readText();
                } catch (clipboardErr) {
                    console.warn('í´ë¦½ë³´ë“œ ì½ê¸° ì‹¤íŒ¨, ì‚¬ìš©ì ì…ë ¥ ë°©ì‹ìœ¼ë¡œ ì „í™˜:', clipboardErr);
                    
                    // Fallback: ì‚¬ìš©ìì—ê²Œ ì§ì ‘ ì…ë ¥ ìš”ì²­
                    const userInput = prompt('ë¶™ì—¬ë„£ê¸°í•  ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš” (Ctrl+Vë¡œ ë¶™ì—¬ë„£ê¸° ê°€ëŠ¥):');
                    if (userInput === null) {
                        return; // ì‚¬ìš©ìê°€ ì·¨ì†Œí•œ ê²½ìš°
                    }
                    clipboardText = userInput;
                }
                
                if (!clipboardText || clipboardText.trim() === '') {
                    alert('ë¶™ì—¬ë„£ê¸°í•  ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }
                
                // í´ë¦½ë³´ë“œ ë‚´ìš©ì„ ë¦¬ìŠ¤íŠ¸ë¡œ íŒŒì‹±í•˜ì—¬ ì„¤ì •
                setListData(containerId, clipboardText);
                
                // ë¶™ì—¬ë„£ê¸° ë²„íŠ¼ ì‹œê°ì  í”¼ë“œë°±
                const originalText = pasteBtn.innerHTML;
                const originalClass = pasteBtn.className;
                
                pasteBtn.innerHTML = 'âœ“';
                pasteBtn.className = 'paste-btn pasted';
                
                // 2ì´ˆ í›„ ì›ë˜ ìƒíƒœë¡œ ë³µì›
                setTimeout(() => {
                    pasteBtn.innerHTML = originalText;
                    pasteBtn.className = originalClass;
                }, 2000);
                
                console.log('ë¶™ì—¬ë„£ê¸°ëœ ë‚´ìš©:', clipboardText);
                
            } catch (err) {
                console.error('ë¶™ì—¬ë„£ê¸° ì‹¤íŒ¨:', err);
                alert('ë¶™ì—¬ë„£ê¸°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            }
        }

        // ê°œë³„ ë¦¬ìŠ¤íŠ¸ í•­ëª© ë³µì‚¬ í•¨ìˆ˜
        async function copyListItemData(button) {
            try {
                const listItem = button.closest('.list-input-item');
                const input = listItem.querySelector('.list-input');
                const dateInput = listItem.querySelector('.date-input');
                
                let itemData = input.value.trim();
                
                // ê³ ê° ìš”ì²­ì‚¬í•­ì¸ ê²½ìš° ë‚ ì§œ ì •ë³´ ì¶”ê°€
                if (dateInput && dateInput.value) {
                    const date = new Date(dateInput.value);
                    const formattedDate = `${date.getFullYear().toString().slice(-2)}.${(date.getMonth() + 1).toString().padStart(2, '0')}.${date.getDate().toString().padStart(2, '0')}`;
                    itemData = `(ë°œìƒì¼ : ${formattedDate}) ${itemData}`;
                }
                
                // ì‘ì—… ëŒ€ìƒ ì²´í¬ë°•ìŠ¤ ì •ë³´ëŠ” ë³µì‚¬ ì‹œ ì œì™¸ (ì‚¬ìš©ì ìš”ì²­ì— ë”°ë¼)
                // const checkboxes = listItem.querySelectorAll('input[type="checkbox"]:checked');
                // if (checkboxes.length > 0) {
                //     const targets = Array.from(checkboxes).map(cb => cb.value).join(',');
                //     itemData = `[${targets}] ${itemData}`;
                // }
                
                if (!itemData) {
                    alert('ë³µì‚¬í•  ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }
                
                await navigator.clipboard.writeText(itemData);
                
                // ë³µì‚¬ ë²„íŠ¼ ì‹œê°ì  í”¼ë“œë°±
                const originalText = button.innerHTML;
                const originalClass = button.className;
                
                button.innerHTML = 'âœ“';
                button.className = 'copy-btn copied';
                
                // 2ì´ˆ í›„ ì›ë˜ ìƒíƒœë¡œ ë³µì›
                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.className = originalClass;
                }, 2000);
                
                console.log('ë³µì‚¬ëœ í•­ëª© ë‚´ìš©:', itemData);
                
            } catch (err) {
                console.error('í•­ëª© ë³µì‚¬ ì‹¤íŒ¨:', err);
                alert('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì €ê°€ í´ë¦½ë³´ë“œ ì ‘ê·¼ì„ ì§€ì›í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
            }
        }

        // ê°œë³„ ë¦¬ìŠ¤íŠ¸ í•­ëª© ë¶™ì—¬ë„£ê¸° í•¨ìˆ˜
        async function pasteListItemData(button) {
            try {
                const listItem = button.closest('.list-input-item');
                const input = listItem.querySelector('.list-input');
                
                // í´ë¦½ë³´ë“œ ì½ê¸° ì‹œë„
                let clipboardText = '';
                try {
                    clipboardText = await navigator.clipboard.readText();
                } catch (clipboardErr) {
                    console.warn('í´ë¦½ë³´ë“œ ì½ê¸° ì‹¤íŒ¨, ì‚¬ìš©ì ì…ë ¥ ë°©ì‹ìœ¼ë¡œ ì „í™˜:', clipboardErr);
                    
                    // Fallback: ì‚¬ìš©ìì—ê²Œ ì§ì ‘ ì…ë ¥ ìš”ì²­
                    const userInput = prompt('ë¶™ì—¬ë„£ê¸°í•  ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš” (Ctrl+Vë¡œ ë¶™ì—¬ë„£ê¸° ê°€ëŠ¥):');
                    if (userInput === null) {
                        return; // ì‚¬ìš©ìê°€ ì·¨ì†Œí•œ ê²½ìš°
                    }
                    clipboardText = userInput;
                }
                
                if (!clipboardText || clipboardText.trim() === '') {
                    alert('ë¶™ì—¬ë„£ê¸°í•  ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }
                
                // í´ë¦½ë³´ë“œ ë‚´ìš©ì„ ì…ë ¥ì°½ì— ì„¤ì •
                input.value = clipboardText.trim();
                
                // ë¶™ì—¬ë„£ê¸° ë²„íŠ¼ ì‹œê°ì  í”¼ë“œë°±
                const originalText = button.innerHTML;
                const originalClass = button.className;
                
                button.innerHTML = 'âœ“';
                button.className = 'paste-btn pasted';
                
                // 2ì´ˆ í›„ ì›ë˜ ìƒíƒœë¡œ ë³µì›
                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.className = originalClass;
                }, 2000);
                
                console.log('ë¶™ì—¬ë„£ê¸°ëœ í•­ëª© ë‚´ìš©:', clipboardText);
                
            } catch (err) {
                console.error('í•­ëª© ë¶™ì—¬ë„£ê¸° ì‹¤íŒ¨:', err);
                alert('ë¶™ì—¬ë„£ê¸°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            }
        }

        // ì„¹ì…˜ í™œì„±í™”/ë¹„í™œì„±í™” í•¨ìˆ˜
        function toggleSection(containerId, isChecked) {
            const container = document.getElementById(containerId);
            const addButton = container.nextElementSibling;
            
            if (isChecked) {
                // "ì—†ìŒ" ì²´í¬ ì‹œ ì„¹ì…˜ ë¹„í™œì„±í™”
                container.classList.add('section-disabled');
                if (addButton && addButton.classList.contains('add-item-btn')) {
                    addButton.style.display = 'none';
                }
                // ê¸°ì¡´ ë‚´ìš© ì´ˆê¸°í™”
                container.innerHTML = '';
            } else {
                // "ì—†ìŒ" ì²´í¬ í•´ì œ ì‹œ ì„¹ì…˜ í™œì„±í™”
                container.classList.remove('section-disabled');
                if (addButton && addButton.classList.contains('add-item-btn')) {
                    addButton.style.display = 'block';
                }
                // ë¹ˆ í•­ëª© ì¶”ê°€
                addListItem(containerId);
            }
        }

        // ë¦¬ìŠ¤íŠ¸ í•­ëª© ì¶”ê°€ í•¨ìˆ˜
        function addListItem(containerId) {
            const container = document.getElementById(containerId);
            const newItem = document.createElement('div');
            newItem.className = 'list-input-item';
            
            // ê³ ê° ìš”ì²­ì‚¬í•­ì¸ ê²½ìš° ë‚ ì§œ ì…ë ¥ ì¹¸ ì¶”ê°€
            if (containerId === 'customer_requests_container') {
                newItem.className = 'list-input-item customer-request-item';
                const itemIndex = container.children.length + 1;
                newItem.innerHTML = `
                    <div class="target-label">(ë°œìƒì¼)</div>
                    <div class="target-checkboxes">
                        <div class="date-label">(ë°œìƒì¼)</div>
                        <input type="date" class="date-input" title="ë°œìƒì¼ ì„ íƒ">
                        <div class="copy-paste-container">
                            <button type="button" class="copy-btn" onclick="copyListItemData(this)" title="ì´ í•­ëª© ë³µì‚¬">Copy</button>
                            <button type="button" class="paste-btn" onclick="pasteListItemData(this)" title="ì´ í•­ëª©ì— ë¶™ì—¬ë„£ê¸°">Paste</button>
                        </div>
                    </div>
                    <textarea placeholder="ê³ ê° ìš”ì²­ì‚¬í•­ì„ ì…ë ¥í•˜ì„¸ìš”..." class="list-input" rows="3"></textarea>
                    <button type="button" class="remove-btn" onclick="removeListItem(this)">Ã—</button>
                `;
            } else if (containerId === 'this_week_tasks_container' || containerId === 'next_week_tasks_container') {
                // ê¸ˆì£¼ í•œ ì¼, í–¥í›„ í•  ì¼ì¸ ê²½ìš° ì‘ì—… ëŒ€ìƒ ì„ íƒ ì¶”ê°€
                newItem.className = 'list-input-item customer-request-item';
                const itemIndex = container.children.length + 1;
                const prefix = containerId === 'this_week_tasks_container' ? 'this_week' : 'next_week';
                const placeholder = containerId === 'this_week_tasks_container' ? 'ê¸ˆì£¼ í•œ ì¼ì„ ì…ë ¥í•˜ì„¸ìš”...' : 'í–¥í›„ í•  ì¼ì„ ì…ë ¥í•˜ì„¸ìš”...';
                
                newItem.innerHTML = `
                    <div class="target-label">(ì‘ì—… ëŒ€ìƒ)</div>
                    <div class="target-checkboxes">
                        <div class="target-checkbox-item">
                            <input type="checkbox" id="${prefix}_dev_${itemIndex}" name="${prefix}_target_${itemIndex}" value="ê°œë°œê³„">
                            <label for="${prefix}_dev_${itemIndex}">ê°œë°œê³„</label>
                        </div>
                        <div class="target-checkbox-item">
                            <input type="checkbox" id="${prefix}_ops_${itemIndex}" name="${prefix}_target_${itemIndex}" value="ìš´ì˜ê³„">
                            <label for="${prefix}_ops_${itemIndex}">ìš´ì˜ê³„</label>
                        </div>
                        <div class="target-checkbox-item">
                            <input type="checkbox" id="${prefix}_etc_${itemIndex}" name="${prefix}_target_${itemIndex}" value="ê¸°íƒ€">
                            <label for="${prefix}_etc_${itemIndex}">ê¸°íƒ€</label>
                        </div>
                        <div class="copy-paste-container">
                            <button type="button" class="copy-btn" onclick="copyListItemData(this)" title="ì´ í•­ëª© ë³µì‚¬">Copy</button>
                            <button type="button" class="paste-btn" onclick="pasteListItemData(this)" title="ì´ í•­ëª©ì— ë¶™ì—¬ë„£ê¸°">Paste</button>
                        </div>
                    </div>
                    <textarea placeholder="${placeholder}" class="list-input" rows="3"></textarea>
                    <button type="button" class="remove-btn" onclick="removeListItem(this)">Ã—</button>
                `;
            } else {
                newItem.innerHTML = `
                    <textarea placeholder="í•­ëª©ì„ ì…ë ¥í•˜ì„¸ìš”..." class="list-input" rows="3"></textarea>
                    <button type="button" class="remove-btn" onclick="removeListItem(this)">Ã—</button>
                `;
            }
            container.appendChild(newItem);
        }

        // ë¦¬ìŠ¤íŠ¸ í•­ëª© ì œê±° í•¨ìˆ˜
        function removeListItem(button) {
            const container = button.closest('.list-input-container');
            const items = container.querySelectorAll('.list-input-item');
            const currentItem = button.closest('.list-input-item');
            
            if (items.length > 1) {
                // ì—¬ëŸ¬ í•­ëª©ì´ ìˆìœ¼ë©´ ì‚­ì œ
                currentItem.remove();
            } else {
                // ì²« ë²ˆì§¸ í•­ëª©ì´ë©´ ê°’ë§Œ ë¹„ìš°ê¸°
                const textInput = currentItem.querySelector('.list-input');
                const dateInput = currentItem.querySelector('.date-input');
                const checkboxes = currentItem.querySelectorAll('input[type="checkbox"]');
                
                textInput.value = '';
                if (dateInput) {
                    dateInput.value = ''; // ë‚ ì§œë„ ì´ˆê¸°í™”
                }
                // ì²´í¬ë°•ìŠ¤ë„ ì´ˆê¸°í™”
                checkboxes.forEach(checkbox => {
                    checkbox.checked = false;
                });
                textInput.focus(); // í¬ì»¤ìŠ¤ ì´ë™
            }
        }

        // ë¦¬ìŠ¤íŠ¸ ë°ì´í„°ë¥¼ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜ (Sheetìš© - ì²« ì¤„ ì œì™¸í•˜ê³  â–¶ ì¶”ê°€)
        function getListData(containerId) {
            const container = document.getElementById(containerId);
            
            // "ì—†ìŒ" ì²´í¬ë°•ìŠ¤ í™•ì¸
            let noneCheckboxId;
            if (containerId === 'this_week_tasks_container') {
                noneCheckboxId = 'this_week_none';
            } else if (containerId === 'next_week_tasks_container') {
                noneCheckboxId = 'next_week_none';
            } else if (containerId === 'customer_requests_container') {
                noneCheckboxId = 'customer_requests_none';
            }
            
            const noneCheckbox = document.getElementById(noneCheckboxId);
            
            console.log(`getListData ì²´í¬: ${containerId} -> ${noneCheckboxId}, ì²´í¬ë°•ìŠ¤ ì¡´ì¬: ${!!noneCheckbox}, ì²´í¬ë¨: ${noneCheckbox?.checked}`);
            
            if (noneCheckbox && noneCheckbox.checked) {
                console.log(`"ì—†ìŒ" ì²´í¬ë¨: ${containerId} -> ${noneCheckboxId}`);
                return 'ì—†ìŒ';
            }
            
            const items = container.querySelectorAll('.list-input-item');
            const itemTexts = [];
            
            Array.from(items).forEach((item, itemIndex) => {
                const textInput = item.querySelector('.list-input');
                const dateInput = item.querySelector('.date-input');
                const checkboxes = item.querySelectorAll('input[type="checkbox"]:checked');
                
                if (!textInput || textInput.value.trim() === '') {
                    return; // í…ìŠ¤íŠ¸ê°€ ë¹„ì–´ìˆìœ¼ë©´ ì œì™¸
                }
                
                const text = textInput.value.trim();
                const date = dateInput ? dateInput.value : '';
                
                // textareaì˜ ì—¬ëŸ¬ ì¤„ì„ ê°ê° ì²˜ë¦¬
                const lines = text.split('\n').filter(line => line.trim() !== '');
                const itemLines = [];
                
                lines.forEach((line, lineIndex) => {
                    // ê¸°ì¡´ í…ìŠ¤íŠ¸ì—ì„œ â–¶ ì œê±°í•˜ê³  ê¹¨ë—í•œ í…ìŠ¤íŠ¸ë§Œ ì¶”ì¶œ
                    const cleanValue = line.replace(/^â–¶\s*/, '').trim();
                    
                    // ê³µë°±ì´ ì•„ë‹Œ ê²½ìš°ì—ë§Œ ì²˜ë¦¬
                    if (cleanValue === '') {
                        return;
                    }
                    
                    let finalValue = cleanValue;
                    
                    // ì²« ì¤„ì—ë§Œ ì‘ì—… ëŒ€ìƒê³¼ ë‚ ì§œ ì¶”ê°€
                    if (lineIndex === 0) {
                        // ì‘ì—… ëŒ€ìƒ ì„ íƒì´ ìˆëŠ” ê²½ìš° (ê¸ˆì£¼ í•œ ì¼, í–¥í›„ í•  ì¼)
                        if (checkboxes.length > 0 && (containerId === 'this_week_tasks_container' || containerId === 'next_week_tasks_container')) {
                            const selectedTargets = Array.from(checkboxes).map(cb => cb.value);
                            finalValue = `[${selectedTargets.join(',')}] ${cleanValue}`;
                        }
                        
                        // ê³ ê° ìš”ì²­ì‚¬í•­ì¸ ê²½ìš° ë‚ ì§œ ì¶”ê°€
                        if (containerId === 'customer_requests_container' && date) {
                            // ë‚ ì§œ í˜•ì‹ì„ YY.MM.DDë¡œ ë³€í™˜
                            const dateObj = new Date(date);
                            const formattedDate = `${dateObj.getFullYear().toString().slice(-2)}.${(dateObj.getMonth() + 1).toString().padStart(2, '0')}.${dateObj.getDate().toString().padStart(2, '0')}`;
                            finalValue = `${cleanValue} (ë°œìƒì¼ : ${formattedDate})`;
                        }
                    }
                    
                    itemLines.push(finalValue);
                });
                
                // ê° í•­ëª©ì˜ ì¤„ë“¤ì„ ì¤„ë°”ê¿ˆìœ¼ë¡œ ì—°ê²°
                if (itemLines.length > 0) {
                    itemTexts.push(itemLines.join('\n'));
                }
            });
            
            // ì²« ë²ˆì§¸ í•­ëª©ì€ â–¶ ì—†ì´, ë‚˜ë¨¸ì§€ í•­ëª©ì€ ì²« ì¤„ì— â–¶ ì¶”ê°€
            const values = itemTexts.map((text, index) => {
                if (index === 0) {
                    return text;
                } else {
                    // ì²« ì¤„ì—ë§Œ â–¶ ì¶”ê°€
                    const lines = text.split('\n');
                    lines[0] = `â–¶ ${lines[0]}`;
                    return lines.join('\n');
                }
            });
            
            const result = values.join('\n');
            console.log(`getListData result for ${containerId}:`, result);
            return result;
        }

        // ë¦¬ìŠ¤íŠ¸ ë°ì´í„°ë¥¼ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜ (í‘œì‹œìš© - â–¶ ì—†ì´)
        function getListDataForDisplay(containerId) {
            const container = document.getElementById(containerId);
            const inputs = container.querySelectorAll('.list-input');
            const values = Array.from(inputs)
                .map(input => input.value.trim())
                .filter(value => value !== '');
            return values.join('\n');
        }

        // í…ìŠ¤íŠ¸ë¥¼ ë¦¬ìŠ¤íŠ¸ë¡œ ì„¤ì •í•˜ëŠ” í•¨ìˆ˜ (â–¶ ì œê±°í•˜ì—¬ í‘œì‹œ)
        function setListData(containerId, text) {
            const container = document.getElementById(containerId);
            
            // "ì—†ìŒ" ì²´í¬ë°•ìŠ¤ í™•ì¸
            let noneCheckboxId;
            if (containerId === 'this_week_tasks_container') {
                noneCheckboxId = 'this_week_none';
            } else if (containerId === 'next_week_tasks_container') {
                noneCheckboxId = 'next_week_none';
            } else if (containerId === 'customer_requests_container') {
                noneCheckboxId = 'customer_requests_none';
            }
            
            const noneCheckbox = document.getElementById(noneCheckboxId);
            
            if (text.trim() === 'ì—†ìŒ') {
                // "ì—†ìŒ" ë°ì´í„°ì¸ ê²½ìš° ì²´í¬ë°•ìŠ¤ ì²´í¬í•˜ê³  ì„¹ì…˜ ë¹„í™œì„±í™”
                if (noneCheckbox) {
                    noneCheckbox.checked = true;
                    toggleSection(containerId, true);
                }
                return;
            }
            
            // "ì—†ìŒ"ì´ ì•„ë‹Œ ê²½ìš° ì²´í¬ë°•ìŠ¤ í•´ì œí•˜ê³  ì„¹ì…˜ í™œì„±í™”
            if (noneCheckbox) {
                noneCheckbox.checked = false;
                toggleSection(containerId, false);
            }
            
            const lines = text.split('\n').filter(line => line.trim() !== '');
            
            // ê¸°ì¡´ í•­ëª©ë“¤ ì œê±°
            container.innerHTML = '';
            
            // â–¶ë¥¼ ê¸°ì¤€ìœ¼ë¡œ í•­ëª© ê·¸ë£¹ ë‚˜ëˆ„ê¸°
            const itemGroups = [];
            let currentGroup = [];
            
            lines.forEach((line, index) => {
                const trimmedLine = line.trim();
                
                // â–¶ë¡œ ì‹œì‘í•˜ëŠ” ê²½ìš° ë˜ëŠ” ì²« ì¤„ì¸ ê²½ìš°
                if (trimmedLine.startsWith('â–¶') || index === 0) {
                    // ì´ì „ ê·¸ë£¹ì´ ìˆìœ¼ë©´ ì €ì¥
                    if (currentGroup.length > 0) {
                        itemGroups.push(currentGroup);
                    }
                    // ìƒˆ ê·¸ë£¹ ì‹œì‘
                    currentGroup = [trimmedLine];
                } else {
                    // í˜„ì¬ ê·¸ë£¹ì— ì¶”ê°€
                    currentGroup.push(trimmedLine);
                }
            });
            
            // ë§ˆì§€ë§‰ ê·¸ë£¹ ì¶”ê°€
            if (currentGroup.length > 0) {
                itemGroups.push(currentGroup);
            }
            
            // ê° ê·¸ë£¹ë§ˆë‹¤ ë³„ë„ì˜ í•­ëª© ìƒì„±
            itemGroups.forEach((group, groupIndex) => {
                let dateValue = '';
                let selectedTargets = [];
                let cleanLines = [];
                
                group.forEach((line, lineIndex) => {
                    // â–¶ ê¸°í˜¸ì™€ ê³µë°± ì œê±°
                    let cleanLine = line.replace(/^â–¶\s*/g, '').trim();
                    
                    // ì²« ì¤„ì—ì„œë§Œ ì‘ì—… ëŒ€ìƒê³¼ ë‚ ì§œ íŒŒì‹±
                    if (lineIndex === 0) {
                        // ì‘ì—… ëŒ€ìƒ íŒŒì‹± (ê¸ˆì£¼ í•œ ì¼, í–¥í›„ í•  ì¼)
                        if (containerId === 'this_week_tasks_container' || containerId === 'next_week_tasks_container') {
                            const targetMatch = cleanLine.match(/^\[([^\]]+)\]\s*(.*)$/);
                            if (targetMatch) {
                                selectedTargets = targetMatch[1].split(',').map(t => t.trim());
                                cleanLine = targetMatch[2].trim();
                            }
                        }
                        
                        // ê³ ê° ìš”ì²­ì‚¬í•­ì¸ ê²½ìš° ë‚ ì§œ íŒŒì‹±
                        if (containerId === 'customer_requests_container') {
                            const dateMatch = cleanLine.match(/\(ë°œìƒì¼\s*:\s*(\d{2}\.\d{2}\.\d{2})\)$/);
                            if (dateMatch) {
                                // ë‚ ì§œ ë¶€ë¶„ ì œê±°
                                cleanLine = cleanLine.replace(/\s*\(ë°œìƒì¼\s*:\s*\d{2}\.\d{2}\.\d{2}\)$/, '').trim();
                                
                                // YY.MM.DD í˜•ì‹ì„ YYYY-MM-DDë¡œ ë³€í™˜
                                const dateStr = dateMatch[1];
                                const [year, month, day] = dateStr.split('.');
                                const fullYear = '20' + year; // 20XXë…„ìœ¼ë¡œ ë³€í™˜
                                dateValue = `${fullYear}-${month}-${day}`;
                            }
                        }
                    }
                    
                    cleanLines.push(cleanLine);
                });
                
                // ê·¸ë£¹ì˜ ëª¨ë“  ì¤„ì„ ì¤„ë°”ê¿ˆìœ¼ë¡œ ì—°ê²°
                const textareaValue = cleanLines.join('\n');
                
                const newItem = document.createElement('div');
                newItem.className = 'list-input-item';
                
                // ê³ ê° ìš”ì²­ì‚¬í•­ì¸ ê²½ìš° ë‚ ì§œ ì…ë ¥ ì¹¸ ì¶”ê°€
                if (containerId === 'customer_requests_container') {
                    newItem.className = 'list-input-item customer-request-item';
                    newItem.innerHTML = `
                        <div class="target-label">(ë°œìƒì¼)</div>
                        <div class="target-checkboxes">
                            <div class="date-label">(ë°œìƒì¼)</div>
                            <input type="date" class="date-input" value="${dateValue}" title="ë°œìƒì¼ ì„ íƒ">
                            <div class="copy-paste-container">
                                <button type="button" class="copy-btn" onclick="copyListItemData(this)" title="ì´ í•­ëª© ë³µì‚¬">Copy</button>
                                <button type="button" class="paste-btn" onclick="pasteListItemData(this)" title="ì´ í•­ëª©ì— ë¶™ì—¬ë„£ê¸°">Paste</button>
                            </div>
                        </div>
                        <textarea class="list-input" rows="3">${textareaValue}</textarea>
                        <button type="button" class="remove-btn" onclick="removeListItem(this)">Ã—</button>
                    `;
                } else if (containerId === 'this_week_tasks_container' || containerId === 'next_week_tasks_container') {
                    // ê¸ˆì£¼ í•œ ì¼, í–¥í›„ í•  ì¼ì¸ ê²½ìš° ì‘ì—… ëŒ€ìƒ ì„ íƒ ì¶”ê°€
                    newItem.className = 'list-input-item customer-request-item';
                    const itemIndex = groupIndex + 1;
                    const prefix = containerId === 'this_week_tasks_container' ? 'this_week' : 'next_week';
                    const placeholder = containerId === 'this_week_tasks_container' ? 'ê¸ˆì£¼ í•œ ì¼ì„ ì…ë ¥í•˜ì„¸ìš”...' : 'í–¥í›„ í•  ì¼ì„ ì…ë ¥í•˜ì„¸ìš”...';
                    
                    // ì„ íƒëœ ì‘ì—… ëŒ€ìƒì— ë”°ë¼ ì²´í¬ë°•ìŠ¤ ìƒíƒœ ì„¤ì •
                    const devChecked = selectedTargets.includes('ê°œë°œê³„') ? 'checked' : '';
                    const opsChecked = selectedTargets.includes('ìš´ì˜ê³„') ? 'checked' : '';
                    const etcChecked = selectedTargets.includes('ê¸°íƒ€') ? 'checked' : '';
                    
                    newItem.innerHTML = `
                        <div class="target-label">(ì‘ì—… ëŒ€ìƒ)</div>
                        <div class="target-checkboxes">
                            <div class="target-checkbox-item">
                                <input type="checkbox" id="${prefix}_dev_${itemIndex}" name="${prefix}_target_${itemIndex}" value="ê°œë°œê³„" ${devChecked}>
                                <label for="${prefix}_dev_${itemIndex}">ê°œë°œê³„</label>
                            </div>
                            <div class="target-checkbox-item">
                                <input type="checkbox" id="${prefix}_ops_${itemIndex}" name="${prefix}_target_${itemIndex}" value="ìš´ì˜ê³„" ${opsChecked}>
                                <label for="${prefix}_ops_${itemIndex}">ìš´ì˜ê³„</label>
                            </div>
                            <div class="target-checkbox-item">
                                <input type="checkbox" id="${prefix}_etc_${itemIndex}" name="${prefix}_target_${itemIndex}" value="ê¸°íƒ€" ${etcChecked}>
                                <label for="${prefix}_etc_${itemIndex}">ê¸°íƒ€</label>
                            </div>
                            <div class="copy-paste-container">
                                <button type="button" class="copy-btn" onclick="copyListItemData(this)" title="ì´ í•­ëª© ë³µì‚¬">Copy</button>
                                <button type="button" class="paste-btn" onclick="pasteListItemData(this)" title="ì´ í•­ëª©ì— ë¶™ì—¬ë„£ê¸°">Paste</button>
                            </div>
                        </div>
                        <textarea placeholder="${placeholder}" class="list-input" rows="3">${textareaValue}</textarea>
                        <button type="button" class="remove-btn" onclick="removeListItem(this)">Ã—</button>
                    `;
                } else {
                    newItem.innerHTML = `
                        <textarea class="list-input" rows="3">${textareaValue}</textarea>
                        <button type="button" class="remove-btn" onclick="removeListItem(this)">Ã—</button>
                    `;
                }
                container.appendChild(newItem);
            });
            
            // ë¹ˆ í•­ëª©ì´ ì—†ìœ¼ë©´ í•˜ë‚˜ ì¶”ê°€
            if (itemGroups.length === 0) {
                addListItem(containerId);
            }
        }

        /**
         * ì‹œíŠ¸ ë°ì´í„°ì—ì„œ íŠ¹ì • site_nameì„ ì°¾ì•„ í•´ë‹¹ ì…€ì˜ 0-based í–‰ê³¼ ì—´ ì¸ë±ìŠ¤ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
         * site_nameì€ 'SITEëª…' ì—´(Bì—´, Gì—´, Lì—´ ë“±)ì— ìœ„ì¹˜í•œë‹¤ê³  ê°€ì •í•©ë‹ˆë‹¤.
         * @param {Array<Array<string>>} sheetData ì‹œíŠ¸ì˜ ì „ì²´ 2ì°¨ì› ë°°ì—´ ë°ì´í„°
         * @param {string} siteName ì°¾ì„ site_name
         * @param {string} sheetName í˜„ì¬ ì‹œíŠ¸ ì´ë¦„
         * @param {Array<string>} columnOrder ìŠ¤í”„ë ˆë“œì‹œíŠ¸ì˜ ì—´ ìˆœì„œ (ì˜ˆ: ['SITEëª…', 'ë‹´ë‹¹ì', 'ê¸ˆì£¼ í•œ ì¼'])
         * @returns {{row: number, col: number}} site_nameì´ ë°œê²¬ëœ 0-based í–‰ ë° ì—´ ì¸ë±ìŠ¤. ì°¾ì§€ ëª»í•˜ë©´ {row: -1, col: -1}.
         */
        function findCellCoordinates(sheetData, siteName, sheetName, columnOrder) {
            const siteNameColIndexInOrder = columnOrder.indexOf('SITEëª…');
            
            for (let r = 0; r < sheetData.length; r++) {
                const row = sheetData[r];
                for (let c = 0; c < row.length; c++) {
                    // SITEëª… ì—´ì— í•´ë‹¹í•˜ëŠ” ê²½ìš°ì—ë§Œ ê²€ìƒ‰
                    // ì—¬ê¸°ì„œëŠ” columnOrderì˜ 'SITEëª…'ì´ ì‹¤ì œ Sheetsì˜ ì–´ëŠ ì—´ì— í•´ë‹¹í•˜ëŠ”ì§€ë¥¼ ì•Œì•„ì•¼ í•©ë‹ˆë‹¤.
                    // ê°„ë‹¨í™”ë¥¼ ìœ„í•´, ì‹¤ì œ Sheetsì—ì„œ SITEëª…ì´ íŠ¹ì • ì—´ì— ê·œì¹™ì ìœ¼ë¡œ ë‚˜íƒ€ë‚œë‹¤ê³  ê°€ì •í•©ë‹ˆë‹¤.
                    // ì˜ˆë¥¼ ë“¤ì–´, B, G, L ì—´ì— SITEëª…ì´ ìˆë‹¤ë©´, c % 5 === 1 (0-based) ê³¼ ê°™ì€ ê·œì¹™ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    // í˜„ì¬ëŠ” ëª¨ë“  ì…€ì„ ê²€ìƒ‰í•©ë‹ˆë‹¤. ë³´ë‹¤ ì •í™•í•œ ë¡œì§ì´ í•„ìš”í•˜ë©´ ìˆ˜ì •í•´ì•¼ í•©ë‹ˆë‹¤.
                    if (row[c] === siteName) {
                         // ì—¬ê¸°ì„œ `c`ëŠ” site_nameì´ ë°œê²¬ëœ ì‹¤ì œ 0-based ì—´ ì¸ë±ìŠ¤ì…ë‹ˆë‹¤ã€‚
                         // ì´ `c`ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë‹¤ë¥¸ ì»¬ëŸ¼ì˜ ì˜¤í”„ì…‹ì„ ê³„ì‚°í•©ë‹ˆë‹¤.
                        return { row: r, col: c };
                    }
                }
            }
            return { row: -1, col: -1 };
        }

        /**
         * 0-based ì—´ ì¸ë±ìŠ¤ë¥¼ A1 í‘œê¸°ë²•ì˜ ì—´ ë¬¸ì(ì˜ˆ: 0 -> A, 25 -> Z, 26 -> AA)ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.
         * @param {number} colIndex 0-based ì—´ ì¸ë±ìŠ¤
         * @returns {string} A1 í‘œê¸°ë²• ì—´ ë¬¸ì
         */
        function columnToLetter(colIndex) {
            let temp, letter = '';
            while (colIndex >= 0) {
                temp = colIndex % 26;
                letter = String.fromCharCode(temp + 65) + letter;
                colIndex = Math.floor(colIndex / 26) - 1;
            }
            return letter;
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë§¤í•‘ ë°ì´í„° ë¡œë“œ
        window.addEventListener('DOMContentLoaded', function() {
            loadManagerSiteMapping();
        });
    </script>

    <script src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
    <script async defer src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>
</body>
</html>
