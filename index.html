<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì£¼ê°„ ì—…ë¬´ ë³´ê³ </title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f4f4f4; }
        .container { background-color: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); max-width: 600px; margin: auto; }
        h1 { text-align: center; color: #333; }
        .form-group { margin-bottom: 15px; }
        
        /* ê·¸ë£¹ ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
        .form-section {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .form-section h3 {
            margin: 0 0 15px 0;
            color: #495057;
            font-size: 16px;
            font-weight: 600;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 8px;
        }
        
        .form-section .form-group {
            margin-bottom: 12px;
        }
        
        .form-section .form-group:last-child {
            margin-bottom: 0;
        }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        
        /* ì„¹ì…˜ ì œëª©ê³¼ ì²´í¬ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
        .section-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 5px;
        }
        
        .section-header label {
            margin: 0;
            flex: 1;
        }
        
        .section-header .none-checkbox {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
            color: #666;
        }
        
        .section-header .none-checkbox input[type="checkbox"] {
            margin: 0;
            width: auto;
        }
        
        .section-header .none-checkbox label {
            margin: 0;
            font-weight: normal;
            cursor: pointer;
        }
        
        /* ë¹„í™œì„±í™”ëœ ì„¹ì…˜ ìŠ¤íƒ€ì¼ */
        .section-disabled {
            opacity: 0.5;
            pointer-events: none;
        }
        
        /* ë¹„í™œì„±í™”ëœ ì²´í¬ë°•ìŠ¤ì™€ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .section-disabled .none-checkbox input[type="checkbox"] {
            opacity: 0.5;
            pointer-events: none;
        }
        
        .section-disabled .none-checkbox label {
            opacity: 0.5;
            pointer-events: none;
        }
        
        .section-disabled .add-item-btn {
            opacity: 0.5;
            pointer-events: none;
        }
        
        /* ì œì¶œ ë²„íŠ¼ ì¤‘ì•™ ì •ë ¬ */
        .submit-button-container {
            text-align: center;
            margin-top: 20px;
        }
        
        .submit-button-container button {
            margin: 0 auto;
        }
        
        input[type="text"], textarea, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        textarea { resize: vertical; min-height: 100px; }
        
        /* ë¦¬ìŠ¤íŠ¸ ì…ë ¥ ìŠ¤íƒ€ì¼ */
        .list-input-container {
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            background-color: #f9f9f9;
        }
        
        .list-input-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .list-input-item:last-child {
            margin-bottom: 0;
        }
        
        .list-input-item input {
            flex: 1;
            margin-right: 8px;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            /* ëª¨ë°”ì¼ì—ì„œ ì¤„ë°”ê¿ˆ ë°©ì§€ */
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        /* ê³ ê° ìš”ì²­ì‚¬í•­ ì „ìš© ìŠ¤íƒ€ì¼ */
        .list-input-item.customer-request-item {
            display: block;
            position: relative;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            /* íŒŒì¼ ë¬¸ì„œì²˜ëŸ¼ ì™¼ìª½ ìœ„ ëª¨ì„œë¦¬ íŠ€ì–´ë‚˜ì˜¨ íš¨ê³¼ */
            border-top-left-radius: 0;
        }
        
        .list-input-item.customer-request-item::before {
            content: '';
            position: absolute;
            top: -1px;
            left: -1px;
            width: 20px;
            height: 20px;
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-bottom-right-radius: 8px;
            border-top-left-radius: 4px;
        }
        
        .list-input-item.customer-request-item .date-label {
            display: inline-block;
            margin-bottom: 4px;
            font-size: 12px;
            color: #666;
            font-weight: 500;
        }
        
        .list-input-item.customer-request-item .date-input {
            width: 120px;
            margin-bottom: 8px;
            padding: 6px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 12px;
            background-color: #f8f9fa;
            display: block;
        }
        
        .list-input-item.customer-request-item .date-input:focus {
            outline: none;
            border-color: #4CAF50;
            background-color: white;
        }
        
        .list-input-item.customer-request-item .list-input {
            width: 100%;
            margin-right: 0;
            margin-bottom: 8px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            background-color: #fafafa;
            white-space: normal;
            overflow: visible;
            text-overflow: unset;
            resize: vertical;
            min-height: 40px;
        }
        
        .list-input-item.customer-request-item .list-input:focus {
            outline: none;
            border-color: #4CAF50;
            background-color: white;
        }
        
        .list-input-item.customer-request-item .remove-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background-color: #dc3545;
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .list-input-item.customer-request-item .remove-btn:hover {
            background-color: #c82333;
        }
        
        /* ì‘ì—… ëŒ€ìƒ ì„ íƒ ìŠ¤íƒ€ì¼ */
        .list-input-item .target-label {
            display: inline-block;
            margin-bottom: 4px;
            font-size: 12px;
            color: #666;
            font-weight: 500;
        }
        
        .list-input-item .target-checkboxes {
            display: flex;
            gap: 8px;
            margin-bottom: 8px;
            flex-wrap: wrap;
        }
        
        .list-input-item .target-checkbox-item {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .list-input-item .target-checkbox-item input[type="checkbox"] {
            margin: 0;
            width: auto;
        }
        
        .list-input-item .target-checkbox-item label {
            margin: 0;
            font-size: 12px;
            font-weight: normal;
            cursor: pointer;
        }
        
        .list-input-item .remove-btn {
            background-color: #dc3545;
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .list-input-item .remove-btn:hover {
            background-color: #c82333;
        }
        
        .add-item-btn {
            background-color: #6c757d;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 13px;
            margin-top: 8px;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }
        
        .add-item-btn:hover {
            background-color: #5a6268;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .add-item-btn:active {
            transform: translateY(0);
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover { background-color: #45a049; }
        button:disabled { background-color: #cccccc; cursor: not-allowed; }
        #confirmSiteButton {
            background-color: #2196F3;
            margin-left: 10px;
            padding: 8px 16px;
            font-size: 14px;
        }
        #confirmSiteButton:hover:not(:disabled) { background-color: #1976D2; }
        .response { margin-top: 20px; padding: 10px; background-color: #e2e2e2; border-radius: 4px; }
        
        /* í—¤ë” ì„¹ì…˜ ìŠ¤íƒ€ì¼ */
        .header-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .header-buttons {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .navigation-info {
            background-color: #e3f2fd;
            color: #1976d2;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 13px;
            font-weight: 500;
            border-left: 3px solid #2196F3;
            max-width: 200px;
            text-align: center;
        }
        
        .help-button {
            background-color: #2196F3;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .help-button:hover {
            background-color: #1976D2;
        }
        
        /* ë²„íŠ¼ ê·¸ë£¹ ìŠ¤íƒ€ì¼ */
        .button-group {
            display: flex;
            gap: 10px;
        }
        
        .button-group button {
            flex: 1;
        }
        
        /* ë§¤ë‹ˆì €/ì‚¬ì´íŠ¸ ì¡°íšŒ ë²„íŠ¼ ì¤‘ì•™ì •ë ¬ */
        .query-button-container {
            text-align: center;
            margin: 15px 0;
        }
        
        .query-button-container button {
            margin: 0 auto;
        }
        
        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 0;
            border-radius: 8px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid #ddd;
            background-color: #f8f9fa;
            border-radius: 8px 8px 0 0;
        }
        
        .modal-header h2 {
            margin: 0;
            color: #333;
        }
        
        .close {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .close:hover {
            color: #000;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .step {
            display: flex;
            margin-bottom: 20px;
            align-items: flex-start;
        }
        
        .step-number {
            font-size: 24px;
            margin-right: 15px;
            flex-shrink: 0;
        }
        
        .step-content {
            flex: 1;
            line-height: 1.6;
        }
        
        .step-content strong {
            color: #2196F3;
            font-size: 16px;
        }
        
        .account-info {
            background-color: #e3f2fd;
            padding: 15px;
            border-radius: 6px;
            margin-top: 20px;
            border-left: 4px solid #2196F3;
        }
        
        .account-info h3 {
            margin: 0 0 10px 0;
            color: #1976D2;
        }
        
        .account-info p {
            margin: 5px 0;
            font-family: monospace;
            background-color: #fff;
            padding: 5px 10px;
            border-radius: 4px;
        }
        
        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 768px) {
            .header-section {
                flex-direction: column;
                align-items: stretch;
            }
            
            .header-buttons {
                flex-direction: column;
                gap: 8px;
                margin-top: 10px;
            }
            
            .navigation-info {
                max-width: none;
                font-size: 12px;
            }
            
            .help-button {
                align-self: flex-end;
            }
            
            .modal-content {
                width: 95%;
                margin: 5% auto;
                max-height: 90vh;
            }
            
            .modal-header {
                padding: 15px;
            }
            
            .modal-header h2 {
                font-size: 18px;
            }
            
            .modal-body {
                padding: 15px;
            }
            
            .step {
                flex-direction: column;
                text-align: center;
                margin-bottom: 15px;
            }
            
            .step-number {
                margin-right: 0;
                margin-bottom: 8px;
                font-size: 20px;
            }
            
            .step-content {
                font-size: 14px;
            }
            
            .step-content strong {
                font-size: 14px;
            }
            
            .account-info {
                padding: 12px;
                margin-top: 15px;
            }
            
            .account-info h3 {
                font-size: 16px;
            }
            
            .account-info p {
                font-size: 13px;
                padding: 4px 8px;
            }
        }
        
        /* ë§¤ìš° ì‘ì€ í™”ë©´ (320px ì´í•˜) */
        @media (max-width: 480px) {
            .modal-content {
                width: 98%;
                margin: 2% auto;
                max-height: 95vh;
            }
            
            .modal-header {
                padding: 12px;
            }
            
            .modal-header h2 {
                font-size: 16px;
            }
            
            .modal-body {
                padding: 12px;
            }
            
            .step {
                margin-bottom: 12px;
            }
            
            .step-number {
                font-size: 18px;
            }
            
            .step-content {
                font-size: 13px;
            }
            
            .account-info {
                padding: 10px;
            }
        }
    </style>

    <script>
        // í™˜ê²½ë³€ìˆ˜ ì£¼ì…
        window.ENV_SPREADSHEET_ID = '1fmWVqEOJavKVMGT6IZguBMg1kG8bnPdiO_x_FhuXJ-s';
        console.log('Environment variables injected:', {
            SPREADSHEET_ID: '1fmWVqEOJavKVMGT6IZguBMg1kG8bnPdiO_x_FhuXJ-s'
        });
    </script>


    <script>
        // í™˜ê²½ë³€ìˆ˜ ì£¼ì…
        window.ENV_SPREADSHEET_ID = '1Xrz9RlDXu3v6pBbuQc-B306gtXnG5CfebRG6KP44Kxs';
        console.log('Environment variables injected:', {
            SPREADSHEET_ID: '1Xrz9RlDXu3v6pBbuQc-B306gtXnG5CfebRG6KP44Kxs'
        });
    </script>

</head>
<body>
    <div class="container">
        <div class="header-section">
            <h1>ì£¼ê°„ ì—…ë¬´ ë³´ê³  ì…ë ¥</h1>
            <div class="header-buttons">
                <div id="navigationInfo" class="navigation-info">ë§¤ë‹ˆì €/ì‚¬ì´íŠ¸ ëª©ë¡ì„ ì¡°íšŒí•˜ì„¸ìš”</div>
                <button id="helpButton" class="help-button">ğŸ“– ì‚¬ìš©ë²•</button>
            </div>
        </div>
        <form id="reportForm">
            <!-- ì„ íƒ ì„¹ì…˜ -->
            <div class="form-section">
                <h3>ğŸ“‹ ê¸°ë³¸ ì •ë³´ ì„ íƒ</h3>
                <div class="form-group">
                    <label for="manager">ë§¤ë‹ˆì € ì´ë¦„:</label>
                    <input type="text" id="searchManager" placeholder="ë§¤ë‹ˆì € ì´ë¦„ ê²€ìƒ‰...">
                    <select id="manager" name="manager" required>
                        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                    </select>
                    <input type="text" id="managerDirectInput" placeholder="ë§¤ë‹ˆì € ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: í™ê¸¸ë™,ì´ì¶˜í–¥ ë˜ëŠ” í™ê¸¸ë™ ì´ì¶˜í–¥)" style="display: none; margin-top: 5px;">
                </div>
                <div class="form-group">
                    <label for="site_name">ë‹´ë‹¹ ì‚¬ì´íŠ¸:</label>
                    <input type="text" id="searchSite" placeholder="ë‹´ë‹¹ ì‚¬ì´íŠ¸ ê²€ìƒ‰...">
                    <select id="site_name" name="site_name" required>
                        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="reportSheetName">ë³´ê³ ì„œ ì‹œíŠ¸ ì´ë¦„:</label>
                    <select id="reportSheetName" name="reportSheetName" required>
                        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                    </select>
                </div>
                <div class="form-group query-button-container">
                    <button type="button" id="queryDropdownsButton" disabled>ë§¤ë‹ˆì €/ì‚¬ì´íŠ¸ ëª©ë¡ ì¡°íšŒ</button>
                </div>
                <div class="form-group button-group">
                    <button type="button" id="confirmSiteButton" disabled>ê³ ì •/ì„ íƒ</button>
                    <button type="button" id="readReportButton" disabled>ë³´ê³ ì„œ ì¡°íšŒ</button>
                </div>
            </div>
                        <!-- ì…ë ¥ ì„¹ì…˜ -->
            <div class="form-section">
                <h3>ğŸ“ ë³´ê³ ì„œ ì‘ì„±</h3>
                <div class="form-group">
                    <div class="section-header">
                        <label for="this_week_tasks">ê¸ˆì£¼ í•œ ì¼:</label>
                        <div class="none-checkbox">
                            <input type="checkbox" id="this_week_none" onchange="toggleSection('this_week_tasks_container', this.checked)">
                            <label for="this_week_none">ì—†ìŒ</label>
                        </div>
                    </div>
                    <div class="list-input-container" id="this_week_tasks_container">
                        <div class="list-input-item customer-request-item">
                            <div class="target-label">(ì‘ì—… ëŒ€ìƒ)</div>
                            <div class="target-checkboxes">
                                <div class="target-checkbox-item">
                                    <input type="checkbox" id="this_week_dev_1" name="this_week_target_1" value="ê°œë°œê³„">
                                    <label for="this_week_dev_1">ê°œë°œê³„</label>
                                </div>
                                <div class="target-checkbox-item">
                                    <input type="checkbox" id="this_week_ops_1" name="this_week_target_1" value="ìš´ì˜ê³„">
                                    <label for="this_week_ops_1">ìš´ì˜ê³„</label>
                                </div>
                                <div class="target-checkbox-item">
                                    <input type="checkbox" id="this_week_etc_1" name="this_week_target_1" value="ê¸°íƒ€">
                                    <label for="this_week_etc_1">ê¸°íƒ€</label>
                                </div>
                            </div>
                            <input type="text" placeholder="ê¸ˆì£¼ í•œ ì¼ì„ ì…ë ¥í•˜ì„¸ìš”..." class="list-input"
                                   onkeydown="preventEnterSubmit(event)" onkeypress="preventEnterSubmit(event)">
                            <button type="button" class="remove-btn" onclick="removeListItem(this)">Ã—</button>
                        </div>
                    </div>
                    <button type="button" class="add-item-btn" onclick="addListItem('this_week_tasks_container')">+ í•­ëª© ì¶”ê°€</button>
                </div>
                <div class="form-group">
                    <div class="section-header">
                        <label for="next_week_tasks">í–¥í›„ í•  ì¼:</label>
                        <div class="none-checkbox">
                            <input type="checkbox" id="next_week_none" onchange="toggleSection('next_week_tasks_container', this.checked)">
                            <label for="next_week_none">ì—†ìŒ</label>
                        </div>
                    </div>
                    <div class="list-input-container" id="next_week_tasks_container">
                        <div class="list-input-item customer-request-item">
                            <div class="target-label">(ì‘ì—… ëŒ€ìƒ)</div>
                            <div class="target-checkboxes">
                                <div class="target-checkbox-item">
                                    <input type="checkbox" id="next_week_dev_1" name="next_week_target_1" value="ê°œë°œê³„">
                                    <label for="next_week_dev_1">ê°œë°œê³„</label>
                                </div>
                                <div class="target-checkbox-item">
                                    <input type="checkbox" id="next_week_ops_1" name="next_week_target_1" value="ìš´ì˜ê³„">
                                    <label for="next_week_ops_1">ìš´ì˜ê³„</label>
                                </div>
                                <div class="target-checkbox-item">
                                    <input type="checkbox" id="next_week_etc_1" name="next_week_target_1" value="ê¸°íƒ€">
                                    <label for="next_week_etc_1">ê¸°íƒ€</label>
                                </div>
                            </div>
                            <input type="text" placeholder="í–¥í›„ í•  ì¼ì„ ì…ë ¥í•˜ì„¸ìš”..." class="list-input"
                                   onkeydown="preventEnterSubmit(event)" onkeypress="preventEnterSubmit(event)">
                            <button type="button" class="remove-btn" onclick="removeListItem(this)">Ã—</button>
                        </div>
                    </div>
                    <button type="button" class="add-item-btn" onclick="addListItem('next_week_tasks_container')">+ í•­ëª© ì¶”ê°€</button>
                </div>
                <div class="form-group">
                    <div class="section-header">
                        <label for="customer_requests">ê³ ê° ìš”ì²­ì‚¬í•­:</label>
                        <div class="none-checkbox">
                            <input type="checkbox" id="customer_requests_none" onchange="toggleSection('customer_requests_container', this.checked)">
                            <label for="customer_requests_none">ì—†ìŒ</label>
                        </div>
                    </div>
                    <div class="list-input-container" id="customer_requests_container">
                        <div class="list-input-item customer-request-item">
                            <div class="date-label">(ë°œìƒì¼)</div>
                            <input type="date" class="date-input" title="ë°œìƒì¼ ì„ íƒ">
                            <input type="text" placeholder="ê³ ê° ìš”ì²­ì‚¬í•­ì„ ì…ë ¥í•˜ì„¸ìš”..." class="list-input"
                                   onkeydown="preventEnterSubmit(event)" onkeypress="preventEnterSubmit(event)">
                            <button type="button" class="remove-btn" onclick="removeListItem(this)">Ã—</button>
                        </div>
                    </div>
                    <button type="button" class="add-item-btn" onclick="addListItem('customer_requests_container')">+ í•­ëª© ì¶”ê°€</button>
                </div>
                <div class="form-group submit-button-container">
                    <button type="submit" disabled>ë³´ê³ ì„œ ì œì¶œ</button>
                </div>
            </div>
        </form>
        <div id="response" class="response" style="display: none;"></div>
    </div>

    <!-- ì‚¬ìš©ë²• íŒì—… ëª¨ë‹¬ -->
    <div id="helpModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ğŸ“– ì‚¬ìš©ë²•</h2>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <div class="step">
                    <div class="step-number">1ï¸âƒ£</div>
                    <div class="step-content">
                        <strong>ë§¤ë‹ˆì €/ì‚¬ì´íŠ¸ ëª©ë¡ ì¡°íšŒ</strong><br>
                        "ë§¤ë‹ˆì €/ì‚¬ì´íŠ¸ ëª©ë¡ ì¡°íšŒ" ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.
                    </div>
                </div>
                
                <div class="step">
                    <div class="step-number">2ï¸âƒ£</div>
                    <div class="step-content">
                        <strong>ì •ë³´ ì„ íƒ</strong><br>
                        ë§¤ë‹ˆì € ì´ë¦„, ë‹´ë‹¹ ì‚¬ì´íŠ¸, ë³´ê³ ì„œ ì‹œíŠ¸ë¥¼ ì„ íƒí•©ë‹ˆë‹¤.<br>
                        <em>ğŸ’¡ ë§¤ë‹ˆì €ê°€ 2ëª… ì´ìƒì¸ ê²½ìš°: "ì§ì ‘ì…ë ¥"ì„ ì„ íƒí•˜ê³  "í™ê¸¸ë™,ì´ì¶˜í–¥" ë˜ëŠ” "í™ê¸¸ë™ ì´ì¶˜í–¥" í˜•íƒœë¡œ ì…ë ¥í•˜ì„¸ìš”.</em>
                    </div>
                </div>
                
                <div class="step">
                    <div class="step-number">3ï¸âƒ£</div>
                    <div class="step-content">
                        <strong>ê³ ì •/ì„ íƒ</strong><br>
                        "ê³ ì •/ì„ íƒ" ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì‚¬ì´íŠ¸ë³„ ì„¤ì •ì„ í™•ì¸í•©ë‹ˆë‹¤.
                    </div>
                </div>
                
                <div class="step">
                    <div class="step-number">4ï¸âƒ£</div>
                    <div class="step-content">
                        <strong>ë³´ê³ ì„œ ì œì¶œ</strong><br>
                        í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•œ í›„ "ë³´ê³ ì„œ ì œì¶œ" ë²„íŠ¼ì„ í´ë¦­í•©ë‹ˆë‹¤.
                    </div>
                </div>
                
                <div class="step">
                    <div class="step-number">5ï¸âƒ£</div>
                    <div class="step-content">
                        <strong>ìˆ˜ì • ì‹œ</strong><br>
                        ê¸°ì¡´ ë°ì´í„°ë¥¼ ìˆ˜ì •í•  ë•ŒëŠ” "ë³´ê³ ì„œ ì¡°íšŒ" ë²„íŠ¼ìœ¼ë¡œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¨ í›„ ìˆ˜ì •í•˜ê³  "ë³´ê³ ì„œ ì œì¶œ" ë²„íŠ¼ì„ í´ë¦­í•©ë‹ˆë‹¤.
                    </div>
                </div>
                
                <div class="account-info">
                    <h3>ğŸ” Google ê³µìš© ê³„ì •</h3>
                    <p><strong>ID:</strong> interezen502@gmail.com</p>
                    <p><strong>PW:</strong> inter502</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Google API ì„¤ì •
        const CLIENT_ID = '898247770764-ev4i2nonvqnd4n8evrnivt75i2t78s0u.apps.googleusercontent.com'; // Google Cloud Consoleì—ì„œ ë°œê¸‰ë°›ì€ í´ë¼ì´ì–¸íŠ¸ IDë¥¼ ì…ë ¥í•˜ì„¸ìš”.
        const API_KEY = 'AIzaSyBV_qqUNlgCkRAt7sITJbzxt38I3gZ5Z-4';     // Google Cloud Consoleì—ì„œ ë°œê¸‰ë°›ì€ API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”.
        const DISCOVERY_DOCS = ["https://sheets.googleapis.com/$discovery/rest?version=v4"];
        const SCOPES = "https://www.googleapis.com/auth/spreadsheets";
        
        // í™˜ê²½ë³€ìˆ˜ì—ì„œ ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ID ê°€ì ¸ì˜¤ê¸° (ê¸°ë³¸ê°’: í…ŒìŠ¤íŠ¸ ìŠ¤í”„ë ˆë“œì‹œíŠ¸)
        const SPREADSHEET_ID = window.ENV_SPREADSHEET_ID || '1Xrz9RlDXu3v6pBbuQc-B306gtXnG5CfebRG6KP44Kxs';

        let tokenClient;
        let gapiInited = false;
        let gisInited = false;

        // ì›ë³¸ ë§¤ë‹ˆì € ë° ì‚¬ì´íŠ¸ ëª©ë¡ (ê²€ìƒ‰ í•„í„°ë§ìš©)
        let originalManagers = [];
        let originalSites = [];
        // ì›ë³¸ ë³´ê³ ì„œ ì‹œíŠ¸ ì´ë¦„ ëª©ë¡ (ê²€ìƒ‰ í•„í„°ë§ìš©)
        let originalReportSheetNames = [];
        
        // L40 ì´í›„ ë²”ìœ„ì˜ ì‚¬ì´íŠ¸ë“¤ (ê³ ê° ìš”ì²­ì‚¬í•­ ì…ë ¥ ë¶ˆê°€) - ë™ì ìœ¼ë¡œ ìƒì„±ë¨
        let sitesWithoutCustomerRequests = [];

        function gapiLoaded() {
            gapi.load('client', initializeGapiClient);
        }

        async function initializeGapiClient() {
            await gapi.client.init({
                apiKey: API_KEY,
                discoveryDocs: DISCOVERY_DOCS,
            });
            // Sheets APIë¥¼ ëª…ì‹œì ìœ¼ë¡œ ë¡œë“œí•©ë‹ˆë‹¤.
            await gapi.client.load('sheets', 'v4');
            gapiInited = true;
            maybeEnableForm();
        }

        function gisLoaded() {
            console.log('ğŸ”§ GIS (Google Identity Services) ë¡œë“œë¨');
            console.log('ğŸ”§ CLIENT_ID:', CLIENT_ID);
            console.log('ğŸ”§ SCOPES:', SCOPES);
            console.log('ğŸ”§ í˜„ì¬ URL:', window.location.href);
            console.log('ğŸ”§ í˜„ì¬ Origin:', window.location.origin);
            
            tokenClient = google.accounts.oauth2.initTokenClient({
                client_id: CLIENT_ID,
                scope: SCOPES,
                callback: (resp) => {
                    console.log('ğŸ”§ OAuth ì½œë°± ì‘ë‹µ:', resp);
                    if (resp.error !== undefined) {
                        console.error('âŒ OAuth ì˜¤ë¥˜:', resp.error);
                        console.error('âŒ ì˜¤ë¥˜ ìƒì„¸:', resp.error_description);
                        console.error('âŒ ì „ì²´ ì‘ë‹µ:', resp);
                        throw (resp);
                    }
                    console.log('âœ… OAuth ì„±ê³µ, í† í° ì„¤ì •');
                    gapi.client.setToken(resp);
                },
            });
            gisInited = true; // ì´ ë¶€ë¶„ì„ callback ë°–ìœ¼ë¡œ ì´ë™
            maybeEnableForm(); // ì´ ë¶€ë¶„ì„ callback ë°–ìœ¼ë¡œ ì´ë™
        }

        function maybeEnableForm() {
            console.log('maybeEnableForm called.'); // maybeEnableForm í•¨ìˆ˜ í˜¸ì¶œ ë¡œê·¸ ì¶”ê°€
            console.log('gapiInited:', gapiInited, 'gisInited:', gisInited); // gapiInited, gisInited ìƒíƒœ ë¡œê·¸ ì¶”ê°€
            if (gapiInited && gisInited) {
                // í¼ì„ í™œì„±í™”í•˜ê³  ë“œë¡­ë‹¤ìš´ ë°ì´í„°ë¥¼ ë¡œë“œí•©ë‹ˆë‹¤.
                // populateDropdowns()ëŠ” ì´ì œ ì¡°íšŒ ë²„íŠ¼ í´ë¦­ ì‹œ í˜¸ì¶œë©ë‹ˆë‹¤.
                document.getElementById('queryDropdownsButton').disabled = false;
                document.querySelector('button[type="submit"]').disabled = false;
                console.log('Dropdowns and Submit buttons enabled.'); // ë²„íŠ¼ í™œì„±í™” ë¡œê·¸ ì¶”ê°€
            } else {
                console.log('Dropdowns and Submit buttons NOT yet enabled (waiting for gapi/gis init).'); // ë²„íŠ¼ ë¹„í™œì„±í™” ìƒíƒœ ë¡œê·¸ ì¶”ê°€
            }
        }



        async function populateDropdowns() {
            console.log('ğŸ”§ populateDropdowns í•¨ìˆ˜ ì‹œì‘');
            console.log('ğŸ”§ gapi.client ìƒíƒœ:', gapi.client);
            console.log('ğŸ”§ í˜„ì¬ í† í°:', gapi.client.getToken());
            const managerSelect = document.getElementById('manager');
            const siteSelect = document.getElementById('site_name');
            const reportSheetNameSelect = document.getElementById('reportSheetName');
            const queryButton = document.getElementById('queryDropdownsButton');

            // ë²„íŠ¼ ìƒíƒœë¥¼ ë¡œë”© ì¤‘ìœ¼ë¡œ ë³€ê²½
            queryButton.textContent = 'ë¡œë”© ì¤‘...';
            queryButton.style.backgroundColor = '#ffc107'; // ë¡œë”© ì¤‘ ìƒ‰ìƒ (ì˜ˆ: ì£¼í™©ìƒ‰)
            queryButton.disabled = true;

            // ê¸°ì¡´ ì˜µì…˜ ì œê±° (ì²« ë²ˆì§¸ 'ì„ íƒí•˜ì„¸ìš”' ì˜µì…˜ ì œì™¸)
            managerSelect.innerHTML = '<option value="">ì„ íƒí•˜ì„¸ìš”</option>';
            siteSelect.innerHTML = '<option value="">ì„ íƒí•˜ì„¸ìš”</option>';
            reportSheetNameSelect.innerHTML = '<option value="">ì„ íƒí•˜ì„¸ìš”</option>';

            // SPREADSHEET_IDëŠ” ìƒë‹¨ì—ì„œ í™˜ê²½ë³€ìˆ˜ë¡œ ì„¤ì •ë¨
            const DROPDOWN_SHEET_NAME = 'SITE ë¶„ì¥ í˜„í™©'; // ë“œë¡­ë‹¤ìš´ ë°ì´í„°ê°€ ìˆëŠ” ì‹œíŠ¸ ì´ë¦„
            const MANAGER_RANGE = `${DROPDOWN_SHEET_NAME}!B4:B1000`; // B4ë¶€í„° ì‹œì‘í•˜ì—¬ ë§¤ë‹ˆì € ì´ë¦„ë§Œ ê°€ì ¸ì˜¤ê¸°
            const SITE_RANGE = `${DROPDOWN_SHEET_NAME}!A:Z`; // ì‚¬ì´íŠ¸ ë°ì´í„°ëŠ” ê¸°ì¡´ëŒ€ë¡œ ì „ì²´ ë²”ìœ„

            try {
                console.log('Requesting dropdown data from Google Sheets API...');
                console.log('Spreadsheet ID:', SPREADSHEET_ID);
                console.log('Manager Range:', MANAGER_RANGE);
                console.log('Site Range:', SITE_RANGE);

                // ë§¤ë‹ˆì € ì´ë¦„ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (B4ë¶€í„°)
                const managerResponse = await gapi.client.sheets.spreadsheets.values.get({
                    spreadsheetId: SPREADSHEET_ID,
                    range: MANAGER_RANGE,
                });

                // ì‚¬ì´íŠ¸ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (ê¸°ì¡´ ë°©ì‹)
                const siteResponse = await gapi.client.sheets.spreadsheets.values.get({
                    spreadsheetId: SPREADSHEET_ID,
                    range: SITE_RANGE,
                });

                console.log('Google Sheets API Response (Manager Data):', managerResponse); // API ì‘ë‹µ ì¶œë ¥
                console.log('Google Sheets API Response (Site Data):', siteResponse); // API ì‘ë‹µ ì¶œë ¥

                const managerData = managerResponse.result.values || [];
                const siteData = siteResponse.result.values || [];
                console.log('Extracted managerData:', managerData); // ì¶”ì¶œëœ ë§¤ë‹ˆì € ë°ì´í„° ì¶œë ¥
                console.log('Extracted siteData:', siteData); // ì¶”ì¶œëœ ì‚¬ì´íŠ¸ ë°ì´í„° ì¶œë ¥

                const managers = new Set();
                const sites = new Set();

                // ë§¤ë‹ˆì € ì´ë¦„ ì²˜ë¦¬ (B4ë¶€í„° ì‹œì‘í•˜ë¯€ë¡œ í—¤ë” ì—†ì´ ë°”ë¡œ ì²˜ë¦¬)
                for (let r = 0; r < managerData.length; r++) {
                    const managerCell = managerData[r] && managerData[r][0] ? managerData[r][0].trim() : '';
                    if (managerCell && managerCell !== '') {
                        managers.add(managerCell);
                    }
                }

                // ì‚¬ì´íŠ¸ ë°ì´í„° ì²˜ë¦¬ (ê¸°ì¡´ ë°©ì‹ ìœ ì§€)
                for (let r = 0; r < siteData.length; r++) {
                    const rowData = siteData[r] || [];
                    // Sites start from Column E (index 4)
                    for (let c = 4; c < rowData.length; c++) {
                        const siteCell = rowData[c] ? rowData[c].trim() : '';
                        if (siteCell !== '') {
                            sites.add(siteCell);
                        }
                    }
                }

                originalManagers = Array.from(managers).sort();
                // originalSites = Array.from(sites).sort(); // SITE ë¶„ì¥ í˜„í™©ì—ì„œ ì‚¬ì´íŠ¸ ê°€ì ¸ì˜¤ëŠ” ë¡œì§ ì£¼ì„ ì²˜ë¦¬
                console.log('Original Managers:', originalManagers); // ì›ë³¸ ë§¤ë‹ˆì € ëª©ë¡ ì¶œë ¥
                // console.log('Original Sites:', originalSites);     // ì›ë³¸ ì‚¬ì´íŠ¸ ëª©ë¡ ì¶œë ¥ (ì„ì‹œ ì£¼ì„ ì²˜ë¦¬)

                // ë§¤ë‹ˆì € ë“œë¡­ë‹¤ìš´ ì±„ìš°ê¸°
                updateManagerDropdown(originalManagers);

                // ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ë©”íƒ€ë°ì´í„° ê°€ì ¸ì™€ì„œ YYYY-MM-DD í˜•ì‹ì˜ ì‹œíŠ¸ ì´ë¦„ ì°¾ê¸°
                console.log('Requesting spreadsheet metadata...');
                const spreadsheetMetadataResponse = await gapi.client.sheets.spreadsheets.get({
                    spreadsheetId: SPREADSHEET_ID,
                });
                console.log('Google Sheets API Response (Spreadsheet Metadata):', spreadsheetMetadataResponse);

                // YYYY-MM-DD í˜•ì‹ì˜ ì‹œíŠ¸ ì´ë¦„ í•„í„°ë§
                const datePattern = /^\d{4}-\d{2}-\d{2}$/;
                originalReportSheetNames = spreadsheetMetadataResponse.result.sheets
                    .filter(sheet => datePattern.test(sheet.properties.title))
                    .map(sheet => ({
                        title: sheet.properties.title,
                        id: sheet.properties.sheetId  // sheetId ëŒ€ì‹  idë¡œ ë³€ê²½
                    }))
                    .sort((a, b) => b.title.localeCompare(a.title)); // ìµœì‹  ë‚ ì§œê°€ ë¨¼ì € ì˜¤ë„ë¡ ì •ë ¬

                // ë³´ê³ ì„œ ì‹œíŠ¸ ì´ë¦„ ê°€ì ¸ì˜¤ê¸° ë° ì±„ìš°ê¸°
                console.log('Original Report Sheet Names with IDs:', originalReportSheetNames); // ì›ë³¸ ì‹œíŠ¸ ì´ë¦„ ëª©ë¡ê³¼ ID ì¶œë ¥
                updateReportSheetNameDropdown(originalReportSheetNames);

                // --- ì´ì œ ê°€ì¥ ìµœì‹  YYYY-MM-DD ì‹œíŠ¸ì—ì„œ SITEëª… ê°€ì ¸ì˜¤ê¸° ---
                if (originalReportSheetNames.length > 0) {
                    const latestReportSheetName = originalReportSheetNames[0].title; // ê°€ì¥ ìµœì‹  ì‹œíŠ¸ (ì •ë ¬ë˜ì–´ ìˆìŒ)
                    console.log('Fetching site names from latest report sheet:', latestReportSheetName);

                    // ì‚¬ìš©ì ì œê³µ íŒ¨í„´ì— ë”°ë¥¸ SITEëª… ì…€ ë²”ìœ„ (ì „ì²´ ë²”ìœ„ë¡œ í™•ì¥)
                    const siteNameRanges = [
                        `'${latestReportSheetName}'!B:B`, // Bì—´ ì „ì²´ì—ì„œ SITEëª… ì°¾ê¸°
                        `'${latestReportSheetName}'!G:G`, // Gì—´ ì „ì²´ì—ì„œ SITEëª… ì°¾ê¸°
                        `'${latestReportSheetName}'!L:L`, // Lì—´ ì „ì²´ì—ì„œ SITEëª… ì°¾ê¸°
                    ];

                    try {
                        const siteResponse = await gapi.client.sheets.spreadsheets.values.batchGet({
                            spreadsheetId: SPREADSHEET_ID,
                            ranges: siteNameRanges,
                        });
                        console.log('Site Names Batch Get Response:', siteResponse);

                        const fetchedSites = new Set();
                        const lColumnSitesWithoutCustomerRequests = new Set(); // Lì—´ì˜ 40í–‰ ì´í›„ ì‚¬ì´íŠ¸ë“¤
                        
                        siteResponse.result.valueRanges.forEach((rangeData, rangeIndex) => {
                            if (rangeData.values) {
                                rangeData.values.forEach((row, rowIndex) => {
                                    if (row.length > 0 && row[0] && row[0].trim() !== '') {
                                        const cellValue = row[0].trim();
                                        // í—¤ë”ë‚˜ ì„¤ëª… í…ìŠ¤íŠ¸ê°€ ì•„ë‹Œ ì‹¤ì œ ì‚¬ì´íŠ¸ëª…ë§Œ í•„í„°ë§
                                        if (cellValue !== 'SITEëª…' && 
                                            !cellValue.includes('ê¸ˆì£¼ í•œ ì¼') && 
                                            !cellValue.includes('ì°¨ì£¼ í•  ì¼') && 
                                            !cellValue.includes('ê³ ê° ìš”ì²­ì‚¬í•­') &&
                                            !cellValue.includes('ë³¸ì¸ ì„±ëª…') &&
                                            !cellValue.includes('í•„ìˆ˜ ì…ë ¥') &&
                                            !cellValue.includes('ì—†ìŒ') &&
                                            !cellValue.includes('â–¶') &&
                                            !cellValue.includes('êµ¬ë¶„') &&
                                            !cellValue.includes('ì‘ì„± ë“±ë¡ì¼') &&
                                            !cellValue.includes('ë§¤ì£¼ ëª©ìš”ì¼') &&
                                            !cellValue.includes('íœ´ì¼ì€ ì „ì¼') &&
                                            !cellValue.includes('ê° í•­ëª©') &&
                                            !cellValue.includes('ì‘ì„± ë‚´ìš©ì´ ì—†ìœ¼ë©´') &&
                                            !cellValue.includes('SITEëª… ìˆœì„œ') &&
                                            !cellValue.includes('í”„ë¡œì íŠ¸ ìˆœ í‘œì‹œ') &&
                                            !cellValue.includes('25ë…„ í˜„ì¬') &&
                                            !cellValue.includes('ì¶”ì§„ ä¸­ í”„ë¡œì íŠ¸') &&
                                            rowIndex >= 3) { // 4í–‰ë¶€í„° ì‹œì‘ (0-basedì´ë¯€ë¡œ 3)
                                            
                                            fetchedSites.add(cellValue);
                                            
                                            // Lì—´(rangeIndex === 2)ì´ê³  40í–‰ ì´í›„(rowIndex >= 39, 0-basedì´ë¯€ë¡œ 40í–‰ì€ 39)ì¸ ê²½ìš°
                                            if (rangeIndex === 2 && rowIndex >= 39) {
                                                lColumnSitesWithoutCustomerRequests.add(cellValue);
                                                console.log(`Lì—´ 40í–‰ ì´í›„ ì‚¬ì´íŠ¸ ë°œê²¬: ${cellValue} (í–‰: ${rowIndex + 1})`);
                                            }
                                        }
                                    }
                                });
                            }
                        });
                        
                        // Lì—´ 40í–‰ ì´í›„ ì‚¬ì´íŠ¸ë“¤ì„ ì˜ˆì™¸ ëª©ë¡ì— ì¶”ê°€
                        sitesWithoutCustomerRequests = Array.from(lColumnSitesWithoutCustomerRequests);
                        console.log('ë™ì ìœ¼ë¡œ ìƒì„±ëœ ì˜ˆì™¸ ì‚¬ì´íŠ¸ ëª©ë¡:', sitesWithoutCustomerRequests);
                        originalSites = Array.from(fetchedSites).sort();
                        console.log('Original Sites from latest report sheet:', originalSites); // ìƒˆë¡œ ê°€ì ¸ì˜¨ ì‚¬ì´íŠ¸ ëª©ë¡ ì¶œë ¥

                    } catch (siteErr) {
                        console.error('Error fetching site names from latest report sheet:', siteErr);
                        // ì˜¤ë¥˜ ë°œìƒ ì‹œ ì‚¬ì´íŠ¸ ëª©ë¡ì„ ë¹„ì›Œë‘ 
                        originalSites = [];
                    }
                } else {
                    console.log('No YYYY-MM-DD report sheets found, cannot fetch site names.');
                    originalSites = [];
                }

                // ì‚¬ì´íŠ¸ ë“œë¡­ë‹¤ìš´ ì±„ìš°ê¸°
                updateSiteDropdown(originalSites, document.getElementById('searchSite').value);
                
                // ì´ˆê¸° ìƒíƒœì—ì„œ ê³ ê° ìš”ì²­ì‚¬í•­ í•„ë“œ ìƒíƒœ ì„¤ì •
                toggleCustomerRequestsField('');
                
                // ì´ˆê¸° ìƒíƒœì—ì„œ "ê³ ì •/ì„ íƒ" ë²„íŠ¼ ìƒíƒœ ì„¤ì •
                updateConfirmSiteButtonState();

                // Google Sheets ë§í¬ ìƒì„± (ì „ì²´ ìŠ¤í”„ë ˆë“œì‹œíŠ¸)
                const mainSheetUrl = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/edit`;
                document.getElementById('response').innerHTML = `
                    ë§¤ë‹ˆì €/ì‚¬ì´íŠ¸/ì‹œíŠ¸ ëª©ë¡ì„ ì„±ê³µì ìœ¼ë¡œ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.<br>
                    <a href="${mainSheetUrl}" target="_blank" style="color: #1976d2; text-decoration: underline; margin-top: 10px; display: inline-block;">
                        ğŸ“Š Google Sheetsì—ì„œ í™•ì¸í•˜ê¸°
                    </a>
                `;
                
                // ë„¤ë¹„ê²Œì´ì…˜ ì •ë³´ ì—…ë°ì´íŠ¸
                updateNavigationInfo('ë§¤ë‹ˆì €, ì‚¬ì´íŠ¸, ë³´ê³ ì„œë¥¼ ì„ íƒí•œ í›„ ê³ ì •/ì„ íƒì„ ëˆ„ë¥´ì„¸ìš”');
                document.getElementById('response').style.display = 'block';

                // ë“œë¡­ë‹¤ìš´ ì¡°íšŒ ë²„íŠ¼ ìˆ¨ê¹€ ì²˜ë¦¬
                queryButton.style.display = 'none';

            } catch (err) {
                console.error('Error fetching dropdown data (detailed):', err); // ìƒì„¸ ì˜¤ë¥˜ ì¶œë ¥
                document.getElementById('response').textContent = 'ë“œë¡­ë‹¤ìš´ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + (err.result?.error?.message || err.message || JSON.stringify(err));
                document.getElementById('response').style.display = 'block';

                // ì˜¤ë¥˜ ë°œìƒ ì‹œì—ë„ ë²„íŠ¼ ìˆ¨ê¹€ (ì¬ì‹œë„ëŠ” í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ìœ¼ë¡œ)
                const queryButton = document.getElementById('queryDropdownsButton');
                queryButton.style.display = 'none';
            }
        }

        /**
         * ë§¤ë‹ˆì € ë“œë¡­ë‹¤ìš´ì„ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
         * @param {Array<string>} managersList í‘œì‹œí•  ë§¤ë‹ˆì € ëª©ë¡
         */
        function updateManagerDropdown(managersList) {
            console.log('Updating Manager Dropdown with:', managersList); // ë§¤ë‹ˆì € ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸ ì „ ëª©ë¡ ì¶œë ¥
            const managerSelect = document.getElementById('manager');
            managerSelect.innerHTML = '<option value="">ì„ íƒí•˜ì„¸ìš”</option>'; // ê¸°ì¡´ ì˜µì…˜ ì œê±°
            
            // ì§ì ‘ì…ë ¥ ì˜µì…˜ì„ ë§¨ ìœ„ì— ì¶”ê°€
            const directInputOption = document.createElement('option');
            directInputOption.value = 'ì§ì ‘ì…ë ¥';
            directInputOption.textContent = 'ì§ì ‘ì…ë ¥';
            managerSelect.appendChild(directInputOption);
            
            // ë§¤ë‹ˆì € ëª©ë¡ ì¶”ê°€
            managersList.forEach(manager => {
                const option = document.createElement('option');
                option.value = manager;
                option.textContent = manager;
                managerSelect.appendChild(option);
            });
        }

        /**
         * ì‚¬ì´íŠ¸ ë“œë¡­ë‹¤ìš´ì„ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
         * @param {Array<string>} sitesList í‘œì‹œí•  ì‚¬ì´íŠ¸ ëª©ë¡
         * @param {string} searchTerm ì‚¬ì´íŠ¸ ê²€ìƒ‰ì–´ (í˜„ì¬ëŠ” ì‚¬ìš©í•˜ì§€ ì•ŠìŒ)
         */
        function updateSiteDropdown(sitesList, searchTerm = '') {
            console.log('Updating Site Dropdown with:', sitesList, 'Search Term:', searchTerm); // ì‚¬ì´íŠ¸ ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸ ì „ ëª©ë¡ ì¶œë ¥
            const siteSelect = document.getElementById('site_name');
            siteSelect.innerHTML = '<option value="">ì„ íƒí•˜ì„¸ìš”</option>'; // ê¸°ì¡´ ì˜µì…˜ ì œê±°

            const filteredSites = sitesList.filter(site =>
                site.toLowerCase().includes(searchTerm.toLowerCase())
            ).sort();

            filteredSites.forEach(site => {
                const option = document.createElement('option');
                option.value = site;
                
                // ê³ ê° ìš”ì²­ì‚¬í•­ ì…ë ¥ ë¶ˆê°€ ì‚¬ì´íŠ¸ì¸ ê²½ìš° "(í”„ë¡œì íŠ¸)" ì ‘ë‘ì‚¬ ì¶”ê°€
                if (sitesWithoutCustomerRequests.includes(site)) {
                    option.textContent = `(í”„ë¡œì íŠ¸) ${site}`;
                } else {
                    option.textContent = site;
                }
                
                siteSelect.appendChild(option);
            });
        }


        /**
         * ì„ íƒëœ ë§¤ë‹ˆì € ê°’ì„ ê°€ì ¸ì˜µë‹ˆë‹¤ (ë“œë¡­ë‹¤ìš´ ë˜ëŠ” ì§ì ‘ì…ë ¥).
         * @returns {string} ë§¤ë‹ˆì € ì´ë¦„ (ì—¬ëŸ¬ ëª…ì¸ ê²½ìš° ì¤„ë°”ê¿ˆìœ¼ë¡œ êµ¬ë¶„)
         */
        function getManagerValue() {
            const managerSelect = document.getElementById('manager');
            const directInput = document.getElementById('managerDirectInput');
            
            if (managerSelect.value === 'ì§ì ‘ì…ë ¥') {
                const inputValue = directInput.value.trim();
                if (inputValue === '') return '';
                
                // ì½¤ë§ˆë‚˜ ê³µë°±ìœ¼ë¡œ êµ¬ë¶„ëœ ì´ë¦„ë“¤ì„ ì¤„ë°”ê¿ˆìœ¼ë¡œ ë³€í™˜
                return inputValue.split(/[,\s]+/).filter(name => name.trim() !== '').join('\n');
            } else {
                return managerSelect.value;
            }
        }

        /**
         * "ê³ ì •/ì„ íƒ" ë²„íŠ¼ì˜ í™œì„±í™”/ë¹„í™œì„±í™” ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
         */
        function updateConfirmSiteButtonState() {
            const confirmButton = document.getElementById('confirmSiteButton');
            const managerValue = getManagerValue();
            const siteSelected = document.getElementById('site_name').value !== '';
            const reportSheetSelected = document.getElementById('reportSheetName').value !== '';
            
            if (managerValue !== '' && siteSelected && reportSheetSelected) {
                confirmButton.disabled = false;
                confirmButton.textContent = 'ê³ ì •/ì„ íƒ';
            } else {
                confirmButton.disabled = true;
                confirmButton.textContent = 'ê³ ì •/ì„ íƒ';
            }
        }

        /**
         * ì„ íƒëœ ì‚¬ì´íŠ¸ì— ë”°ë¼ ê³ ê° ìš”ì²­ì‚¬í•­ í•„ë“œë¥¼ í™œì„±í™”/ë¹„í™œì„±í™”í•©ë‹ˆë‹¤.
         * @param {string} selectedSite ì„ íƒëœ ì‚¬ì´íŠ¸ëª…
         */
        function toggleCustomerRequestsField(selectedSite) {
            const customerRequestsContainer = document.getElementById('customer_requests_container');
            const customerRequestsLabel = document.querySelector('label[for="customer_requests"]');
            const noneCheckbox = document.getElementById('customer_requests_none');
            const addItemBtn = customerRequestsContainer.parentElement.querySelector('.add-item-btn');
            
            console.log('toggleCustomerRequestsField called with:', selectedSite);
            console.log('Checking if site is in exception list...');
            
            if (sitesWithoutCustomerRequests.includes(selectedSite)) {
                // ê³ ê° ìš”ì²­ì‚¬í•­ ì…ë ¥ ë¶ˆê°€ ì‚¬ì´íŠ¸ì¸ ê²½ìš°
                customerRequestsContainer.style.opacity = '0.5';
                customerRequestsContainer.style.pointerEvents = 'none';
                customerRequestsContainer.style.backgroundColor = '#f5f5f5';
                customerRequestsLabel.style.color = '#999';
                customerRequestsLabel.textContent = 'ê³ ê° ìš”ì²­ì‚¬í•­ (ì…ë ¥ ë¶ˆê°€)';
                
                // "ì—†ìŒ" ì²´í¬ë°•ìŠ¤ ë¹„í™œì„±í™”
                if (noneCheckbox) {
                    noneCheckbox.disabled = true;
                    noneCheckbox.checked = false;
                }
                
                // "í•­ëª© ì¶”ê°€" ë²„íŠ¼ ë¹„í™œì„±í™”
                if (addItemBtn) {
                    addItemBtn.disabled = true;
                }
                
                // ê¸°ì¡´ ê°’ ì´ˆê¸°í™”
                setListData('customer_requests_container', '');
            } else {
                // ì¼ë°˜ ì‚¬ì´íŠ¸ì¸ ê²½ìš°
                customerRequestsContainer.style.opacity = '1';
                customerRequestsContainer.style.pointerEvents = 'auto';
                customerRequestsContainer.style.backgroundColor = '';
                customerRequestsLabel.style.color = '';
                customerRequestsLabel.textContent = 'ê³ ê° ìš”ì²­ì‚¬í•­';
                
                // "ì—†ìŒ" ì²´í¬ë°•ìŠ¤ í™œì„±í™”
                if (noneCheckbox) {
                    noneCheckbox.disabled = false;
                }
                
                // "í•­ëª© ì¶”ê°€" ë²„íŠ¼ í™œì„±í™”
                if (addItemBtn) {
                    addItemBtn.disabled = false;
                }
            }
        }

        /**
         * "ê³ ì •/ì„ íƒ" ë²„íŠ¼ í´ë¦­ ì‹œ í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜
         */
        function confirmSiteSelection() {
            const managerValue = getManagerValue();
            const siteSelected = document.getElementById('site_name').value;
            const reportSheetSelected = document.getElementById('reportSheetName').value;
            const responseDiv = document.getElementById('response');
            const confirmButton = document.getElementById('confirmSiteButton');
            
            // ëª¨ë“  ë“œë¡­ë‹¤ìš´ì´ ì„ íƒë˜ì—ˆëŠ”ì§€ í™•ì¸
            if (!managerValue || !siteSelected || !reportSheetSelected) {
                responseDiv.textContent = 'ë§¤ë‹ˆì €, ë‹´ë‹¹ ì‚¬ì´íŠ¸, ë³´ê³ ì„œ ì‹œíŠ¸ ì´ë¦„ì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”.';
                responseDiv.style.display = 'block';
                responseDiv.style.backgroundColor = '#ffebee';
                responseDiv.style.color = '#c62828';
                return;
            }
            
            // ë²„íŠ¼ ì‹œê°ì  í”¼ë“œë°±
            confirmButton.disabled = true;
            confirmButton.textContent = 'ì²˜ë¦¬ ì¤‘...';
            confirmButton.style.backgroundColor = '#6c757d';
            
            // ë””ë²„ê¹…ì„ ìœ„í•œ ë¡œê·¸ ì¶”ê°€
            console.log('Selected site:', siteSelected);
            console.log('Sites without customer requests:', sitesWithoutCustomerRequests);
            console.log('Is site in exception list?', sitesWithoutCustomerRequests.includes(siteSelected));
            
            // ì‚¬ì´íŠ¸ ì„ íƒì— ë”°ë¼ ê³ ê° ìš”ì²­ì‚¬í•­ í•„ë“œ ìƒíƒœ ì„¤ì •
            toggleCustomerRequestsField(siteSelected);
            
            // Google Sheets ë§í¬ ìƒì„± (ì„ íƒëœ ë³´ê³ ì„œ ì‹œíŠ¸ì— ë”°ë¼)
            const selectedReportSheetName = document.getElementById('reportSheetName').value;
            const selectedOption = document.getElementById('reportSheetName').selectedOptions[0];
            const reportSheetId = selectedOption ? selectedOption.dataset.sheetId : '';
            const sheetUrl = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/edit#gid=${reportSheetId}`;
            
            // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
            responseDiv.innerHTML = `
                ì‚¬ì´íŠ¸ ì„ íƒì´ í™•ì •ë˜ì—ˆìŠµë‹ˆë‹¤: ${siteSelected}<br>
                <a href="${sheetUrl}" target="_blank" style="color: #1976d2; text-decoration: underline; margin-top: 10px; display: inline-block;">
                    ğŸ“Š Google Sheetsì—ì„œ í™•ì¸í•˜ê¸°
                </a>
            `;
            responseDiv.style.display = 'block';
            responseDiv.style.backgroundColor = '#e8f5e8';
            responseDiv.style.color = '#2e7d32';
            
            // ë„¤ë¹„ê²Œì´ì…˜ ì •ë³´ ì—…ë°ì´íŠ¸
            updateNavigationInfo('ì•„ë˜ í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•œ í›„ ë³´ê³ ì„œ ì œì¶œì„ ëˆ„ë¥´ì„¸ìš”');
            
            // 1ì´ˆ í›„ ë²„íŠ¼ ìƒíƒœ ë³µì›
            setTimeout(() => {
                confirmButton.disabled = false;
                confirmButton.textContent = 'ê³ ì •/ì„ íƒ';
                confirmButton.style.backgroundColor = '#2196F3';
            }, 1000);
        }

        /**
         * ë³´ê³ ì„œ ì‹œíŠ¸ ì´ë¦„ ë“œë¡­ë‹¤ìš´ì„ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
         * @param {Array<{title: string, id: number}>} sheetNamesList í‘œì‹œí•  ì‹œíŠ¸ ì´ë¦„ ë° ID ëª©ë¡
         * @param {string} searchTerm ì‹œíŠ¸ ì´ë¦„ ê²€ìƒ‰ì–´ (í˜„ì¬ëŠ” ì‚¬ìš©í•˜ì§€ ì•ŠìŒ)
         */
        function updateReportSheetNameDropdown(sheetNamesList, searchTerm = '') {
            console.log('Updating Report Sheet Name Dropdown with:', sheetNamesList); // ì‹œíŠ¸ ì´ë¦„ ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸ ì „ ëª©ë¡ ì¶œë ¥
            const reportSheetNameSelect = document.getElementById('reportSheetName');
            reportSheetNameSelect.innerHTML = '<option value="">ì„ íƒí•˜ì„¸ìš”</option>'; // ê¸°ì¡´ ì˜µì…˜ ì œê±°

            // ê²€ìƒ‰ ê¸°ëŠ¥ì´ ì—†ìœ¼ë¯€ë¡œ ëª¨ë“  ì‹œíŠ¸ ì´ë¦„ í‘œì‹œ
            sheetNamesList.forEach(sheet => {
                const option = document.createElement('option');
                option.value = sheet.title;
                option.textContent = sheet.title;
                option.dataset.sheetId = sheet.id; // sheetIdë¥¼ data-sheet-id ì†ì„±ìœ¼ë¡œ ì €ì¥
                reportSheetNameSelect.appendChild(option);
            });
        }

        // ë§¤ë‹ˆì € ê²€ìƒ‰ í•„ë“œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.getElementById('searchManager').addEventListener('keyup', function() {
            const searchTerm = this.value.toLowerCase();
            const filteredManagers = originalManagers.filter(manager =>
                manager.toLowerCase().includes(searchTerm)
            );
            console.log('Filtered Managers (searchManager keyup):', filteredManagers); // ë§¤ë‹ˆì € ê²€ìƒ‰ í•„í„°ë§ ê²°ê³¼ ì¶œë ¥
            updateManagerDropdown(filteredManagers);
            updateReadReportButtonState(); // ë§¤ë‹ˆì € ë³€ê²½ ì‹œ ë³´ê³ ì„œ ì¡°íšŒ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
        });

        // ì‚¬ì´íŠ¸ ê²€ìƒ‰ í•„ë“œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.getElementById('searchSite').addEventListener('keyup', function() {
            const searchTerm = this.value.toLowerCase();
            updateSiteDropdown(originalSites, searchTerm); // ë§¤ë‹ˆì € í•„í„°ë§ ì—†ì´ ì „ì²´ ì‚¬ì´íŠ¸ì—ì„œ ê²€ìƒ‰
            updateReadReportButtonState(); // ì‚¬ì´íŠ¸ ë³€ê²½ ì‹œ ë³´ê³ ì„œ ì¡°íšŒ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
        });

        // ë§¤ë‹ˆì € ë“œë¡­ë‹¤ìš´ ë³€ê²½ ì‹œ ë³´ê³ ì„œ ì¡°íšŒ ë²„íŠ¼ ë° ê³ ì •/ì„ íƒ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
        document.getElementById('manager').addEventListener('change', function() {
            const directInput = document.getElementById('managerDirectInput');
            if (this.value === 'ì§ì ‘ì…ë ¥') {
                directInput.style.display = 'block';
                directInput.focus();
            } else {
                directInput.style.display = 'none';
                directInput.value = '';
            }
            updateReadReportButtonState();
            updateConfirmSiteButtonState();
        });

        // ì§ì ‘ì…ë ¥ í•„ë“œ ë³€ê²½ ì‹œ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
        document.getElementById('managerDirectInput').addEventListener('input', function() {
            updateReadReportButtonState();
            updateConfirmSiteButtonState();
        });

        // ì‚¬ì´íŠ¸ ë“œë¡­ë‹¤ìš´ ë³€ê²½ ì‹œ ë³´ê³ ì„œ ì¡°íšŒ ë²„íŠ¼ ìƒíƒœë§Œ ì—…ë°ì´íŠ¸
        document.getElementById('site_name').addEventListener('change', function() {
            updateReadReportButtonState();
            updateConfirmSiteButtonState();
        });

        // ë³´ê³ ì„œ ì‹œíŠ¸ ì´ë¦„ ë“œë¡­ë‹¤ìš´ ë³€ê²½ ì‹œ ë³´ê³ ì„œ ì¡°íšŒ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
        document.getElementById('reportSheetName').addEventListener('change', function() {
            updateReadReportButtonState();
            updateConfirmSiteButtonState();
        });

        // "ê³ ì •/ì„ íƒ" ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.getElementById('confirmSiteButton').addEventListener('click', confirmSiteSelection);

        // "ë³´ê³ ì„œ ì¡°íšŒ" ë²„íŠ¼ì˜ í™œì„±í™”/ë¹„í™œì„±í™” ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í•˜ëŠ” í—¬í¼ í•¨ìˆ˜
        function updateReadReportButtonState() {
            const managerValue = getManagerValue();
            const siteSelected = document.getElementById('site_name').value !== '';
            const reportSheetNameSelected = document.getElementById('reportSheetName').value !== '';
            const readReportButton = document.getElementById('readReportButton');

            if (managerValue !== '' && siteSelected && reportSheetNameSelected) {
                readReportButton.disabled = false;
                readReportButton.style.backgroundColor = '#4CAF50'; // ì›ë˜ ìƒ‰ìƒ
            } else {
                readReportButton.disabled = true;
                readReportButton.style.backgroundColor = '#cccccc'; // ë¹„í™œì„±í™” ìƒ‰ìƒ
            }
        }

        document.getElementById('reportForm').addEventListener('submit', async function(event) {
            event.preventDefault();

            // ì—”í„°í‚¤ë¡œ ì œì¶œë˜ëŠ” ê²ƒì„ ë°©ì§€ (ë²„íŠ¼ í´ë¦­ìœ¼ë¡œë§Œ ì œì¶œ)
            if (event.submitter === null) {
                console.log('Form submission blocked - only button clicks allowed');
                return;
            }

            if (!gapi.client.getToken()) {
                // í† í°ì´ ì—†ìœ¼ë©´ ìŠ¹ì¸ ìš”ì²­
                tokenClient.callback = async (resp) => {
                    if (resp.error !== undefined) {
                        throw (resp);
                    }
                    // í† í° íšë“ í›„ í¼ ì œì¶œ ì¬ì‹œë„
                    submitFormData(event); // event ê°ì²´ ì „ë‹¬
                };
                tokenClient.requestAccessToken();
            } else {
                // í† í°ì´ ìˆìœ¼ë©´ ë°”ë¡œ í¼ ì œì¶œ
                submitFormData(event); // event ê°ì²´ ì „ë‹¬
            }
        });

        async function submitFormData(event) {
            const formData = {
                site_name: document.getElementById('site_name').value,
                manager: getManagerValue(), // ì§ì ‘ì…ë ¥ ë˜ëŠ” ë“œë¡­ë‹¤ìš´ ì„ íƒ ê°’
                this_week_tasks: getListData('this_week_tasks_container'),
                next_week_tasks: getListData('next_week_tasks_container'),
                customer_requests: getListData('customer_requests_container')
            };

            console.log('Form Data:', formData);
            console.log('Sites without customer requests:', sitesWithoutCustomerRequests);
            console.log('Is current site in exception list?', sitesWithoutCustomerRequests.includes(formData.site_name));

            const responseDiv = document.getElementById('response');
            responseDiv.style.display = 'block';
            responseDiv.textContent = 'ë³´ê³ ì„œ ì œì¶œ ì¤‘...';

            // ë³´ê³ ì„œ ì‹œíŠ¸ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            // SPREADSHEET_IDëŠ” ìƒë‹¨ì—ì„œ í™˜ê²½ë³€ìˆ˜ë¡œ ì„¤ì •ë¨
            const REPORT_SHEET_NAME = document.getElementById('reportSheetName').value;
            const selectedOption = document.getElementById('reportSheetName').selectedOptions[0];
            const REPORT_SHEET_ID = selectedOption ? parseInt(selectedOption.dataset.sheetId) : null;
            
            // ë””ë²„ê¹…ì„ ìœ„í•œ ë¡œê·¸ ì¶”ê°€
            console.log('Submit Form Data - Debug Info:');
            console.log('SPREADSHEET_ID:', SPREADSHEET_ID);
            console.log('REPORT_SHEET_NAME:', REPORT_SHEET_NAME);
            console.log('selectedOption:', selectedOption);
            console.log('REPORT_SHEET_ID:', REPORT_SHEET_ID);
            console.log('selectedOption.dataset.sheetId:', selectedOption ? selectedOption.dataset.sheetId : 'N/A');
            
            // ì‹œíŠ¸ IDê°€ ì—†ìœ¼ë©´ ì˜¤ë¥˜ ì²˜ë¦¬
            if (!REPORT_SHEET_ID) {
                console.error('REPORT_SHEET_ID is null or undefined');
                responseDiv.textContent = 'ë³´ê³ ì„œ ì‹œíŠ¸ IDë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
                return;
            }

            // ìŠ¤í”„ë ˆë“œì‹œíŠ¸ì˜ ì—´ ìˆœì„œë¥¼ ì •ì˜í•©ë‹ˆë‹¤. SITEëª…, ë‹´ë‹¹ì, ê¸ˆì£¼ í•œ ì¼ ìˆœì„œì…ë‹ˆë‹¤.
            // ì‹¤ì œ ìŠ¤í”„ë ˆë“œì‹œíŠ¸ì˜ ì—´ ìˆœì„œì™€ ì¼ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤.
            const COLUMN_ORDER = ['SITEëª…', 'ë‹´ë‹¹ì', 'ê¸ˆì£¼ í•œ ì¼']; 

            try {
                // ì‹œíŠ¸ì˜ ì „ì²´ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                const response = await gapi.client.sheets.spreadsheets.values.get({
                    spreadsheetId: SPREADSHEET_ID,
                    range: `${REPORT_SHEET_NAME}!A:Z`, // ì¶©ë¶„íˆ ë„“ì€ ë²”ìœ„ë¡œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤ã€‚
                });

                const sheetData = response.result.values || [];

                // site_name ìœ„ì¹˜ ì°¾ê¸°
                const { row, col } = findCellCoordinates(sheetData, formData.site_name, REPORT_SHEET_NAME, COLUMN_ORDER);

                if (row === -1 || col === -1) {
                    throw new Error(`ë‹´ë‹¹ ì‚¬ì´íŠ¸ '${formData.site_name}'ë¥¼ ì‹œíŠ¸ì—ì„œ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
                }

                const updates = []; // values.batchUpdateë¥¼ ìœ„í•œ ì—…ë°ì´íŠ¸ ë°°ì—´

                // ëª¨ë“  ì…€ì— ì ìš©í•  ê³µí†µ ì„œì‹
                // const cellFormat = {
                //     textFormat: {
                //         fontSize: 11,
                //         bold: true,
                //         fontFamily: 'Arial' // í°íŠ¸ ë³€ì§ˆ ë°©ì§€ë¥¼ ìœ„í•´ Arial í°íŠ¸ ì§€ì •
                //     }
                // };

                // ë‹´ë‹¹ì ì…€ (site_name ì…€ì˜ í–‰ì€ ë™ì¼, ì—´ì€ ë°”ë¡œ ì˜¤ë¥¸ìª½)
                const managerColOffset = COLUMN_ORDER.indexOf('ë‹´ë‹¹ì');
                const managerRange = `'${REPORT_SHEET_NAME}'!${columnToLetter(col + managerColOffset)}${row + 1}`;
                updates.push({
                    range: managerRange,
                    values: [[formData.manager]]
                });

                // ê¸ˆì£¼ í•œ ì¼ ì…€ (site_name ì…€ì˜ í–‰ì€ ë™ì¼, ì—´ì€ 'ê¸ˆì£¼ í•œ ì¼'ì´ ìˆëŠ” ì—´)
                let thisWeekTasksRelativeOffset = COLUMN_ORDER.indexOf('ê¸ˆì£¼ í•œ ì¼');
                thisWeekTasksRelativeOffset += 1; // Nì—´ì—ì„œ Oì—´ë¡œ ì´ë™í•˜ê¸° ìœ„í•´ 1 ì¶”ê°€
                const thisWeekTasksRange = `'${REPORT_SHEET_NAME}'!${columnToLetter(col + thisWeekTasksRelativeOffset)}${row + 1}`;
                updates.push({
                    range: thisWeekTasksRange,
                    values: [[`â–¶ ${formData.this_week_tasks}`]]
                });

                // ì°¨ì£¼ í•  ì¼ ì…€ (site_name ì…€ì˜ í–‰ì€ ì•„ë˜ë¡œ 1ì¹¸, ì—´ì€ 'ê¸ˆì£¼ í•œ ì¼'ê³¼ ë™ì¼)
                const nextWeekTasksRange = `'${REPORT_SHEET_NAME}'!${columnToLetter(col + thisWeekTasksRelativeOffset)}${row + 2}`;
                updates.push({
                    range: nextWeekTasksRange,
                    values: [[`â–¶ ${formData.next_week_tasks}`]]
                });

                // ê³ ê° ìš”ì²­ì‚¬í•­ ì…€ (site_name ì…€ì˜ í–‰ì€ ì•„ë˜ë¡œ 2ì¹¸, ì—´ì€ 'ê¸ˆì£¼ í•œ ì¼'ê³¼ ë™ì¼)
                // ì˜ˆì™¸ ì‚¬ì´íŠ¸ê°€ ì•„ë‹Œ ê²½ìš°ì—ë§Œ ê³ ê° ìš”ì²­ì‚¬í•­ ì²˜ë¦¬
                if (formData.customer_requests && !sitesWithoutCustomerRequests.includes(formData.site_name)) {
                    const customerRequestsRange = `'${REPORT_SHEET_NAME}'!${columnToLetter(col + thisWeekTasksRelativeOffset)}${row + 3}`;
                    updates.push({
                        range: customerRequestsRange,
                        values: [[`â–¶ ${formData.customer_requests}`]]
                    });
                }

                // batchUpdate ìš”ì²­ (ì…€ ê°’ë§Œ ì—…ë°ì´íŠ¸, ì„œì‹ ìœ ì§€)
                await gapi.client.sheets.spreadsheets.values.batchUpdate({
                    spreadsheetId: SPREADSHEET_ID,
                    resource: {
                        data: updates,
                        valueInputOption: 'USER_ENTERED'
                    }
                });

                // Google Sheets ë§í¬ ìƒì„±
                const sheetUrl = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/edit#gid=${REPORT_SHEET_ID}`;
                responseDiv.innerHTML = `
                    ë³´ê³ ì„œê°€ ì„±ê³µì ìœ¼ë¡œ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤!<br>
                    <a href="${sheetUrl}" target="_blank" style="color: #1976d2; text-decoration: underline; margin-top: 10px; display: inline-block;">
                        ğŸ“Š Google Sheetsì—ì„œ í™•ì¸í•˜ê¸°
                    </a>
                `;

                // ë“œë¡­ë‹¤ìš´ ê°’ í™•ì¸ (ì´ˆê¸°í™”ë˜ê¸° ì „)
                console.log('Manager dropdown value before clearing text fields:', document.getElementById('manager').value);
                console.log('Site dropdown value before clearing text fields:', document.getElementById('site_name').value);
                console.log('Report Sheet Name dropdown value before clearing text fields:', document.getElementById('reportSheetName').value);

                // ë¦¬ìŠ¤íŠ¸ í•„ë“œë§Œ ì´ˆê¸°í™”
                setListData('this_week_tasks_container', '');
                setListData('next_week_tasks_container', '');
                setListData('customer_requests_container', '');

            } catch (err) {
                console.error('Error submitting report:', err);
                responseDiv.textContent = 'ë³´ê³ ì„œ ì œì¶œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + (err.result?.error?.message || err.message);
            }
        }

        async function readReportData() {
            console.log('readReportData function called.');
            const readReportButton = document.getElementById('readReportButton');
            const responseDiv = document.getElementById('response');

            // ë²„íŠ¼ ìƒíƒœë¥¼ ë¡œë”© ì¤‘ìœ¼ë¡œ ë³€ê²½
            readReportButton.textContent = 'ë¡œë”© ì¤‘...';
            readReportButton.style.backgroundColor = '#ffc107'; // ë¡œë”© ì¤‘ ìƒ‰ìƒ (ì˜ˆ: ì£¼í™©ìƒ‰)
            readReportButton.disabled = true;
            responseDiv.style.display = 'block';
            responseDiv.textContent = 'ë³´ê³ ì„œ ë°ì´í„° ì¡°íšŒ ì¤‘...';

            // SPREADSHEET_IDëŠ” ìƒë‹¨ì—ì„œ í™˜ê²½ë³€ìˆ˜ë¡œ ì„¤ì •ë¨
            const managerValue = getManagerValue();
            const selectedSiteName = document.getElementById('site_name').value;
            const selectedReportSheetName = document.getElementById('reportSheetName').value;

            if (!managerValue || !selectedSiteName || !selectedReportSheetName) {
                responseDiv.textContent = 'ë§¤ë‹ˆì €, ë‹´ë‹¹ ì‚¬ì´íŠ¸, ë³´ê³ ì„œ ì‹œíŠ¸ ì´ë¦„ì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”.';
                readReportButton.textContent = 'ë³´ê³ ì„œ ì¡°íšŒ';
                readReportButton.style.backgroundColor = '#4CAF50';
                readReportButton.disabled = false;
                return;
            }

            // ìŠ¤í”„ë ˆë“œì‹œíŠ¸ì˜ ì—´ ìˆœì„œë¥¼ ì •ì˜í•©ë‹ˆë‹¤. (ë°ì´í„° ì“°ê¸°ì™€ ë™ì¼)
            const COLUMN_ORDER = ['SITEëª…', 'ë‹´ë‹¹ì', 'ê¸ˆì£¼ í•œ ì¼'];

            try {
                // ì‹œíŠ¸ì˜ ì „ì²´ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (site_name ìœ„ì¹˜ ì°¾ê¸° ìœ„í•¨)
                const response = await gapi.client.sheets.spreadsheets.values.get({
                    spreadsheetId: SPREADSHEET_ID,
                    range: `${selectedReportSheetName}!A:Z`,
                });
                const sheetData = response.result.values || [];

                // site_name ìœ„ì¹˜ ì°¾ê¸°
                const { row, col } = findCellCoordinates(sheetData, selectedSiteName, selectedReportSheetName, COLUMN_ORDER);

                if (row === -1 || col === -1) {
                    throw new Error(`ë‹´ë‹¹ ì‚¬ì´íŠ¸ '${selectedSiteName}'ë¥¼ ì‹œíŠ¸ì—ì„œ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
                }

                // ì½ì–´ì˜¬ ì…€ ë²”ìœ„ ê³„ì‚° (ì“°ê¸° ìœ„ì¹˜ì™€ ë™ì¼í•˜ê²Œ)
                let thisWeekTasksRelativeOffset = COLUMN_ORDER.indexOf('ê¸ˆì£¼ í•œ ì¼');
                thisWeekTasksRelativeOffset += 1; // Oì—´ë¡œ ì´ë™í•˜ê¸° ìœ„í•´ 1 ì¶”ê°€

                // ì˜ˆì™¸ ì‚¬ì´íŠ¸ì— ë”°ë¼ ì½ì–´ì˜¬ ë²”ìœ„ ê²°ì •
                const rangesToRead = [
                    `'${selectedReportSheetName}'!${columnToLetter(col + thisWeekTasksRelativeOffset)}${row + 1}`, // ê¸ˆì£¼ í•œ ì¼
                    `'${selectedReportSheetName}'!${columnToLetter(col + thisWeekTasksRelativeOffset)}${row + 2}`  // ì°¨ì£¼ í•  ì¼
                ];
                
                // ì˜ˆì™¸ ì‚¬ì´íŠ¸ê°€ ì•„ë‹Œ ê²½ìš°ì—ë§Œ ê³ ê° ìš”ì²­ì‚¬í•­ ë²”ìœ„ ì¶”ê°€
                if (!sitesWithoutCustomerRequests.includes(selectedSiteName)) {
                    rangesToRead.push(`'${selectedReportSheetName}'!${columnToLetter(col + thisWeekTasksRelativeOffset)}${row + 3}`); // ê³ ê° ìš”ì²­ì‚¬í•­
                }

                console.log('Reading data from ranges:', rangesToRead);

                const readResponse = await gapi.client.sheets.spreadsheets.values.batchGet({
                    spreadsheetId: SPREADSHEET_ID,
                    ranges: rangesToRead,
                });
                console.log('Read API Response:', readResponse);

                const values = readResponse.result.valueRanges || [];

                // ë¦¬ìŠ¤íŠ¸ í•„ë“œì— ë°ì´í„° ì¶œë ¥ (â–¶ëŠ” setListDataì—ì„œ ìë™ ì œê±°ë¨)
                const thisWeekTasks = (values[0] && values[0].values && values[0].values[0]) ? values[0].values[0][0] : '';
                const nextWeekTasks = (values[1] && values[1].values && values[1].values[0]) ? values[1].values[0][0] : '';
                setListData('this_week_tasks_container', thisWeekTasks);
                setListData('next_week_tasks_container', nextWeekTasks);
                
                // ì˜ˆì™¸ ì‚¬ì´íŠ¸ê°€ ì•„ë‹Œ ê²½ìš°ì—ë§Œ ê³ ê° ìš”ì²­ì‚¬í•­ ì½ê¸°
                if (!sitesWithoutCustomerRequests.includes(selectedSiteName)) {
                    // ì˜ˆì™¸ ì‚¬ì´íŠ¸ê°€ ì•„ë‹Œ ê²½ìš° values[2]ê°€ ê³ ê° ìš”ì²­ì‚¬í•­
                    const customerRequests = (values[2] && values[2].values && values[2].values[0]) ? values[2].values[0][0] : '';
                    setListData('customer_requests_container', customerRequests);
                } else {
                    setListData('customer_requests_container', ''); // ì˜ˆì™¸ ì‚¬ì´íŠ¸ëŠ” ë¹ˆ ê°’ìœ¼ë¡œ ì„¤ì •
                }

                // Google Sheets ë§í¬ ìƒì„± (ì„ íƒëœ ë³´ê³ ì„œ ì‹œíŠ¸ì— ë”°ë¼)
                const selectedOption = document.getElementById('reportSheetName').selectedOptions[0];
                const reportSheetId = selectedOption ? selectedOption.dataset.sheetId : '';
                const sheetUrl = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/edit#gid=${reportSheetId}`;
                responseDiv.innerHTML = `
                    ë³´ê³ ì„œ ë°ì´í„°ë¥¼ ì„±ê³µì ìœ¼ë¡œ ì¡°íšŒí–ˆìŠµë‹ˆë‹¤!<br>
                    <a href="${sheetUrl}" target="_blank" style="color: #1976d2; text-decoration: underline; margin-top: 10px; display: inline-block;">
                        ğŸ“Š Google Sheetsì—ì„œ í™•ì¸í•˜ê¸°
                    </a>
                `;
                readReportButton.textContent = 'ì¡°íšŒ ì™„ë£Œ';
                readReportButton.style.backgroundColor = '#6c757d';
                // ì¡°íšŒ ì™„ë£Œ í›„ì—ë„ ë‹¤ì‹œ ì¡°íšŒí•  ìˆ˜ ìˆë„ë¡ í™œì„±í™” ìƒíƒœ ìœ ì§€
                readReportButton.disabled = false; 

                // 3ì´ˆ ë’¤ ë²„íŠ¼ ìƒíƒœ ì´ˆê¸°í™”
                setTimeout(() => {
                    readReportButton.textContent = 'ë³´ê³ ì„œ ì¡°íšŒ';
                    readReportButton.style.backgroundColor = '#4CAF50'; // ì›ë˜ ìƒ‰ìƒ
                    readReportButton.disabled = false;
                }, 3000); // 3ì´ˆ (3000ms)

            } catch (err) {
                console.error('Error reading report data:', err);
                responseDiv.textContent = 'ë³´ê³ ì„œ ë°ì´í„° ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + (err.result?.error?.message || err.message || JSON.stringify(err));
                readReportButton.textContent = 'ë³´ê³ ì„œ ì¡°íšŒ';
                readReportButton.style.backgroundColor = '#dc3545'; // ì˜¤ë¥˜ ì‹œ ë¹¨ê°„ìƒ‰
                readReportButton.disabled = false;
            }
        }

        document.getElementById('queryDropdownsButton').addEventListener('click', populateDropdowns);

        // ë³´ê³ ì„œ ì¡°íšŒ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.getElementById('readReportButton').addEventListener('click', readReportData);

        // ì‚¬ìš©ë²• íŒì—… ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        const helpButton = document.getElementById('helpButton');
        const helpModal = document.getElementById('helpModal');
        const closeButton = document.querySelector('.close');

        helpButton.addEventListener('click', function() {
            helpModal.style.display = 'block';
        });

        closeButton.addEventListener('click', function() {
            helpModal.style.display = 'none';
        });

        // ë°°ê²½ í´ë¦­ ì‹œ ëª¨ë‹¬ ë‹«ê¸°
        window.addEventListener('click', function(event) {
            if (event.target === helpModal) {
                helpModal.style.display = 'none';
            }
        });

        // ESC í‚¤ë¡œ ëª¨ë‹¬ ë‹«ê¸°
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape' && helpModal.style.display === 'block') {
                helpModal.style.display = 'none';
            }
        });

        // í¼ ë‚´ë¶€ì—ì„œ ì—”í„°í‚¤ë¡œ ì œì¶œë˜ëŠ” ê²ƒì„ ë°©ì§€ (ë°ìŠ¤í¬í†± + ëª¨ë°”ì¼)
        document.getElementById('reportForm').addEventListener('keydown', function(event) {
            if (event.key === 'Enter') {
                // ì…ë ¥ í•„ë“œì—ì„œ ì—”í„°í‚¤ë¥¼ ëˆ„ë¥¸ ê²½ìš° ì œì¶œ ë°©ì§€
                if (event.target.tagName === 'INPUT' || event.target.tagName === 'TEXTAREA') {
                    event.preventDefault();
                    console.log('Enter key submission blocked in form fields');
                }
            }
        });

        // ëª¨ë°”ì¼ì—ì„œ ê°€ìƒ í‚¤ë³´ë“œì˜ "ì™„ë£Œ" ë²„íŠ¼ìœ¼ë¡œ ì œì¶œë˜ëŠ” ê²ƒì„ ë°©ì§€
        document.getElementById('reportForm').addEventListener('keypress', function(event) {
            if (event.key === 'Enter' || event.keyCode === 13) {
                // ëª¨ë°”ì¼ ê°€ìƒ í‚¤ë³´ë“œì˜ ì™„ë£Œ ë²„íŠ¼ ë°©ì§€
                if (event.target.tagName === 'INPUT' || event.target.tagName === 'TEXTAREA') {
                    event.preventDefault();
                    console.log('Mobile keyboard submission blocked');
                }
            }
        });

        // ì—”í„°í‚¤ ì œì¶œ ë°©ì§€ í•¨ìˆ˜ (ëª¨ë°”ì¼ + ë°ìŠ¤í¬í†±)
        function preventEnterSubmit(event) {
            if (event.key === 'Enter' || event.keyCode === 13) {
                event.preventDefault();
                console.log('Enter key submission prevented');
                return false;
            }
        }

        // ë„¤ë¹„ê²Œì´ì…˜ ì •ë³´ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateNavigationInfo(message) {
            const navInfo = document.getElementById('navigationInfo');
            navInfo.textContent = message;
        }

        // ì„¹ì…˜ í™œì„±í™”/ë¹„í™œì„±í™” í•¨ìˆ˜
        function toggleSection(containerId, isChecked) {
            const container = document.getElementById(containerId);
            const addButton = container.nextElementSibling;
            
            if (isChecked) {
                // "ì—†ìŒ" ì²´í¬ ì‹œ ì„¹ì…˜ ë¹„í™œì„±í™”
                container.classList.add('section-disabled');
                if (addButton && addButton.classList.contains('add-item-btn')) {
                    addButton.style.display = 'none';
                }
                // ê¸°ì¡´ ë‚´ìš© ì´ˆê¸°í™”
                container.innerHTML = '';
            } else {
                // "ì—†ìŒ" ì²´í¬ í•´ì œ ì‹œ ì„¹ì…˜ í™œì„±í™”
                container.classList.remove('section-disabled');
                if (addButton && addButton.classList.contains('add-item-btn')) {
                    addButton.style.display = 'block';
                }
                // ë¹ˆ í•­ëª© ì¶”ê°€
                addListItem(containerId);
            }
        }

        // ë¦¬ìŠ¤íŠ¸ í•­ëª© ì¶”ê°€ í•¨ìˆ˜
        function addListItem(containerId) {
            const container = document.getElementById(containerId);
            const newItem = document.createElement('div');
            newItem.className = 'list-input-item';
            
            // ê³ ê° ìš”ì²­ì‚¬í•­ì¸ ê²½ìš° ë‚ ì§œ ì…ë ¥ ì¹¸ ì¶”ê°€
            if (containerId === 'customer_requests_container') {
                newItem.className = 'list-input-item customer-request-item';
                newItem.innerHTML = `
                    <div class="date-label">(ë°œìƒì¼)</div>
                    <input type="date" class="date-input" title="ë°œìƒì¼ ì„ íƒ">
                    <input type="text" placeholder="ê³ ê° ìš”ì²­ì‚¬í•­ì„ ì…ë ¥í•˜ì„¸ìš”..." class="list-input"
                           onkeydown="preventEnterSubmit(event)" onkeypress="preventEnterSubmit(event)">
                    <button type="button" class="remove-btn" onclick="removeListItem(this)">Ã—</button>
                `;
            } else if (containerId === 'this_week_tasks_container' || containerId === 'next_week_tasks_container') {
                // ê¸ˆì£¼ í•œ ì¼, í–¥í›„ í•  ì¼ì¸ ê²½ìš° ì‘ì—… ëŒ€ìƒ ì„ íƒ ì¶”ê°€
                newItem.className = 'list-input-item customer-request-item';
                const itemIndex = container.children.length + 1;
                const prefix = containerId === 'this_week_tasks_container' ? 'this_week' : 'next_week';
                const placeholder = containerId === 'this_week_tasks_container' ? 'ê¸ˆì£¼ í•œ ì¼ì„ ì…ë ¥í•˜ì„¸ìš”...' : 'í–¥í›„ í•  ì¼ì„ ì…ë ¥í•˜ì„¸ìš”...';
                
                newItem.innerHTML = `
                    <div class="target-label">(ì‘ì—… ëŒ€ìƒ)</div>
                    <div class="target-checkboxes">
                        <div class="target-checkbox-item">
                            <input type="checkbox" id="${prefix}_dev_${itemIndex}" name="${prefix}_target_${itemIndex}" value="ê°œë°œê³„">
                            <label for="${prefix}_dev_${itemIndex}">ê°œë°œê³„</label>
                        </div>
                        <div class="target-checkbox-item">
                            <input type="checkbox" id="${prefix}_ops_${itemIndex}" name="${prefix}_target_${itemIndex}" value="ìš´ì˜ê³„">
                            <label for="${prefix}_ops_${itemIndex}">ìš´ì˜ê³„</label>
                        </div>
                        <div class="target-checkbox-item">
                            <input type="checkbox" id="${prefix}_etc_${itemIndex}" name="${prefix}_target_${itemIndex}" value="ê¸°íƒ€">
                            <label for="${prefix}_etc_${itemIndex}">ê¸°íƒ€</label>
                        </div>
                    </div>
                    <input type="text" placeholder="${placeholder}" class="list-input"
                           onkeydown="preventEnterSubmit(event)" onkeypress="preventEnterSubmit(event)">
                    <button type="button" class="remove-btn" onclick="removeListItem(this)">Ã—</button>
                `;
            } else {
                newItem.innerHTML = `
                    <input type="text" placeholder="í•­ëª©ì„ ì…ë ¥í•˜ì„¸ìš”..." class="list-input"
                           onkeydown="preventEnterSubmit(event)" onkeypress="preventEnterSubmit(event)">
                    <button type="button" class="remove-btn" onclick="removeListItem(this)">Ã—</button>
                `;
            }
            container.appendChild(newItem);
        }

        // ë¦¬ìŠ¤íŠ¸ í•­ëª© ì œê±° í•¨ìˆ˜
        function removeListItem(button) {
            const container = button.closest('.list-input-container');
            const items = container.querySelectorAll('.list-input-item');
            const currentItem = button.closest('.list-input-item');
            
            if (items.length > 1) {
                // ì—¬ëŸ¬ í•­ëª©ì´ ìˆìœ¼ë©´ ì‚­ì œ
                currentItem.remove();
            } else {
                // ì²« ë²ˆì§¸ í•­ëª©ì´ë©´ ê°’ë§Œ ë¹„ìš°ê¸°
                const textInput = currentItem.querySelector('.list-input');
                const dateInput = currentItem.querySelector('.date-input');
                const checkboxes = currentItem.querySelectorAll('input[type="checkbox"]');
                
                textInput.value = '';
                if (dateInput) {
                    dateInput.value = ''; // ë‚ ì§œë„ ì´ˆê¸°í™”
                }
                // ì²´í¬ë°•ìŠ¤ë„ ì´ˆê¸°í™”
                checkboxes.forEach(checkbox => {
                    checkbox.checked = false;
                });
                textInput.focus(); // í¬ì»¤ìŠ¤ ì´ë™
            }
        }

        // ë¦¬ìŠ¤íŠ¸ ë°ì´í„°ë¥¼ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜ (Sheetìš© - ì²« ì¤„ ì œì™¸í•˜ê³  â–¶ ì¶”ê°€)
        function getListData(containerId) {
            const container = document.getElementById(containerId);
            
            // "ì—†ìŒ" ì²´í¬ë°•ìŠ¤ í™•ì¸
            let noneCheckboxId;
            if (containerId === 'this_week_tasks_container') {
                noneCheckboxId = 'this_week_none';
            } else if (containerId === 'next_week_tasks_container') {
                noneCheckboxId = 'next_week_none';
            } else if (containerId === 'customer_requests_container') {
                noneCheckboxId = 'customer_requests_none';
            }
            
            const noneCheckbox = document.getElementById(noneCheckboxId);
            
            console.log(`getListData ì²´í¬: ${containerId} -> ${noneCheckboxId}, ì²´í¬ë°•ìŠ¤ ì¡´ì¬: ${!!noneCheckbox}, ì²´í¬ë¨: ${noneCheckbox?.checked}`);
            
            if (noneCheckbox && noneCheckbox.checked) {
                console.log(`"ì—†ìŒ" ì²´í¬ë¨: ${containerId} -> ${noneCheckboxId}`);
                return 'ì—†ìŒ';
            }
            
            const items = container.querySelectorAll('.list-input-item');
            const values = Array.from(items)
                .map(item => {
                    const textInput = item.querySelector('.list-input');
                    const dateInput = item.querySelector('.date-input');
                    const checkboxes = item.querySelectorAll('input[type="checkbox"]:checked');
                    
                    if (!textInput || textInput.value.trim() === '') {
                        return null; // í…ìŠ¤íŠ¸ê°€ ë¹„ì–´ìˆìœ¼ë©´ ì œì™¸
                    }
                    
                    const text = textInput.value.trim();
                    const date = dateInput ? dateInput.value : '';
                    
                    // ê¸°ì¡´ í…ìŠ¤íŠ¸ì—ì„œ â–¶ ì œê±°í•˜ê³  ê¹¨ë—í•œ í…ìŠ¤íŠ¸ë§Œ ì¶”ì¶œ
                    const cleanValue = text.replace(/^â–¶\s*/, '').trim();
                    
                    // ê³µë°±ì´ ì•„ë‹Œ ê²½ìš°ì—ë§Œ ì²˜ë¦¬
                    if (cleanValue === '') {
                        return null;
                    }
                    
                    let finalValue = cleanValue;
                    
                    // ì‘ì—… ëŒ€ìƒ ì„ íƒì´ ìˆëŠ” ê²½ìš° (ê¸ˆì£¼ í•œ ì¼, í–¥í›„ í•  ì¼)
                    if (checkboxes.length > 0 && (containerId === 'this_week_tasks_container' || containerId === 'next_week_tasks_container')) {
                        const selectedTargets = Array.from(checkboxes).map(cb => cb.value);
                        finalValue = `[${selectedTargets.join(',')}] ${cleanValue}`;
                    }
                    
                    // ê³ ê° ìš”ì²­ì‚¬í•­ì¸ ê²½ìš° ë‚ ì§œ ì¶”ê°€
                    if (containerId === 'customer_requests_container' && date) {
                        // ë‚ ì§œ í˜•ì‹ì„ YY.MM.DDë¡œ ë³€í™˜
                        const dateObj = new Date(date);
                        const formattedDate = `${dateObj.getFullYear().toString().slice(-2)}.${(dateObj.getMonth() + 1).toString().padStart(2, '0')}.${dateObj.getDate().toString().padStart(2, '0')}`;
                        finalValue = `${cleanValue} (ë°œìƒì¼ : ${formattedDate})`;
                    }
                    
                    return finalValue;
                })
                .filter(value => value !== null) // null ê°’ ì œê±°
                .map((value, index) => {
                    // ì²« ì¤„(index 0)ì€ â–¶ ì—†ì´, ë‚˜ë¨¸ì§€ëŠ” â–¶ ì¶”ê°€
                    if (index === 0) {
                        return value;
                    } else {
                        return `â–¶ ${value}`;
                    }
                });
            
            const result = values.join('\n');
            console.log(`getListData result for ${containerId}:`, result);
            return result;
        }

        // ë¦¬ìŠ¤íŠ¸ ë°ì´í„°ë¥¼ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜ (í‘œì‹œìš© - â–¶ ì—†ì´)
        function getListDataForDisplay(containerId) {
            const container = document.getElementById(containerId);
            const inputs = container.querySelectorAll('.list-input');
            const values = Array.from(inputs)
                .map(input => input.value.trim())
                .filter(value => value !== '');
            return values.join('\n');
        }

        // í…ìŠ¤íŠ¸ë¥¼ ë¦¬ìŠ¤íŠ¸ë¡œ ì„¤ì •í•˜ëŠ” í•¨ìˆ˜ (â–¶ ì œê±°í•˜ì—¬ í‘œì‹œ)
        function setListData(containerId, text) {
            const container = document.getElementById(containerId);
            
            // "ì—†ìŒ" ì²´í¬ë°•ìŠ¤ í™•ì¸
            let noneCheckboxId;
            if (containerId === 'this_week_tasks_container') {
                noneCheckboxId = 'this_week_none';
            } else if (containerId === 'next_week_tasks_container') {
                noneCheckboxId = 'next_week_none';
            } else if (containerId === 'customer_requests_container') {
                noneCheckboxId = 'customer_requests_none';
            }
            
            const noneCheckbox = document.getElementById(noneCheckboxId);
            
            if (text.trim() === 'ì—†ìŒ') {
                // "ì—†ìŒ" ë°ì´í„°ì¸ ê²½ìš° ì²´í¬ë°•ìŠ¤ ì²´í¬í•˜ê³  ì„¹ì…˜ ë¹„í™œì„±í™”
                if (noneCheckbox) {
                    noneCheckbox.checked = true;
                    toggleSection(containerId, true);
                }
                return;
            }
            
            // "ì—†ìŒ"ì´ ì•„ë‹Œ ê²½ìš° ì²´í¬ë°•ìŠ¤ í•´ì œí•˜ê³  ì„¹ì…˜ í™œì„±í™”
            if (noneCheckbox) {
                noneCheckbox.checked = false;
                toggleSection(containerId, false);
            }
            
            const lines = text.split('\n').filter(line => line.trim() !== '');
            
            // ê¸°ì¡´ í•­ëª©ë“¤ ì œê±°
            container.innerHTML = '';
            
            // ìƒˆ í•­ëª©ë“¤ ì¶”ê°€ (â–¶ ì™„ì „ ì œê±°)
            lines.forEach((line, index) => {
                // ëª¨ë“  â–¶ ê¸°í˜¸ì™€ ê³µë°± ì œê±°
                let cleanLine = line.replace(/^â–¶\s*/g, '').trim();
                let dateValue = '';
                let selectedTargets = [];
                
                // ì‘ì—… ëŒ€ìƒ íŒŒì‹± (ê¸ˆì£¼ í•œ ì¼, í–¥í›„ í•  ì¼)
                if (containerId === 'this_week_tasks_container' || containerId === 'next_week_tasks_container') {
                    const targetMatch = cleanLine.match(/^\[([^\]]+)\]\s*(.*)$/);
                    if (targetMatch) {
                        selectedTargets = targetMatch[1].split(',').map(t => t.trim());
                        cleanLine = targetMatch[2].trim();
                    }
                }
                
                // ê³ ê° ìš”ì²­ì‚¬í•­ì¸ ê²½ìš° ë‚ ì§œ íŒŒì‹±
                if (containerId === 'customer_requests_container') {
                    const dateMatch = cleanLine.match(/\(ë°œìƒì¼\s*:\s*(\d{2}\.\d{2}\.\d{2})\)$/);
                    if (dateMatch) {
                        // ë‚ ì§œ ë¶€ë¶„ ì œê±°
                        cleanLine = cleanLine.replace(/\s*\(ë°œìƒì¼\s*:\s*\d{2}\.\d{2}\.\d{2}\)$/, '').trim();
                        
                        // YY.MM.DD í˜•ì‹ì„ YYYY-MM-DDë¡œ ë³€í™˜
                        const dateStr = dateMatch[1];
                        const [year, month, day] = dateStr.split('.');
                        const fullYear = '20' + year; // 20XXë…„ìœ¼ë¡œ ë³€í™˜
                        dateValue = `${fullYear}-${month}-${day}`;
                    }
                }
                
                const newItem = document.createElement('div');
                newItem.className = 'list-input-item';
                
                // ê³ ê° ìš”ì²­ì‚¬í•­ì¸ ê²½ìš° ë‚ ì§œ ì…ë ¥ ì¹¸ ì¶”ê°€
                if (containerId === 'customer_requests_container') {
                    newItem.className = 'list-input-item customer-request-item';
                    newItem.innerHTML = `
                        <div class="date-label">(ë°œìƒì¼)</div>
                        <input type="date" class="date-input" value="${dateValue}" title="ë°œìƒì¼ ì„ íƒ">
                        <input type="text" value="${cleanLine}" class="list-input"
                               onkeydown="preventEnterSubmit(event)" onkeypress="preventEnterSubmit(event)">
                        <button type="button" class="remove-btn" onclick="removeListItem(this)">Ã—</button>
                    `;
                } else if (containerId === 'this_week_tasks_container' || containerId === 'next_week_tasks_container') {
                    // ê¸ˆì£¼ í•œ ì¼, í–¥í›„ í•  ì¼ì¸ ê²½ìš° ì‘ì—… ëŒ€ìƒ ì„ íƒ ì¶”ê°€
                    newItem.className = 'list-input-item customer-request-item';
                    const itemIndex = index + 1;
                    const prefix = containerId === 'this_week_tasks_container' ? 'this_week' : 'next_week';
                    const placeholder = containerId === 'this_week_tasks_container' ? 'ê¸ˆì£¼ í•œ ì¼ì„ ì…ë ¥í•˜ì„¸ìš”...' : 'í–¥í›„ í•  ì¼ì„ ì…ë ¥í•˜ì„¸ìš”...';
                    
                    // ì„ íƒëœ ì‘ì—… ëŒ€ìƒì— ë”°ë¼ ì²´í¬ë°•ìŠ¤ ìƒíƒœ ì„¤ì •
                    const devChecked = selectedTargets.includes('ê°œë°œê³„') ? 'checked' : '';
                    const opsChecked = selectedTargets.includes('ìš´ì˜ê³„') ? 'checked' : '';
                    const etcChecked = selectedTargets.includes('ê¸°íƒ€') ? 'checked' : '';
                    
                    newItem.innerHTML = `
                        <div class="target-label">(ì‘ì—… ëŒ€ìƒ)</div>
                        <div class="target-checkboxes">
                            <div class="target-checkbox-item">
                                <input type="checkbox" id="${prefix}_dev_${itemIndex}" name="${prefix}_target_${itemIndex}" value="ê°œë°œê³„" ${devChecked}>
                                <label for="${prefix}_dev_${itemIndex}">ê°œë°œê³„</label>
                            </div>
                            <div class="target-checkbox-item">
                                <input type="checkbox" id="${prefix}_ops_${itemIndex}" name="${prefix}_target_${itemIndex}" value="ìš´ì˜ê³„" ${opsChecked}>
                                <label for="${prefix}_ops_${itemIndex}">ìš´ì˜ê³„</label>
                            </div>
                            <div class="target-checkbox-item">
                                <input type="checkbox" id="${prefix}_etc_${itemIndex}" name="${prefix}_target_${itemIndex}" value="ê¸°íƒ€" ${etcChecked}>
                                <label for="${prefix}_etc_${itemIndex}">ê¸°íƒ€</label>
                            </div>
                        </div>
                        <input type="text" value="${cleanLine}" placeholder="${placeholder}" class="list-input"
                               onkeydown="preventEnterSubmit(event)" onkeypress="preventEnterSubmit(event)">
                        <button type="button" class="remove-btn" onclick="removeListItem(this)">Ã—</button>
                    `;
                } else {
                    newItem.innerHTML = `
                        <input type="text" value="${cleanLine}" class="list-input"
                               onkeydown="preventEnterSubmit(event)" onkeypress="preventEnterSubmit(event)">
                        <button type="button" class="remove-btn" onclick="removeListItem(this)">Ã—</button>
                    `;
                }
                container.appendChild(newItem);
            });
            
            // ë¹ˆ í•­ëª©ì´ ì—†ìœ¼ë©´ í•˜ë‚˜ ì¶”ê°€
            if (lines.length === 0) {
                addListItem(containerId);
            }
        }

        /**
         * ì‹œíŠ¸ ë°ì´í„°ì—ì„œ íŠ¹ì • site_nameì„ ì°¾ì•„ í•´ë‹¹ ì…€ì˜ 0-based í–‰ê³¼ ì—´ ì¸ë±ìŠ¤ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
         * site_nameì€ 'SITEëª…' ì—´(Bì—´, Gì—´, Lì—´ ë“±)ì— ìœ„ì¹˜í•œë‹¤ê³  ê°€ì •í•©ë‹ˆë‹¤.
         * @param {Array<Array<string>>} sheetData ì‹œíŠ¸ì˜ ì „ì²´ 2ì°¨ì› ë°°ì—´ ë°ì´í„°
         * @param {string} siteName ì°¾ì„ site_name
         * @param {string} sheetName í˜„ì¬ ì‹œíŠ¸ ì´ë¦„
         * @param {Array<string>} columnOrder ìŠ¤í”„ë ˆë“œì‹œíŠ¸ì˜ ì—´ ìˆœì„œ (ì˜ˆ: ['SITEëª…', 'ë‹´ë‹¹ì', 'ê¸ˆì£¼ í•œ ì¼'])
         * @returns {{row: number, col: number}} site_nameì´ ë°œê²¬ëœ 0-based í–‰ ë° ì—´ ì¸ë±ìŠ¤. ì°¾ì§€ ëª»í•˜ë©´ {row: -1, col: -1}.
         */
        function findCellCoordinates(sheetData, siteName, sheetName, columnOrder) {
            const siteNameColIndexInOrder = columnOrder.indexOf('SITEëª…');
            
            for (let r = 0; r < sheetData.length; r++) {
                const row = sheetData[r];
                for (let c = 0; c < row.length; c++) {
                    // SITEëª… ì—´ì— í•´ë‹¹í•˜ëŠ” ê²½ìš°ì—ë§Œ ê²€ìƒ‰
                    // ì—¬ê¸°ì„œëŠ” columnOrderì˜ 'SITEëª…'ì´ ì‹¤ì œ Sheetsì˜ ì–´ëŠ ì—´ì— í•´ë‹¹í•˜ëŠ”ì§€ë¥¼ ì•Œì•„ì•¼ í•©ë‹ˆë‹¤.
                    // ê°„ë‹¨í™”ë¥¼ ìœ„í•´, ì‹¤ì œ Sheetsì—ì„œ SITEëª…ì´ íŠ¹ì • ì—´ì— ê·œì¹™ì ìœ¼ë¡œ ë‚˜íƒ€ë‚œë‹¤ê³  ê°€ì •í•©ë‹ˆë‹¤.
                    // ì˜ˆë¥¼ ë“¤ì–´, B, G, L ì—´ì— SITEëª…ì´ ìˆë‹¤ë©´, c % 5 === 1 (0-based) ê³¼ ê°™ì€ ê·œì¹™ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    // í˜„ì¬ëŠ” ëª¨ë“  ì…€ì„ ê²€ìƒ‰í•©ë‹ˆë‹¤. ë³´ë‹¤ ì •í™•í•œ ë¡œì§ì´ í•„ìš”í•˜ë©´ ìˆ˜ì •í•´ì•¼ í•©ë‹ˆë‹¤.
                    if (row[c] === siteName) {
                         // ì—¬ê¸°ì„œ `c`ëŠ” site_nameì´ ë°œê²¬ëœ ì‹¤ì œ 0-based ì—´ ì¸ë±ìŠ¤ì…ë‹ˆë‹¤ã€‚
                         // ì´ `c`ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë‹¤ë¥¸ ì»¬ëŸ¼ì˜ ì˜¤í”„ì…‹ì„ ê³„ì‚°í•©ë‹ˆë‹¤.
                        return { row: r, col: c };
                    }
                }
            }
            return { row: -1, col: -1 };
        }

        /**
         * 0-based ì—´ ì¸ë±ìŠ¤ë¥¼ A1 í‘œê¸°ë²•ì˜ ì—´ ë¬¸ì(ì˜ˆ: 0 -> A, 25 -> Z, 26 -> AA)ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.
         * @param {number} colIndex 0-based ì—´ ì¸ë±ìŠ¤
         * @returns {string} A1 í‘œê¸°ë²• ì—´ ë¬¸ì
         */
        function columnToLetter(colIndex) {
            let temp, letter = '';
            while (colIndex >= 0) {
                temp = colIndex % 26;
                letter = String.fromCharCode(temp + 65) + letter;
                colIndex = Math.floor(colIndex / 26) - 1;
            }
            return letter;
        }
    </script>

    <script src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
    <script async defer src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>
</body>
</html>
